/// <reference path="node_modules/@types/jquery/index.d.ts" />
/// <reference path="node_modules/@types/lodash/index.d.ts" />
var Log = (function () {
    function Log() {
    }
    Log.out = function (msg) {
        this.state += msg + "\n";
        $("#pre").text(this.state);
    };
    return Log;
}());
Log.state = "";
var PuzzleDemo = (function () {
    function PuzzleDemo(solution) {
        this.solution = [];
        this.solution = solution;
        Log.out("Puzzle: " + solution.join(" "));
    }
    PuzzleDemo.random = function (length) {
        return new PuzzleDemo(_.shuffle(_.map(new Array(length), function (v, k) { return k + 1; })));
    };
    PuzzleDemo.prototype.getSlotCount = function () {
        return this.solution.length;
    };
    PuzzleDemo.prototype.test = function (board) {
        var correct = 0;
        for (var i = 0, len = this.solution.length; i < len; i++) {
            if (board.getSlot(i).quantity == this.solution[i]) {
                correct++;
            }
        }
        return correct;
    };
    return PuzzleDemo;
}());
var HumanPuzzleInterface = (function () {
    function HumanPuzzleInterface(slotCount) {
        this.slotCount;
    }
    HumanPuzzleInterface.prototype.getSlotCount = function () {
        return this.slotCount;
    };
    HumanPuzzleInterface.prototype.test = function (board) {
        var answer;
        do {
            answer = parseInt(prompt("Please try:\n\t" + board + "\n\nHow many are correct?"), 10);
        } while (!isNaN(answer));
        return answer;
    };
    return HumanPuzzleInterface;
}());
var Solver = (function () {
    function Solver(puzzle) {
        this.guesses = 0;
        this.puzzle = puzzle;
        // first guess
        this.board = new Board(_.map(new Array(this.puzzle.getSlotCount()), function (v, k) { return k + 1; }));
        // begin
        this.testGuess();
    }
    Solver.solve = function (puzzle) {
        return new Solver(puzzle);
    };
    Solver.prototype.testGuess = function () {
        var _this = this;
        this.guesses++;
        var correct = this.puzzle.test(this.board);
        var delta = correct - this.lastCorrect || 0;
        Log.out(correct + " (" + (delta < 0 ? delta : "+" + delta) + ")  " + this.board);
        this.board.render();
        if (correct == this.puzzle.getSlotCount()) {
            Log.out("You win in " + this.guesses + " guesses.");
            return;
        }
        // try again
        if (null != this.board.getMove(-1)) {
            if (correct == this.lastCorrect) {
                // no difference; both are wrong
                this.board.setDeduction("NO", "NO");
            }
            else if (correct == this.lastCorrect + 1) {
                // difference; one is now right, but we don't know which
                // unless we have history to narrow it, then we have specific match
                this.board.setDeduction("MAYBE", "MAYBE");
            }
            else if (correct == this.lastCorrect + 2) {
                // very positive difference; both are now right for sure
                this.board.setDeduction("YES", "YES");
            }
            else if (correct == this.lastCorrect - 1) {
                // difference; one was right, but we don't know which
                // if one was a maybe and one was not, then one is now a for sure
                this.board.unswap();
                correct = this.lastCorrect;
                this.board.setDeduction("MAYBE", "MAYBE");
            }
            else if (correct == this.lastCorrect - 2) {
                // difference; both were right for sure
                this.board.unswap();
                correct = this.lastCorrect;
                this.board.setDeduction("YES", "YES");
            }
        }
        // swap next pair
        var candidates = [];
        for (var i = 0, len = this.puzzle.getSlotCount(); i < len; i++) {
            //console.log("candidate ", { i: i, d: this.board.getSlot(i).deduction });
            if ("YES" != this.board.getSlot(i).deduction) {
                candidates.push(i);
            }
        }
        if (candidates.length < 2) {
            Log.out("Only one unknown remains yet puzzle isn't solved? Impossible!");
            console.log(candidates);
            return;
        }
        candidates = _.shuffle(candidates);
        this.board.swap(candidates.pop(), candidates.pop());
        this.lastCorrect = correct;
        setTimeout(function () { return _this.testGuess(); }, GUESS_DELAY);
    };
    return Solver;
}());
var Slot = (function () {
    function Slot() {
    }
    Slot.prototype.toString = function () {
        return this.quantity;
    };
    return Slot;
}());
var Pair = (function () {
    function Pair() {
    }
    return Pair;
}());
var Move = (function () {
    function Move() {
    }
    return Move;
}());
var Board = (function () {
    function Board(quantities) {
        this.board = [];
        this.history = []; // history of moves
        for (var i = 0, len = quantities.length; i < len; i++) {
            var slot = new Slot();
            slot.symbol = Board.symbols.substr(i, 1);
            slot.quantity = quantities[i];
            slot.deduction = "UNKNOWN";
            this.board.push(slot);
        }
    }
    Board.prototype.swap = function (a, b) {
        // record before
        var move = new Move();
        var pairBefore = new Pair();
        pairBefore.a = _.clone(this.board[a]);
        pairBefore.b = _.clone(this.board[b]);
        move.before = pairBefore;
        // move
        Log.out("        m: " + this.board[a].quantity + " <> " + this.board[b].quantity);
        var c = this.board[a];
        this.board[a] = this.board[b];
        this.board[b] = c;
        // record after
        var pairAfter = new Pair();
        pairAfter.a = _.clone(this.board[a]);
        pairAfter.b = _.clone(this.board[b]);
        move.after = pairAfter;
        this.history.push(move);
    };
    Board.prototype.setDeduction = function (a, b) {
        var lastPair = this.history[this.history.length - 1].after;
        Log.out("        d: " + lastPair.a.quantity + " " + lastPair.a.deduction[0] + " => " + a[0] + ", " + lastPair.b.quantity + " " + lastPair.b.deduction[0] + " => " + b[0]);
        var ai = this.board.indexOf(lastPair.a);
        lastPair.a.deduction = this.board[this.findSlotIndex(lastPair.a)].deduction = a;
        lastPair.b.deduction = this.board[this.findSlotIndex(lastPair.b)].deduction = b;
    };
    Board.prototype.findSlotIndex = function (slot) {
        for (var i = 0, len = this.board.length; i < len; i++) {
            if (slot.quantity == this.board[i].quantity) {
                return i;
            }
        }
        throw "Quantity not found on board? Impossible!";
    };
    Board.prototype.unswap = function () {
        var lastPair = this.history[this.history.length - 1].after;
        this.swap(this.findSlotIndex(lastPair.a), this.findSlotIndex(lastPair.b));
        Log.out("        " + this);
    };
    Board.prototype.toString = function () {
        return this.board.join(" ");
    };
    Board.prototype.getMove = function (delta) {
        return this.history[this.history.length + delta];
    };
    Board.prototype.getSlot = function (index) {
        return this.board[index];
    };
    Board.prototype.render = function () {
        for (var i = 0, len = this.board.length; i < len; i++) {
            var slot = this.getSlot(i);
            $("td#c" + i).text(slot.quantity + " " + slot.deduction[0]);
        }
    };
    return Board;
}());
Board.symbols = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
var GUESS_DELAY = 250; // ms
var SLOT_COUNT = 6;
var puzzle = PuzzleDemo.random(SLOT_COUNT);
//let human = new HumanPuzzleInterface(SLOT_COUNT);
Solver.solve(puzzle);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0aGV1cy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1ldGhldXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsOERBQThEO0FBQzlELDhEQUE4RDtBQUU5RDtJQUFBO0lBTUEsQ0FBQztJQUpjLE9BQUcsR0FBakIsVUFBa0IsR0FBVztRQUM1QixJQUFJLENBQUMsS0FBSyxJQUFPLEdBQUcsT0FBSSxDQUFDO1FBQ3pCLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFDRixVQUFDO0FBQUQsQ0FBQyxBQU5EO0FBQ2dCLFNBQUssR0FBRyxFQUFFLENBQUM7QUFZM0I7SUFHQyxvQkFBbUIsUUFBa0I7UUFGN0IsYUFBUSxHQUFhLEVBQUUsQ0FBQztRQUcvQixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztRQUN6QixHQUFHLENBQUMsR0FBRyxDQUFDLGFBQVcsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUcsQ0FBQyxDQUFDO0lBQzFDLENBQUM7SUFFYSxpQkFBTSxHQUFwQixVQUFxQixNQUFjO1FBQ2xDLE1BQU0sQ0FBQyxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQ3BDLElBQUksS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFLFVBQVUsQ0FBQyxFQUFFLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBRU0saUNBQVksR0FBbkI7UUFDQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7SUFDN0IsQ0FBQztJQUVNLHlCQUFJLEdBQVgsVUFBWSxLQUFZO1FBQ3ZCLElBQUksT0FBTyxHQUFHLENBQUMsQ0FBQztRQUNoQixHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUMxRCxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbkQsT0FBTyxFQUFFLENBQUM7WUFDWCxDQUFDO1FBQ0YsQ0FBQztRQUNELE1BQU0sQ0FBQyxPQUFPLENBQUM7SUFDaEIsQ0FBQztJQUNGLGlCQUFDO0FBQUQsQ0FBQyxBQTFCRCxJQTBCQztBQUVEO0lBR0MsOEJBQW1CLFNBQWlCO1FBQ25DLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDaEIsQ0FBQztJQUVNLDJDQUFZLEdBQW5CO1FBQ0MsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDdkIsQ0FBQztJQUVNLG1DQUFJLEdBQVgsVUFBWSxLQUFZO1FBQ3ZCLElBQUksTUFBTSxDQUFDO1FBQ1gsR0FBRyxDQUFDO1lBQ0gsTUFBTSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQ3ZCLG9CQUFrQixLQUFLLDhCQUEyQixDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDM0QsQ0FBQyxRQUNNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1FBQ3ZCLE1BQU0sQ0FBQyxNQUFNLENBQUM7SUFDZixDQUFDO0lBQ0YsMkJBQUM7QUFBRCxDQUFDLEFBcEJELElBb0JDO0FBRUQ7SUFLQyxnQkFBbUIsTUFBYztRQWV6QixZQUFPLEdBQUcsQ0FBQyxDQUFDO1FBZG5CLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBRXJCLGNBQWM7UUFDZCxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsQ0FBQyxFQUNqRSxVQUFVLENBQUMsRUFBRSxDQUFDLElBQUksTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXJDLFFBQVE7UUFDUixJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDbEIsQ0FBQztJQUVhLFlBQUssR0FBbkIsVUFBb0IsTUFBYztRQUNqQyxNQUFNLENBQUMsSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUdNLDBCQUFTLEdBQWhCO1FBQUEsaUJBNERDO1FBM0RBLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNmLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzQyxJQUFJLEtBQUssR0FBRyxPQUFPLEdBQUcsSUFBSSxDQUFDLFdBQVcsSUFBSSxDQUFDLENBQUM7UUFDNUMsR0FBRyxDQUFDLEdBQUcsQ0FBSSxPQUFPLFdBQUssS0FBSyxHQUFHLENBQUMsR0FBRyxLQUFLLEdBQUcsTUFBSSxLQUFPLFlBQU0sSUFBSSxDQUFDLEtBQU8sQ0FBQyxDQUFDO1FBQzFFLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDcEIsRUFBRSxDQUFDLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzNDLEdBQUcsQ0FBQyxHQUFHLENBQUMsZ0JBQWMsSUFBSSxDQUFDLE9BQU8sY0FBVyxDQUFDLENBQUM7WUFDL0MsTUFBTSxDQUFDO1FBQ1IsQ0FBQztRQUVELFlBQVk7UUFDWixFQUFFLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEMsRUFBRSxDQUFDLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO2dCQUNqQyxnQ0FBZ0M7Z0JBQ2hDLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNyQyxDQUFDO1lBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzFDLHdEQUF3RDtnQkFDeEQsbUVBQW1FO2dCQUNuRSxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDM0MsQ0FBQztZQUNELElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMxQyx3REFBd0Q7Z0JBQ3hELElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztZQUN2QyxDQUFDO1lBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzFDLHFEQUFxRDtnQkFFckQsaUVBQWlFO2dCQUVqRSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUNwQixPQUFPLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztnQkFDM0IsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQzNDLENBQUM7WUFDRCxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDMUMsdUNBQXVDO2dCQUN2QyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUNwQixPQUFPLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztnQkFDM0IsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3ZDLENBQUM7UUFDRixDQUFDO1FBQ0QsaUJBQWlCO1FBQ2pCLElBQUksVUFBVSxHQUFhLEVBQUUsQ0FBQztRQUM5QixHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ2hFLDBFQUEwRTtZQUMxRSxFQUFFLENBQUMsQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztnQkFDOUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwQixDQUFDO1FBQ0YsQ0FBQztRQUNELEVBQUUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMzQixHQUFHLENBQUMsR0FBRyxDQUFDLCtEQUErRCxDQUFDLENBQUM7WUFDekUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUN4QixNQUFNLENBQUM7UUFDUixDQUFDO1FBQ0QsVUFBVSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDbkMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRSxFQUFFLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBRXBELElBQUksQ0FBQyxXQUFXLEdBQUcsT0FBTyxDQUFDO1FBQzNCLFVBQVUsQ0FBQyxjQUFNLE9BQUEsS0FBSSxDQUFDLFNBQVMsRUFBRSxFQUFoQixDQUFnQixFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBQ2pELENBQUM7SUFDRixhQUFDO0FBQUQsQ0FBQyxBQWxGRCxJQWtGQztBQVFEO0lBQUE7SUFRQSxDQUFDO0lBSE8sdUJBQVEsR0FBZjtRQUNDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQ3RCLENBQUM7SUFDRixXQUFDO0FBQUQsQ0FBQyxBQVJELElBUUM7QUFFRDtJQUFBO0lBR0EsQ0FBQztJQUFELFdBQUM7QUFBRCxDQUFDLEFBSEQsSUFHQztBQUVEO0lBQUE7SUFHQSxDQUFDO0lBQUQsV0FBQztBQUFELENBQUMsQUFIRCxJQUdDO0FBRUQ7SUFLQyxlQUFtQixVQUFvQjtRQUgvQixVQUFLLEdBQVcsRUFBRSxDQUFDO1FBQ25CLFlBQU8sR0FBVyxFQUFFLENBQUMsQ0FBQyxtQkFBbUI7UUFHaEQsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUN2RCxJQUFJLElBQUksR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1lBQ3RCLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ3pDLElBQUksQ0FBQyxRQUFRLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlCLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1lBQzNCLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZCLENBQUM7SUFDRixDQUFDO0lBRU0sb0JBQUksR0FBWCxVQUFZLENBQVMsRUFBRSxDQUFTO1FBQy9CLGdCQUFnQjtRQUNoQixJQUFJLElBQUksR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ3RCLElBQUksVUFBVSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFDNUIsVUFBVSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN0QyxVQUFVLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3RDLElBQUksQ0FBQyxNQUFNLEdBQUcsVUFBVSxDQUFDO1FBRXpCLE9BQU87UUFDUCxHQUFHLENBQUMsR0FBRyxDQUFDLGdCQUFjLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxZQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBVSxDQUFDLENBQUM7UUFDN0UsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN0QixJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUIsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFbEIsZUFBZTtRQUNmLElBQUksU0FBUyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFDM0IsU0FBUyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNyQyxTQUFTLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3JDLElBQUksQ0FBQyxLQUFLLEdBQUcsU0FBUyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFFTSw0QkFBWSxHQUFuQixVQUFvQixDQUFZLEVBQUUsQ0FBWTtRQUM3QyxJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztRQUMzRCxHQUFHLENBQUMsR0FBRyxDQUFDLGdCQUFjLFFBQVEsQ0FBQyxDQUFDLENBQUMsUUFBUSxTQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxZQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLFFBQVEsU0FBSSxRQUFRLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsWUFBTyxDQUFDLENBQUMsQ0FBQyxDQUFHLENBQUMsQ0FBQztRQUNqSixJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEMsUUFBUSxDQUFDLENBQUMsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUM7UUFDaEYsUUFBUSxDQUFDLENBQUMsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUM7SUFDakYsQ0FBQztJQUVNLDZCQUFhLEdBQXBCLFVBQXFCLElBQVU7UUFFOUIsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUMsQ0FBQyxFQUFDLEdBQUcsR0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUM5QyxDQUFDO1lBQ0EsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUM1QyxDQUFDO2dCQUNBLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDVixDQUFDO1FBQ0YsQ0FBQztRQUNELE1BQU0sMENBQTBDLENBQUM7SUFDbEQsQ0FBQztJQUVNLHNCQUFNLEdBQWI7UUFDQyxJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztRQUMzRCxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxhQUFXLElBQU0sQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFFTSx3QkFBUSxHQUFmO1FBQ0MsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFFTSx1QkFBTyxHQUFkLFVBQWUsS0FBYTtRQUMzQixNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUMsQ0FBQztJQUNsRCxDQUFDO0lBRU0sdUJBQU8sR0FBZCxVQUFlLEtBQWE7UUFDM0IsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDMUIsQ0FBQztJQUVNLHNCQUFNLEdBQWI7UUFDQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUN2RCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzNCLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEdBQUUsR0FBRyxHQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzRCxDQUFDO0lBQ0YsQ0FBQztJQUNGLFlBQUM7QUFBRCxDQUFDLEFBakZEO0FBQ2dCLGFBQU8sR0FBRyw0QkFBNEIsQ0FBQztBQW1GdkQsSUFBTSxXQUFXLEdBQUcsR0FBRyxDQUFDLENBQUMsS0FBSztBQUM5QixJQUFNLFVBQVUsR0FBRyxDQUFDLENBQUM7QUFDckIsSUFBSSxNQUFNLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUMzQyxtREFBbUQ7QUFDbkQsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJub2RlX21vZHVsZXMvQHR5cGVzL2pxdWVyeS9pbmRleC5kLnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIm5vZGVfbW9kdWxlcy9AdHlwZXMvbG9kYXNoL2luZGV4LmQudHNcIiAvPlxyXG5cclxuY2xhc3MgTG9nIHtcclxuXHRwcml2YXRlIHN0YXRpYyBzdGF0ZSA9IFwiXCI7XHJcblx0cHVibGljIHN0YXRpYyBvdXQobXNnOiBzdHJpbmcpOiB2b2lkIHtcclxuXHRcdHRoaXMuc3RhdGUgKz0gYCR7bXNnfVxcbmA7XHJcblx0XHQkKFwiI3ByZVwiKS50ZXh0KHRoaXMuc3RhdGUpO1xyXG5cdH1cclxufVxyXG5cclxuaW50ZXJmYWNlIFB1enpsZSB7XHJcblx0dGVzdChib2FyZDogQm9hcmQpOiBudW1iZXI7XHJcblx0Z2V0U2xvdENvdW50KCk6IG51bWJlcjtcclxufVxyXG5cclxuY2xhc3MgUHV6emxlRGVtbyBpbXBsZW1lbnRzIFB1enpsZSB7XHJcblx0cHJpdmF0ZSBzb2x1dGlvbjogbnVtYmVyW10gPSBbXTtcclxuXHJcblx0cHVibGljIGNvbnN0cnVjdG9yKHNvbHV0aW9uOiBudW1iZXJbXSkge1xyXG5cdFx0dGhpcy5zb2x1dGlvbiA9IHNvbHV0aW9uO1xyXG5cdFx0TG9nLm91dChgUHV6emxlOiAke3NvbHV0aW9uLmpvaW4oXCIgXCIpfWApO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHN0YXRpYyByYW5kb20obGVuZ3RoOiBudW1iZXIpOiBQdXp6bGUge1xyXG5cdFx0cmV0dXJuIG5ldyBQdXp6bGVEZW1vKF8uc2h1ZmZsZShfLm1hcChcclxuXHRcdFx0bmV3IEFycmF5KGxlbmd0aCksIGZ1bmN0aW9uICh2LCBrKSB7IHJldHVybiBrICsgMTsgfSkpKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBnZXRTbG90Q291bnQoKTogbnVtYmVyIHtcclxuXHRcdHJldHVybiB0aGlzLnNvbHV0aW9uLmxlbmd0aDtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyB0ZXN0KGJvYXJkOiBCb2FyZCk6IG51bWJlciB7XHJcblx0XHRsZXQgY29ycmVjdCA9IDA7XHJcblx0XHRmb3IgKGxldCBpID0gMCwgbGVuID0gdGhpcy5zb2x1dGlvbi5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG5cdFx0XHRpZiAoYm9hcmQuZ2V0U2xvdChpKS5xdWFudGl0eSA9PSB0aGlzLnNvbHV0aW9uW2ldKSB7XHJcblx0XHRcdFx0Y29ycmVjdCsrO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gY29ycmVjdDtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIEh1bWFuUHV6emxlSW50ZXJmYWNlIGltcGxlbWVudHMgUHV6emxlIHtcclxuXHRwcml2YXRlIHNsb3RDb3VudDogbnVtYmVyO1xyXG5cclxuXHRwdWJsaWMgY29uc3RydWN0b3Ioc2xvdENvdW50OiBudW1iZXIpIHtcclxuXHRcdHRoaXMuc2xvdENvdW50O1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldFNsb3RDb3VudCgpOiBudW1iZXIge1xyXG5cdFx0cmV0dXJuIHRoaXMuc2xvdENvdW50O1xyXG5cdH1cclxuXHJcblx0cHVibGljIHRlc3QoYm9hcmQ6IEJvYXJkKTogbnVtYmVyIHtcclxuXHRcdGxldCBhbnN3ZXI7XHJcblx0XHRkbyB7XHJcblx0XHRcdGFuc3dlciA9IHBhcnNlSW50KHByb21wdChcclxuXHRcdFx0XHRgUGxlYXNlIHRyeTpcXG5cXHQke2JvYXJkfVxcblxcbkhvdyBtYW55IGFyZSBjb3JyZWN0P2ApLCAxMCk7XHJcblx0XHR9XHJcblx0XHR3aGlsZSAoIWlzTmFOKGFuc3dlcikpO1xyXG5cdFx0cmV0dXJuIGFuc3dlcjtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIFNvbHZlciB7XHJcblx0cHJpdmF0ZSBwdXp6bGU6IFB1enpsZTtcclxuXHRwcml2YXRlIGJvYXJkOiBCb2FyZDtcclxuXHRwcml2YXRlIGxhc3RDb3JyZWN0OiBudW1iZXI7XHJcblxyXG5cdHB1YmxpYyBjb25zdHJ1Y3RvcihwdXp6bGU6IFB1enpsZSkge1xyXG5cdFx0dGhpcy5wdXp6bGUgPSBwdXp6bGU7XHJcblxyXG5cdFx0Ly8gZmlyc3QgZ3Vlc3NcclxuXHRcdHRoaXMuYm9hcmQgPSBuZXcgQm9hcmQoXy5tYXAobmV3IEFycmF5KHRoaXMucHV6emxlLmdldFNsb3RDb3VudCgpKSxcclxuXHRcdFx0ZnVuY3Rpb24gKHYsIGspIHsgcmV0dXJuIGsgKyAxOyB9KSk7XHJcblxyXG5cdFx0Ly8gYmVnaW5cclxuXHRcdHRoaXMudGVzdEd1ZXNzKCk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc3RhdGljIHNvbHZlKHB1enpsZTogUHV6emxlKSB7XHJcblx0XHRyZXR1cm4gbmV3IFNvbHZlcihwdXp6bGUpO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBndWVzc2VzID0gMDtcclxuXHRwdWJsaWMgdGVzdEd1ZXNzKCkge1xyXG5cdFx0dGhpcy5ndWVzc2VzKys7XHJcblx0XHRsZXQgY29ycmVjdCA9IHRoaXMucHV6emxlLnRlc3QodGhpcy5ib2FyZCk7XHJcblx0XHRsZXQgZGVsdGEgPSBjb3JyZWN0IC0gdGhpcy5sYXN0Q29ycmVjdCB8fCAwO1xyXG5cdFx0TG9nLm91dChgJHtjb3JyZWN0fSAoJHtkZWx0YSA8IDAgPyBkZWx0YSA6IGArJHtkZWx0YX1gfSkgICR7dGhpcy5ib2FyZH1gKTtcclxuXHRcdHRoaXMuYm9hcmQucmVuZGVyKCk7XHJcblx0XHRpZiAoY29ycmVjdCA9PSB0aGlzLnB1enpsZS5nZXRTbG90Q291bnQoKSkge1xyXG5cdFx0XHRMb2cub3V0KGBZb3Ugd2luIGluICR7dGhpcy5ndWVzc2VzfSBndWVzc2VzLmApO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdC8vIHRyeSBhZ2FpblxyXG5cdFx0aWYgKG51bGwgIT0gdGhpcy5ib2FyZC5nZXRNb3ZlKC0xKSkge1xyXG5cdFx0XHRpZiAoY29ycmVjdCA9PSB0aGlzLmxhc3RDb3JyZWN0KSB7XHJcblx0XHRcdFx0Ly8gbm8gZGlmZmVyZW5jZTsgYm90aCBhcmUgd3JvbmdcclxuXHRcdFx0XHR0aGlzLmJvYXJkLnNldERlZHVjdGlvbihcIk5PXCIsIFwiTk9cIik7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoY29ycmVjdCA9PSB0aGlzLmxhc3RDb3JyZWN0ICsgMSkge1xyXG5cdFx0XHRcdC8vIGRpZmZlcmVuY2U7IG9uZSBpcyBub3cgcmlnaHQsIGJ1dCB3ZSBkb24ndCBrbm93IHdoaWNoXHJcblx0XHRcdFx0Ly8gdW5sZXNzIHdlIGhhdmUgaGlzdG9yeSB0byBuYXJyb3cgaXQsIHRoZW4gd2UgaGF2ZSBzcGVjaWZpYyBtYXRjaFxyXG5cdFx0XHRcdHRoaXMuYm9hcmQuc2V0RGVkdWN0aW9uKFwiTUFZQkVcIiwgXCJNQVlCRVwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmIChjb3JyZWN0ID09IHRoaXMubGFzdENvcnJlY3QgKyAyKSB7XHJcblx0XHRcdFx0Ly8gdmVyeSBwb3NpdGl2ZSBkaWZmZXJlbmNlOyBib3RoIGFyZSBub3cgcmlnaHQgZm9yIHN1cmVcclxuXHRcdFx0XHR0aGlzLmJvYXJkLnNldERlZHVjdGlvbihcIllFU1wiLCBcIllFU1wiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmIChjb3JyZWN0ID09IHRoaXMubGFzdENvcnJlY3QgLSAxKSB7XHJcblx0XHRcdFx0Ly8gZGlmZmVyZW5jZTsgb25lIHdhcyByaWdodCwgYnV0IHdlIGRvbid0IGtub3cgd2hpY2hcclxuXHJcblx0XHRcdFx0Ly8gaWYgb25lIHdhcyBhIG1heWJlIGFuZCBvbmUgd2FzIG5vdCwgdGhlbiBvbmUgaXMgbm93IGEgZm9yIHN1cmVcclxuXHJcblx0XHRcdFx0dGhpcy5ib2FyZC51bnN3YXAoKTtcclxuXHRcdFx0XHRjb3JyZWN0ID0gdGhpcy5sYXN0Q29ycmVjdDtcclxuXHRcdFx0XHR0aGlzLmJvYXJkLnNldERlZHVjdGlvbihcIk1BWUJFXCIsIFwiTUFZQkVcIik7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoY29ycmVjdCA9PSB0aGlzLmxhc3RDb3JyZWN0IC0gMikge1xyXG5cdFx0XHRcdC8vIGRpZmZlcmVuY2U7IGJvdGggd2VyZSByaWdodCBmb3Igc3VyZVxyXG5cdFx0XHRcdHRoaXMuYm9hcmQudW5zd2FwKCk7XHJcblx0XHRcdFx0Y29ycmVjdCA9IHRoaXMubGFzdENvcnJlY3Q7XHJcblx0XHRcdFx0dGhpcy5ib2FyZC5zZXREZWR1Y3Rpb24oXCJZRVNcIiwgXCJZRVNcIik7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdC8vIHN3YXAgbmV4dCBwYWlyXHJcblx0XHRsZXQgY2FuZGlkYXRlczogbnVtYmVyW10gPSBbXTtcclxuXHRcdGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLnB1enpsZS5nZXRTbG90Q291bnQoKTsgaSA8IGxlbjsgaSsrKSB7XHJcblx0XHRcdC8vY29uc29sZS5sb2coXCJjYW5kaWRhdGUgXCIsIHsgaTogaSwgZDogdGhpcy5ib2FyZC5nZXRTbG90KGkpLmRlZHVjdGlvbiB9KTtcclxuXHRcdFx0aWYgKFwiWUVTXCIgIT0gdGhpcy5ib2FyZC5nZXRTbG90KGkpLmRlZHVjdGlvbikge1xyXG5cdFx0XHRcdGNhbmRpZGF0ZXMucHVzaChpKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0aWYgKGNhbmRpZGF0ZXMubGVuZ3RoIDwgMikge1xyXG5cdFx0XHRMb2cub3V0KFwiT25seSBvbmUgdW5rbm93biByZW1haW5zIHlldCBwdXp6bGUgaXNuJ3Qgc29sdmVkPyBJbXBvc3NpYmxlIVwiKTtcclxuXHRcdFx0Y29uc29sZS5sb2coY2FuZGlkYXRlcyk7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdGNhbmRpZGF0ZXMgPSBfLnNodWZmbGUoY2FuZGlkYXRlcyk7XHJcblx0XHR0aGlzLmJvYXJkLnN3YXAoY2FuZGlkYXRlcy5wb3AoKSwgY2FuZGlkYXRlcy5wb3AoKSk7XHJcblxyXG5cdFx0dGhpcy5sYXN0Q29ycmVjdCA9IGNvcnJlY3Q7XHJcblx0XHRzZXRUaW1lb3V0KCgpID0+IHRoaXMudGVzdEd1ZXNzKCksIEdVRVNTX0RFTEFZKTtcclxuXHR9XHJcbn1cclxuXHJcblxyXG5cclxuLy8gaGlzdG9yeTogTW92ZTogUGFpcjogU2xvdFxyXG5cclxudHlwZSBEZWR1Y3Rpb24gPSBcIlVOS05PV05cIiB8IFwiTk9cIiB8IFwiTUFZQkVcIiB8IFwiWUVTXCI7XHJcblxyXG5jbGFzcyBTbG90IHtcclxuXHRzeW1ib2w6IHN0cmluZztcclxuXHRxdWFudGl0eTogbnVtYmVyO1xyXG5cdGRlZHVjdGlvbjogRGVkdWN0aW9uO1xyXG5cclxuXHRwdWJsaWMgdG9TdHJpbmcoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5xdWFudGl0eTtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIFBhaXIge1xyXG5cdHB1YmxpYyBhOiBTbG90O1xyXG5cdHB1YmxpYyBiOiBTbG90O1xyXG59XHJcblxyXG5jbGFzcyBNb3ZlIHtcclxuXHRiZWZvcmU6IFBhaXI7XHJcblx0YWZ0ZXI6IFBhaXI7XHJcbn1cclxuXHJcbmNsYXNzIEJvYXJkIHtcclxuXHRwcml2YXRlIHN0YXRpYyBzeW1ib2xzID0gXCJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWlwiO1xyXG5cdHByaXZhdGUgYm9hcmQ6IFNsb3RbXSA9IFtdO1xyXG5cdHByaXZhdGUgaGlzdG9yeTogTW92ZVtdID0gW107IC8vIGhpc3Rvcnkgb2YgbW92ZXNcclxuXHJcblx0cHVibGljIGNvbnN0cnVjdG9yKHF1YW50aXRpZXM6IG51bWJlcltdKSB7XHJcblx0XHRmb3IgKGxldCBpID0gMCwgbGVuID0gcXVhbnRpdGllcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG5cdFx0XHRsZXQgc2xvdCA9IG5ldyBTbG90KCk7XHJcblx0XHRcdHNsb3Quc3ltYm9sID0gQm9hcmQuc3ltYm9scy5zdWJzdHIoaSwgMSk7XHJcblx0XHRcdHNsb3QucXVhbnRpdHkgPSBxdWFudGl0aWVzW2ldO1xyXG5cdFx0XHRzbG90LmRlZHVjdGlvbiA9IFwiVU5LTk9XTlwiO1xyXG5cdFx0XHR0aGlzLmJvYXJkLnB1c2goc2xvdCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc3dhcChhOiBudW1iZXIsIGI6IG51bWJlcikge1xyXG5cdFx0Ly8gcmVjb3JkIGJlZm9yZVxyXG5cdFx0bGV0IG1vdmUgPSBuZXcgTW92ZSgpO1xyXG5cdFx0bGV0IHBhaXJCZWZvcmUgPSBuZXcgUGFpcigpO1xyXG5cdFx0cGFpckJlZm9yZS5hID0gXy5jbG9uZSh0aGlzLmJvYXJkW2FdKTtcclxuXHRcdHBhaXJCZWZvcmUuYiA9IF8uY2xvbmUodGhpcy5ib2FyZFtiXSk7XHJcblx0XHRtb3ZlLmJlZm9yZSA9IHBhaXJCZWZvcmU7XHJcblxyXG5cdFx0Ly8gbW92ZVxyXG5cdFx0TG9nLm91dChgICAgICAgICBtOiAke3RoaXMuYm9hcmRbYV0ucXVhbnRpdHl9IDw+ICR7dGhpcy5ib2FyZFtiXS5xdWFudGl0eX1gKTtcclxuXHRcdGxldCBjID0gdGhpcy5ib2FyZFthXTtcclxuXHRcdHRoaXMuYm9hcmRbYV0gPSB0aGlzLmJvYXJkW2JdO1xyXG5cdFx0dGhpcy5ib2FyZFtiXSA9IGM7XHJcblxyXG5cdFx0Ly8gcmVjb3JkIGFmdGVyXHJcblx0XHRsZXQgcGFpckFmdGVyID0gbmV3IFBhaXIoKTtcclxuXHRcdHBhaXJBZnRlci5hID0gXy5jbG9uZSh0aGlzLmJvYXJkW2FdKTtcclxuXHRcdHBhaXJBZnRlci5iID0gXy5jbG9uZSh0aGlzLmJvYXJkW2JdKTtcclxuXHRcdG1vdmUuYWZ0ZXIgPSBwYWlyQWZ0ZXI7XHJcblx0XHR0aGlzLmhpc3RvcnkucHVzaChtb3ZlKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXREZWR1Y3Rpb24oYTogRGVkdWN0aW9uLCBiOiBEZWR1Y3Rpb24pIHtcclxuXHRcdGxldCBsYXN0UGFpciA9IHRoaXMuaGlzdG9yeVt0aGlzLmhpc3RvcnkubGVuZ3RoIC0gMV0uYWZ0ZXI7XHJcblx0XHRMb2cub3V0KGAgICAgICAgIGQ6ICR7bGFzdFBhaXIuYS5xdWFudGl0eX0gJHtsYXN0UGFpci5hLmRlZHVjdGlvblswXX0gPT4gJHthWzBdfSwgJHtsYXN0UGFpci5iLnF1YW50aXR5fSAke2xhc3RQYWlyLmIuZGVkdWN0aW9uWzBdfSA9PiAke2JbMF19YCk7XHJcblx0XHRsZXQgYWkgPSB0aGlzLmJvYXJkLmluZGV4T2YobGFzdFBhaXIuYSk7XHJcblx0XHRsYXN0UGFpci5hLmRlZHVjdGlvbiA9IHRoaXMuYm9hcmRbdGhpcy5maW5kU2xvdEluZGV4KGxhc3RQYWlyLmEpXS5kZWR1Y3Rpb24gPSBhO1xyXG5cdFx0bGFzdFBhaXIuYi5kZWR1Y3Rpb24gPSB0aGlzLmJvYXJkW3RoaXMuZmluZFNsb3RJbmRleChsYXN0UGFpci5iKV0uZGVkdWN0aW9uID0gYjtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBmaW5kU2xvdEluZGV4KHNsb3Q6IFNsb3QpOiBudW1iZXJcclxuXHR7XHJcblx0XHRmb3IgKGxldCBpPTAsbGVuPXRoaXMuYm9hcmQubGVuZ3RoOyBpPGxlbjsgaSsrKVxyXG5cdFx0e1xyXG5cdFx0XHRpZiAoc2xvdC5xdWFudGl0eSA9PSB0aGlzLmJvYXJkW2ldLnF1YW50aXR5KVxyXG5cdFx0XHR7XHJcblx0XHRcdFx0cmV0dXJuIGk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHRocm93IFwiUXVhbnRpdHkgbm90IGZvdW5kIG9uIGJvYXJkPyBJbXBvc3NpYmxlIVwiO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHVuc3dhcCgpIHtcclxuXHRcdGxldCBsYXN0UGFpciA9IHRoaXMuaGlzdG9yeVt0aGlzLmhpc3RvcnkubGVuZ3RoIC0gMV0uYWZ0ZXI7XHJcblx0XHR0aGlzLnN3YXAodGhpcy5maW5kU2xvdEluZGV4KGxhc3RQYWlyLmEpLCB0aGlzLmZpbmRTbG90SW5kZXgobGFzdFBhaXIuYikpO1xyXG5cdFx0TG9nLm91dChgICAgICAgICAke3RoaXN9YCk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgdG9TdHJpbmcoKTogc3RyaW5nIHtcclxuXHRcdHJldHVybiB0aGlzLmJvYXJkLmpvaW4oXCIgXCIpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldE1vdmUoZGVsdGE6IG51bWJlcikge1xyXG5cdFx0cmV0dXJuIHRoaXMuaGlzdG9yeVt0aGlzLmhpc3RvcnkubGVuZ3RoICsgZGVsdGFdO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldFNsb3QoaW5kZXg6IG51bWJlcikge1xyXG5cdFx0cmV0dXJuIHRoaXMuYm9hcmRbaW5kZXhdO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHJlbmRlcigpIHtcclxuXHRcdGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLmJvYXJkLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcblx0XHRcdGxldCBzbG90ID0gdGhpcy5nZXRTbG90KGkpO1xyXG5cdFx0XHQkKFwidGQjY1wiICsgaSkudGV4dChzbG90LnF1YW50aXR5ICtcIiBcIisgc2xvdC5kZWR1Y3Rpb25bMF0pO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuXHJcbmNvbnN0IEdVRVNTX0RFTEFZID0gMjUwOyAvLyBtc1xyXG5jb25zdCBTTE9UX0NPVU5UID0gNjtcclxubGV0IHB1enpsZSA9IFB1enpsZURlbW8ucmFuZG9tKFNMT1RfQ09VTlQpO1xyXG4vL2xldCBodW1hbiA9IG5ldyBIdW1hblB1enpsZUludGVyZmFjZShTTE9UX0NPVU5UKTtcclxuU29sdmVyLnNvbHZlKHB1enpsZSk7Il19