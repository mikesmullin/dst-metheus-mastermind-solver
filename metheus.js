/// <reference path="node_modules/@types/jquery/index.d.ts" />
/// <reference path="node_modules/@types/lodash/index.d.ts" />
var DEBUG = true;
var Log = (function () {
    function Log() {
    }
    Log.out = function (msg) {
        $("<pre/>").text(msg + "\n").appendTo("#log");
    };
    Log.html = function (html) {
        $("<div/>").html(html).appendTo("#log");
    };
    return Log;
}());
var PuzzleDemo = (function () {
    function PuzzleDemo(solution) {
        this.solution = [];
        this.solution = solution;
        Log.out("Puzzle:\n" + solution.join("  "));
    }
    PuzzleDemo.random = function (length) {
        return new PuzzleDemo(_.shuffle(_.map(new Array(length), function (v, k) { return k + 1; })));
    };
    PuzzleDemo.prototype.getSlotCount = function () {
        return this.solution.length;
    };
    PuzzleDemo.prototype.test = function (board) {
        var count = 0;
        for (var i = 0, len = this.solution.length; i < len; i++) {
            var correct = board.slots[i].quantity == this.solution[i];
            if (correct)
                count++;
            if (DEBUG)
                board.debugViewCorrectSlots[i] = correct;
        }
        return count;
    };
    return PuzzleDemo;
}());
var HumanPuzzleInterface = (function () {
    function HumanPuzzleInterface(slotCount) {
        this.slotCount;
    }
    HumanPuzzleInterface.prototype.getSlotCount = function () {
        return this.slotCount;
    };
    HumanPuzzleInterface.prototype.test = function (board) {
        var answer;
        do {
            answer = parseInt(prompt("Please try:\n\t" + board + "\n\nHow many are correct?"), 10);
        } while (!isNaN(answer));
        return answer;
    };
    return HumanPuzzleInterface;
}());
var UNKNOWN = "UNKNOWN";
var NO = "NO";
var MAYBE = "MAYBE";
var YES = "YES";
var Swap = (function () {
    function Swap(a, b) {
        this.a = a;
        this.b = b;
    }
    return Swap;
}());
var Move = (function () {
    // new move based on copy of given board
    function Move(board, swap) {
        this.board = _.cloneDeep(board);
        if (null != swap) {
            var tmp = this.board.slots[swap.a];
            this.board.slots[swap.a] = this.board.slots[swap.b];
            this.board.slots[swap.b] = tmp;
            this.board.slots[swap.a].index = swap.a;
            this.board.slots[swap.b].index = swap.b;
            this.swap = swap;
        }
    }
    Move.prototype.render = function () {
        var s = "";
        for (var i = 0, len = this.board.slots.length; i < len; i++) {
            var slot = this.board.slots[i];
            var underline = (null != this.swap && (slot.quantity == this.board.slots[this.swap.a].quantity || slot.quantity == this.board.slots[this.swap.b].quantity));
            var bold = this.board.debugViewCorrectSlots[i];
            s += "" + (bold ? "<b>" : "") + (underline ? "<u>" : "") + slot.quantity + slot.deduction[0] + (underline ? "</u>" : "") + (bold ? "</b>" : "") + " ";
        }
        s += " = " + this.correct + " (" + (this.delta < 0 ? this.delta : "+" + this.delta) + ")";
        Log.html(s);
    };
    Move.prototype.score = function () {
        return this.correct + this.delta;
    };
    Move.prototype.getSwapA = function () {
        return this.board[this.swap.a];
    };
    Move.prototype.getSwapB = function () {
        return this.board[this.swap.b];
    };
    Move.prototype.isSwapDeduction = function (a, b) {
        return this.getSwapA().deduction == a &&
            this.getSwapB().deduction == b;
    };
    Move.rankInsert = function (root, move) {
        var parent = null;
        var current = move;
        while (true) {
            parent = current;
            if (move.score() < parent.score()) {
                current = parent.left;
                if (null == current) {
                    parent.left = move;
                    return;
                }
            }
            else {
                current = parent.right;
                if (null == current) {
                    parent.right = move;
                    return;
                }
            }
        }
    };
    // TODO: find the adjacent pair in given two moves
    // adj pair in two moves =
    // if move1 = a,b and move2 = b,c then ajc pair = a
    Move.copyMostValuableMove = function (root) {
        if (null == root)
            return null;
        var current = root;
        var lastHighScore = current;
        while (true) {
            if (current.score() > lastHighScore.score()) {
                current = current.left;
            }
            else {
                current = current.right;
            }
            if (null == current) {
                return _.cloneDeep(lastHighScore);
            }
        }
    };
    Move.havePlayedBefore = function (last, candidate) {
        var current = last;
        while (null != current) {
            if (Board.compare(current.board, candidate.board)) {
                return true;
            }
            current = current.prev;
        }
        return false;
    };
    return Move;
}());
var Slot = (function () {
    function Slot() {
    }
    Slot.prototype.setDeduction = function (deduction) {
        this.deduction = deduction;
        Log.out("          " + this.quantity + " " + this.deduction[0] + " => " + deduction[0] + (deduction == YES ? " FOUND" : ""));
    };
    Slot.prototype.toString = function () {
        return this.quantity;
    };
    return Slot;
}());
var Board = (function () {
    function Board(slots) {
        this.debugViewCorrectSlots = [];
        this.slots = slots;
    }
    Board.prototype.findAll = function (fn) {
        return _.filter(this.slots, fn);
    };
    Board.prototype.findOne = function (fn) {
        return this.findAll(fn)[0];
    };
    Board.compare = function (a, b) {
        if (a.slots.length != b.slots.length)
            return false;
        for (var i = 0, len = a.slots.length; i < len; i++) {
            if (a.slots[i].quantity != b.slots[i].quantity) {
                return false;
            }
        }
        return true;
    };
    Board.prototype.render = function () {
        for (var i = 0, len = this.slots.length; i < len; i++) {
            $("td#c" + i).text(this.slots[i].quantity + " " + this.slots[i].deduction[0]);
        }
    };
    Board.prototype.toString = function () {
        return this.slots.join(" ");
    };
    return Board;
}());
var Solver = (function () {
    function Solver(puzzle) {
        this.moves = 0;
        this.puzzle = puzzle;
        // begin with opening move
        this.rootMove = new Move(new Board(_.map(new Array(this.puzzle.getSlotCount()), function (nil, i) {
            var slot = new Slot();
            slot.index = i;
            slot.quantity = i + 1;
            slot.deduction = UNKNOWN;
            return slot;
        })));
        this.playMove(this.rootMove);
    }
    Solver.prototype.playMove = function (move) {
        // sequence move into play
        move.num = ++this.moves;
        move.prev = this.lastMove;
        this.lastMove = move;
        // test and score the move
        move.correct = this.puzzle.test(move.board);
        move.delta = move.correct - (null != move ? move.correct || 0 : 0);
        if (this.moves > MAX_GUESSES) {
            Log.out("Too many guesses; we lose.");
            return;
        }
        if (null != move.swap) {
            // apply swap deductions
            if (move.delta == 0) {
                // no difference; both must be NO
                move.getSwapA().setDeduction(NO);
                move.getSwapB().setDeduction(NO);
            }
            else if (move.delta == 1) {
                // difference; one is now right, but we don't know which
                move.getSwapA().setDeduction(MAYBE);
                move.getSwapB().setDeduction(MAYBE);
            }
            else if (move.delta == 2) {
                // very positive difference; both are now right for sure
                move.getSwapA().setDeduction(YES);
                move.getSwapB().setDeduction(YES);
            }
            else if (move.delta == -1) {
                // difference; one was right, but we don't know which
                move.getSwapA().setDeduction(MAYBE);
                move.getSwapB().setDeduction(MAYBE);
            }
            else if (move.delta == -2) {
                // difference; both were right for sure
                move.getSwapA().setDeduction(YES);
                move.getSwapB().setDeduction(YES);
            }
        }
        Move.rankInsert(this.rootMove, move);
        // update user view
        move.board.render();
        move.render();
        if (move.correct == this.puzzle.getSlotCount()) {
            Log.out("You win in " + this.moves + " moves.");
            return;
        }
        this.decide();
    };
    Solver.prototype.decide = function () {
        var _this = this;
        // decide what to do next
        var nextMove;
        if (1 === this.moves) {
            // just play a swap of the first two positions
            nextMove = new Move(this.lastMove.board, new Swap(0, 1));
        }
        else {
            var move = Move.copyMostValuableMove(this.rootMove);
            // try a unique new swap
            do {
                // if the previous swap was M,M or N,N
                if ((move.isSwapDeduction(MAYBE, MAYBE) ||
                    move.isSwapDeduction(NO, NO))) {
                }
                // it should reuse A from the previous move
                // unless that resulted in a no change or unexpected gain
                // in which case it should now reuse B from two moves ago
            } while (Move.havePlayedBefore(this.lastMove, move));
        }
        setTimeout(function () { return _this.playMove(nextMove); }, GUESS_DELAY);
    };
    return Solver;
}());
var GUESS_DELAY = 50; // ms
var MAX_GUESSES = 99;
var SLOT_COUNT = 6;
var puzzle;
if (DEBUG) {
    //puzzle = PuzzleDemo.random(SLOT_COUNT);
    puzzle = new PuzzleDemo([2, 3, 4, 1, 6, 5]);
    //puzzle = new PuzzleDemo([2, 4, 6, 1, 5, 3]);
    //puzzle = new PuzzleDemo([2, 1, 5, 6, 3, 4]);
    // TODO: try a puzzle where numbers can repeat
}
else {
    puzzle = new HumanPuzzleInterface(SLOT_COUNT);
}
new Solver(puzzle);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0aGV1cy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1ldGhldXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsOERBQThEO0FBQzlELDhEQUE4RDtBQUU5RCxJQUFNLEtBQUssR0FBRyxJQUFJLENBQUM7QUFFbkI7SUFBQTtJQU9BLENBQUM7SUFOYyxPQUFHLEdBQWpCLFVBQWtCLEdBQVc7UUFDNUIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBSSxHQUFHLE9BQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMvQyxDQUFDO0lBQ2EsUUFBSSxHQUFsQixVQUFtQixJQUFZO1FBQzlCLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFDRixVQUFDO0FBQUQsQ0FBQyxBQVBELElBT0M7QUFPRDtJQUdDLG9CQUFtQixRQUFrQjtRQUY3QixhQUFRLEdBQWEsRUFBRSxDQUFDO1FBRy9CLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBQ3pCLEdBQUcsQ0FBQyxHQUFHLENBQUMsY0FBWSxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBRyxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUVhLGlCQUFNLEdBQXBCLFVBQXFCLE1BQWM7UUFDbEMsTUFBTSxDQUFDLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FDcEMsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUUsVUFBVSxDQUFDLEVBQUUsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzFELENBQUM7SUFFTSxpQ0FBWSxHQUFuQjtRQUNDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FB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Q0FBQztJQUNGLENBQUM7SUFFTSxxQkFBTSxHQUFiO1FBQ0MsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ1gsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQzdELElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQy9CLElBQUksU0FBUyxHQUFHLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBQzVKLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0MsQ0FBQyxJQUFJLE1BQUcsSUFBSSxHQUFHLEtBQUssR0FBRyxFQUFFLEtBQUcsU0FBUyxHQUFHLEtBQUssR0FBRyxFQUFFLElBQUcsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFHLFNBQVMsR0FBRyxNQUFNLEdBQUcsRUFBRSxLQUFHLElBQUksR0FBRyxNQUFNLEdBQUcsRUFBRSxPQUFHLENBQUM7UUFDMUksQ0FBQztRQUNELENBQUMsSUFBSSxRQUFNLElBQUksQ0FBQyxPQUFPLFdBQUssSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssR0FBRyxNQUFJLElB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QUN2QyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQztZQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDbkQsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDcEQsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUNoRCxNQUFNLENBQUMsS0FBSyxDQUFDO1lBQ2QsQ0FBQztRQUNGLENBQUM7UUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2IsQ0FBQztJQUVNLHNCQUFNLEdBQWI7UUFDQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUN2RCxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMvRSxDQUFDO0lBQ0YsQ0FBQztJQUVNLHdCQUFRLEdBQWY7UUFDQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUNGLFlBQUM7QUFBRCxDQUFDLEFBbkNELElBbUNDO0FBRUQ7SUFNQyxnQkFB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O0lBQzlDLDhDQUE4QztBQUMvQyxDQUFDO0FBQ0QsSUFBSSxDQUFDLENBQUM7SUFDTCxNQUFNLEdBQUcsSUFBSSxvQkFBb0IsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUMvQyxDQUFDO0FBQ0QsSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwibm9kZV9tb2R1bGVzL0B0eXBlcy9qcXVlcnkvaW5kZXguZC50c1wiIC8+XHJcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJub2RlX21vZHVsZXMvQHR5cGVzL2xvZGFzaC9pbmRleC5kLnRzXCIgLz5cclxuXHJcbmNvbnN0IERFQlVHID0gdHJ1ZTtcclxuXHJcbmNsYXNzIExvZyB7XHJcblx0cHVibGljIHN0YXRpYyBvdXQobXNnOiBzdHJpbmcpIHtcclxuXHRcdCQoXCI8cHJlLz5cIikudGV4dChgJHttc2d9XFxuYCkuYXBwZW5kVG8oXCIjbG9nXCIpO1xyXG5cdH1cclxuXHRwdWJsaWMgc3RhdGljIGh0bWwoaHRtbDogc3RyaW5nKSB7XHJcblx0XHQkKFwiPGRpdi8+XCIpLmh0bWwoaHRtbCkuYXBwZW5kVG8oXCIjbG9nXCIpO1xyXG5cdH1cclxufVxyXG5cclxuaW50ZXJmYWNlIFB1enpsZSB7XHJcblx0dGVzdChib2FyZDogQm9hcmQpOiBudW1iZXI7XHJcblx0Z2V0U2xvdENvdW50KCk6IG51bWJlcjtcclxufVxyXG5cclxuY2xhc3MgUHV6emxlRGVtbyBpbXBsZW1lbnRzIFB1enpsZSB7XHJcblx0cHJpdmF0ZSBzb2x1dGlvbjogbnVtYmVyW10gPSBbXTtcclxuXHJcblx0cHVibGljIGNvbnN0cnVjdG9yKHNvbHV0aW9uOiBudW1iZXJbXSkge1xyXG5cdFx0dGhpcy5zb2x1dGlvbiA9IHNvbHV0aW9uO1xyXG5cdFx0TG9nLm91dChgUHV6emxlOlxcbiR7c29sdXRpb24uam9pbihcIiAgXCIpfWApO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHN0YXRpYyByYW5kb20obGVuZ3RoOiBudW1iZXIpOiBQdXp6bGUge1xyXG5cdFx0cmV0dXJuIG5ldyBQdXp6bGVEZW1vKF8uc2h1ZmZsZShfLm1hcChcclxuXHRcdFx0bmV3IEFycmF5KGxlbmd0aCksIGZ1bmN0aW9uICh2LCBrKSB7IHJldHVybiBrICsgMTsgfSkpKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBnZXRTbG90Q291bnQoKTogbnVtYmVyIHtcclxuXHRcdHJldHVybiB0aGlzLnNvbHV0aW9uLmxlbmd0aDtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyB0ZXN0KGJvYXJkOiBCb2FyZCk6IG51bWJlciB7XHJcblx0XHRsZXQgY291bnQgPSAwO1xyXG5cdFx0Zm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuc29sdXRpb24ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0bGV0IGNvcnJlY3QgPSBib2FyZC5zbG90c1tpXS5xdWFudGl0eSA9PSB0aGlzLnNvbHV0aW9uW2ldO1xyXG5cdFx0XHRpZiAoY29ycmVjdCkgY291bnQrKztcclxuXHRcdFx0aWYgKERFQlVHKSBib2FyZC5kZWJ1Z1ZpZXdDb3JyZWN0U2xvdHNbaV0gPSBjb3JyZWN0O1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGNvdW50O1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgSHVtYW5QdXp6bGVJbnRlcmZhY2UgaW1wbGVtZW50cyBQdXp6bGUge1xyXG5cdHByaXZhdGUgc2xvdENvdW50OiBudW1iZXI7XHJcblxyXG5cdHB1YmxpYyBjb25zdHJ1Y3RvcihzbG90Q291bnQ6IG51bWJlcikge1xyXG5cdFx0dGhpcy5zbG90Q291bnQ7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0U2xvdENvdW50KCk6IG51bWJlciB7XHJcblx0XHRyZXR1cm4gdGhpcy5zbG90Q291bnQ7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgdGVzdChib2FyZDogQm9hcmQpOiBudW1iZXIge1xyXG5cdFx0bGV0IGFuc3dlcjtcclxuXHRcdGRvIHtcclxuXHRcdFx0YW5zd2VyID0gcGFyc2VJbnQocHJvbXB0KFxyXG5cdFx0XHRcdGBQbGVhc2UgdHJ5OlxcblxcdCR7Ym9hcmR9XFxuXFxuSG93IG1hbnkgYXJlIGNvcnJlY3Q/YCksIDEwKTtcclxuXHRcdH1cclxuXHRcdHdoaWxlICghaXNOYU4oYW5zd2VyKSk7XHJcblx0XHRyZXR1cm4gYW5zd2VyO1xyXG5cdH1cclxufVxyXG5cclxudHlwZSBEZWR1Y3Rpb24gPSBcIlVOS05PV05cIiB8IFwiTk9cIiB8IFwiTUFZQkVcIiB8IFwiWUVTXCI7XHJcbmNvbnN0IFVOS05PV04gPSBcIlVOS05PV05cIjtcclxuY29uc3QgTk8gPSBcIk5PXCI7XHJcbmNvbnN0IE1BWUJFID0gXCJNQVlCRVwiO1xyXG5jb25zdCBZRVMgPSBcIllFU1wiO1xyXG5cclxuY2xhc3MgU3dhcCB7XHJcblx0cHVibGljIGE6IG51bWJlcjtcclxuXHRwdWJsaWMgYjogbnVtYmVyO1xyXG5cclxuXHRwdWJsaWMgY29uc3RydWN0b3IoYTogbnVtYmVyLCBiOiBudW1iZXIpIHtcclxuXHRcdHRoaXMuYSA9IGE7XHJcblx0XHR0aGlzLmIgPSBiO1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgTW92ZSB7XHJcblx0cHVibGljIG51bTogbnVtYmVyO1xyXG5cdHB1YmxpYyBib2FyZDogQm9hcmQ7XHJcblx0cHVibGljIGNvcnJlY3Q6IG51bWJlcjsgLy8gc2NvcmVcclxuXHRwdWJsaWMgZGVsdGE6IG51bWJlcjsgLy8gc2NvcmVcclxuXHRwdWJsaWMgcHJldj86IE1vdmU7IC8vIHBsYXkgc2VxdWVuY2VcclxuXHRwdWJsaWMgc3dhcD86IFN3YXA7XHJcblx0cHJpdmF0ZSBsZWZ0OiBNb3ZlOyAvLyBic3RcclxuXHRwcml2YXRlIHJpZ2h0OiBNb3ZlOyAvLyBic3RcclxuXHJcblx0Ly8gbmV3IG1vdmUgYmFzZWQgb24gY29weSBvZiBnaXZlbiBib2FyZFxyXG5cdHB1YmxpYyBjb25zdHJ1Y3Rvcihib2FyZDogQm9hcmQsIHN3YXA/OiBTd2FwKSB7XHJcblx0XHR0aGlzLmJvYXJkID0gXy5jbG9uZURlZXAoYm9hcmQpO1xyXG5cdFx0aWYgKG51bGwgIT0gc3dhcCkge1xyXG5cdFx0XHRsZXQgdG1wID0gdGhpcy5ib2FyZC5zbG90c1tzd2FwLmFdO1xyXG5cdFx0XHR0aGlzLmJvYXJkLnNsb3RzW3N3YXAuYV0gPSB0aGlzLmJvYXJkLnNsb3RzW3N3YXAuYl07XHJcblx0XHRcdHRoaXMuYm9hcmQuc2xvdHNbc3dhcC5iXSA9IHRtcDtcclxuXHRcdFx0dGhpcy5ib2FyZC5zbG90c1tzd2FwLmFdLmluZGV4ID0gc3dhcC5hO1xyXG5cdFx0XHR0aGlzLmJvYXJkLnNsb3RzW3N3YXAuYl0uaW5kZXggPSBzd2FwLmI7XHJcblx0XHRcdHRoaXMuc3dhcCA9IHN3YXA7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgcmVuZGVyKCkge1xyXG5cdFx0bGV0IHMgPSBcIlwiO1xyXG5cdFx0Zm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuYm9hcmQuc2xvdHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0bGV0IHNsb3QgPSB0aGlzLmJvYXJkLnNsb3RzW2ldO1xyXG5cdFx0XHRsZXQgdW5kZXJsaW5lID0gKG51bGwgIT0gdGhpcy5zd2FwICYmIChzbG90LnF1YW50aXR5ID09IHRoaXMuYm9hcmQuc2xvdHNbdGhpcy5zd2FwLmFdLnF1YW50aXR5IHx8IHNsb3QucXVhbnRpdHkgPT0gdGhpcy5ib2FyZC5zbG90c1t0aGlzLnN3YXAuYl0ucXVhbnRpdHkpKTtcclxuXHRcdFx0bGV0IGJvbGQgPSB0aGlzLmJvYXJkLmRlYnVnVmlld0NvcnJlY3RTbG90c1tpXTtcclxuXHRcdFx0cyArPSBgJHtib2xkID8gXCI8Yj5cIiA6IFwiXCJ9JHt1bmRlcmxpbmUgPyBcIjx1PlwiIDogXCJcIn0ke3Nsb3QucXVhbnRpdHl9JHtzbG90LmRlZHVjdGlvblswXX0ke3VuZGVybGluZSA/IFwiPC91PlwiIDogXCJcIn0ke2JvbGQgPyBcIjwvYj5cIiA6IFwiXCJ9IGA7XHJcblx0XHR9XHJcblx0XHRzICs9IGAgPSAke3RoaXMuY29ycmVjdH0gKCR7dGhpcy5kZWx0YSA8IDAgPyB0aGlzLmRlbHRhIDogYCske3RoaXMuZGVsdGF9YH0pYDtcclxuXHRcdExvZy5odG1sKHMpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHNjb3JlKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuY29ycmVjdCArIHRoaXMuZGVsdGE7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0U3dhcEEoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5ib2FyZFt0aGlzLnN3YXAuYV07XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0U3dhcEIoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5ib2FyZFt0aGlzLnN3YXAuYl07XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgaXNTd2FwRGVkdWN0aW9uKGE6IERlZHVjdGlvbiwgYjogRGVkdWN0aW9uKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5nZXRTd2FwQSgpLmRlZHVjdGlvbiA9PSBhICYmXHJcblx0XHRcdHRoaXMuZ2V0U3dhcEIoKS5kZWR1Y3Rpb24gPT0gYjtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzdGF0aWMgcmFua0luc2VydChyb290OiBNb3ZlLCBtb3ZlOiBNb3ZlKSB7XHJcblx0XHRsZXQgcGFyZW50OiBNb3ZlID0gbnVsbDtcclxuXHRcdGxldCBjdXJyZW50ID0gbW92ZTtcclxuXHRcdHdoaWxlICh0cnVlKSB7XHJcblx0XHRcdHBhcmVudCA9IGN1cnJlbnQ7XHJcblx0XHRcdGlmIChtb3ZlLnNjb3JlKCkgPCBwYXJlbnQuc2NvcmUoKSkge1xyXG5cdFx0XHRcdGN1cnJlbnQgPSBwYXJlbnQubGVmdDtcclxuXHRcdFx0XHRpZiAobnVsbCA9PSBjdXJyZW50KSB7XHJcblx0XHRcdFx0XHRwYXJlbnQubGVmdCA9IG1vdmU7XHJcblx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdGN1cnJlbnQgPSBwYXJlbnQucmlnaHQ7XHJcblx0XHRcdFx0aWYgKG51bGwgPT0gY3VycmVudCkge1xyXG5cdFx0XHRcdFx0cGFyZW50LnJpZ2h0ID0gbW92ZTtcclxuXHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8vIFRPRE86IGZpbmQgdGhlIGFkamFjZW50IHBhaXIgaW4gZ2l2ZW4gdHdvIG1vdmVzXHJcblx0Ly8gYWRqIHBhaXIgaW4gdHdvIG1vdmVzID1cclxuXHQvLyBpZiBtb3ZlMSA9IGEsYiBhbmQgbW92ZTIgPSBiLGMgdGhlbiBhamMgcGFpciA9IGFcclxuXHJcblx0cHVibGljIHN0YXRpYyBjb3B5TW9zdFZhbHVhYmxlTW92ZShyb290OiBNb3ZlKTogTW92ZSB7XHJcblx0XHRpZiAobnVsbCA9PSByb290KSByZXR1cm4gbnVsbDtcclxuXHRcdGxldCBjdXJyZW50ID0gcm9vdDtcclxuXHRcdGxldCBsYXN0SGlnaFNjb3JlID0gY3VycmVudDtcclxuXHRcdHdoaWxlICh0cnVlKSB7XHJcblx0XHRcdGlmIChjdXJyZW50LnNjb3JlKCkgPiBsYXN0SGlnaFNjb3JlLnNjb3JlKCkpIHtcclxuXHRcdFx0XHRjdXJyZW50ID0gY3VycmVudC5sZWZ0O1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdGN1cnJlbnQgPSBjdXJyZW50LnJpZ2h0O1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChudWxsID09IGN1cnJlbnQpIHtcclxuXHRcdFx0XHRyZXR1cm4gXy5jbG9uZURlZXAobGFzdEhpZ2hTY29yZSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzdGF0aWMgaGF2ZVBsYXllZEJlZm9yZShsYXN0OiBNb3ZlLCBjYW5kaWRhdGU6IE1vdmUpOiBib29sZWFuIHtcclxuXHRcdGxldCBjdXJyZW50ID0gbGFzdDtcclxuXHRcdHdoaWxlIChudWxsICE9IGN1cnJlbnQpIHtcclxuXHRcdFx0aWYgKEJvYXJkLmNvbXBhcmUoY3VycmVudC5ib2FyZCwgY2FuZGlkYXRlLmJvYXJkKSkge1xyXG5cdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHRcdGN1cnJlbnQgPSBjdXJyZW50LnByZXY7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gZmFsc2U7XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBTbG90IHtcclxuXHRwdWJsaWMgaW5kZXg6IG51bWJlcjtcclxuXHRwdWJsaWMgcXVhbnRpdHk6IG51bWJlcjtcclxuXHRwdWJsaWMgZGVkdWN0aW9uOiBEZWR1Y3Rpb247XHJcblxyXG5cdHB1YmxpYyBzZXREZWR1Y3Rpb24oZGVkdWN0aW9uOiBEZWR1Y3Rpb24pIHtcclxuXHRcdHRoaXMuZGVkdWN0aW9uID0gZGVkdWN0aW9uO1xyXG5cdFx0TG9nLm91dChgICAgICAgICAgICR7dGhpcy5xdWFudGl0eX0gJHt0aGlzLmRlZHVjdGlvblswXX0gPT4gJHtkZWR1Y3Rpb25bMF19JHtkZWR1Y3Rpb24gPT0gWUVTID8gXCIgRk9VTkRcIiA6IFwiXCJ9YCk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgdG9TdHJpbmcoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5xdWFudGl0eTtcclxuXHR9XHJcbn1cclxuXHJcblxyXG5jbGFzcyBCb2FyZCB7XHJcblx0cHVibGljIHNsb3RzOiBTbG90W107XHJcblx0cHVibGljIGRlYnVnVmlld0NvcnJlY3RTbG90czogYm9vbGVhbltdID0gW107XHJcblxyXG5cdHB1YmxpYyBjb25zdHJ1Y3RvcihzbG90czogU2xvdFtdKSB7XHJcblx0XHR0aGlzLnNsb3RzID0gc2xvdHM7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZmluZEFsbChmbikge1xyXG5cdFx0cmV0dXJuIF8uZmlsdGVyKHRoaXMuc2xvdHMsIGZuKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBmaW5kT25lKGZuKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5maW5kQWxsKGZuKVswXTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzdGF0aWMgY29tcGFyZShhOiBCb2FyZCwgYjogQm9hcmQpIHtcclxuXHRcdGlmIChhLnNsb3RzLmxlbmd0aCAhPSBiLnNsb3RzLmxlbmd0aCkgcmV0dXJuIGZhbHNlO1xyXG5cdFx0Zm9yIChsZXQgaSA9IDAsIGxlbiA9IGEuc2xvdHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0aWYgKGEuc2xvdHNbaV0ucXVhbnRpdHkgIT0gYi5zbG90c1tpXS5xdWFudGl0eSkge1xyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHRydWU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgcmVuZGVyKCkge1xyXG5cdFx0Zm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuc2xvdHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0JChcInRkI2NcIiArIGkpLnRleHQodGhpcy5zbG90c1tpXS5xdWFudGl0eSArIFwiIFwiICsgdGhpcy5zbG90c1tpXS5kZWR1Y3Rpb25bMF0pO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0cHVibGljIHRvU3RyaW5nKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuc2xvdHMuam9pbihcIiBcIik7XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBTb2x2ZXIge1xyXG5cdHByaXZhdGUgcHV6emxlOiBQdXp6bGU7XHJcblx0cHJpdmF0ZSBtb3ZlczogbnVtYmVyID0gMDtcclxuXHRwdWJsaWMgcm9vdE1vdmU6IE1vdmU7IC8vIHJvb3QgQlNUIG5vZGVcclxuXHRwdWJsaWMgbGFzdE1vdmU6IE1vdmU7IC8vIGhpc3Rvcnkgb2YgcGxheWVkIG1vdmVzXHJcblxyXG5cdHB1YmxpYyBjb25zdHJ1Y3RvcihwdXp6bGU6IFB1enpsZSkge1xyXG5cdFx0dGhpcy5wdXp6bGUgPSBwdXp6bGU7XHJcblxyXG5cdFx0Ly8gYmVnaW4gd2l0aCBvcGVuaW5nIG1vdmVcclxuXHRcdHRoaXMucm9vdE1vdmUgPSBuZXcgTW92ZShuZXcgQm9hcmQoXy5tYXAoXHJcblx0XHRcdG5ldyBBcnJheSh0aGlzLnB1enpsZS5nZXRTbG90Q291bnQoKSksXHJcblx0XHRcdChuaWwsIGkpID0+IHtcclxuXHRcdFx0XHRsZXQgc2xvdCA9IG5ldyBTbG90KCk7XHJcblx0XHRcdFx0c2xvdC5pbmRleCA9IGk7XHJcblx0XHRcdFx0c2xvdC5xdWFudGl0eSA9IGkgKyAxO1xyXG5cdFx0XHRcdHNsb3QuZGVkdWN0aW9uID0gVU5LTk9XTjtcclxuXHRcdFx0XHRyZXR1cm4gc2xvdDtcclxuXHRcdFx0fSkpKTtcclxuXHRcdHRoaXMucGxheU1vdmUodGhpcy5yb290TW92ZSk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgcGxheU1vdmUobW92ZTogTW92ZSkge1xyXG5cdFx0Ly8gc2VxdWVuY2UgbW92ZSBpbnRvIHBsYXlcclxuXHRcdG1vdmUubnVtID0gKyt0aGlzLm1vdmVzO1xyXG5cdFx0bW92ZS5wcmV2ID0gdGhpcy5sYXN0TW92ZTtcclxuXHRcdHRoaXMubGFzdE1vdmUgPSBtb3ZlO1xyXG5cclxuXHRcdC8vIHRlc3QgYW5kIHNjb3JlIHRoZSBtb3ZlXHJcblx0XHRtb3ZlLmNvcnJlY3QgPSB0aGlzLnB1enpsZS50ZXN0KG1vdmUuYm9hcmQpO1xyXG5cdFx0bW92ZS5kZWx0YSA9IG1vdmUuY29ycmVjdCAtIChudWxsICE9IG1vdmUgPyBtb3ZlLmNvcnJlY3QgfHwgMCA6IDApO1xyXG5cdFx0aWYgKHRoaXMubW92ZXMgPiBNQVhfR1VFU1NFUykge1xyXG5cdFx0XHRMb2cub3V0KFwiVG9vIG1hbnkgZ3Vlc3Nlczsgd2UgbG9zZS5cIik7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdGlmIChudWxsICE9IG1vdmUuc3dhcCkge1xyXG5cdFx0XHQvLyBhcHBseSBzd2FwIGRlZHVjdGlvbnNcclxuXHRcdFx0aWYgKG1vdmUuZGVsdGEgPT0gMCkge1xyXG5cdFx0XHRcdC8vIG5vIGRpZmZlcmVuY2U7IGJvdGggbXVzdCBiZSBOT1xyXG5cdFx0XHRcdG1vdmUuZ2V0U3dhcEEoKS5zZXREZWR1Y3Rpb24oTk8pO1xyXG5cdFx0XHRcdG1vdmUuZ2V0U3dhcEIoKS5zZXREZWR1Y3Rpb24oTk8pO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKG1vdmUuZGVsdGEgPT0gMSkge1xyXG5cdFx0XHRcdC8vIGRpZmZlcmVuY2U7IG9uZSBpcyBub3cgcmlnaHQsIGJ1dCB3ZSBkb24ndCBrbm93IHdoaWNoXHJcblx0XHRcdFx0bW92ZS5nZXRTd2FwQSgpLnNldERlZHVjdGlvbihNQVlCRSk7XHJcblx0XHRcdFx0bW92ZS5nZXRTd2FwQigpLnNldERlZHVjdGlvbihNQVlCRSk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAobW92ZS5kZWx0YSA9PSAyKSB7XHJcblx0XHRcdFx0Ly8gdmVyeSBwb3NpdGl2ZSBkaWZmZXJlbmNlOyBib3RoIGFyZSBub3cgcmlnaHQgZm9yIHN1cmVcclxuXHRcdFx0XHRtb3ZlLmdldFN3YXBBKCkuc2V0RGVkdWN0aW9uKFlFUyk7XHJcblx0XHRcdFx0bW92ZS5nZXRTd2FwQigpLnNldERlZHVjdGlvbihZRVMpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKG1vdmUuZGVsdGEgPT0gLTEpIHtcclxuXHRcdFx0XHQvLyBkaWZmZXJlbmNlOyBvbmUgd2FzIHJpZ2h0LCBidXQgd2UgZG9uJ3Qga25vdyB3aGljaFxyXG5cdFx0XHRcdG1vdmUuZ2V0U3dhcEEoKS5zZXREZWR1Y3Rpb24oTUFZQkUpO1xyXG5cdFx0XHRcdG1vdmUuZ2V0U3dhcEIoKS5zZXREZWR1Y3Rpb24oTUFZQkUpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKG1vdmUuZGVsdGEgPT0gLTIpIHtcclxuXHRcdFx0XHQvLyBkaWZmZXJlbmNlOyBib3RoIHdlcmUgcmlnaHQgZm9yIHN1cmVcclxuXHRcdFx0XHRtb3ZlLmdldFN3YXBBKCkuc2V0RGVkdWN0aW9uKFlFUyk7XHJcblx0XHRcdFx0bW92ZS5nZXRTd2FwQigpLnNldERlZHVjdGlvbihZRVMpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRNb3ZlLnJhbmtJbnNlcnQodGhpcy5yb290TW92ZSwgbW92ZSk7XHJcblxyXG5cdFx0Ly8gdXBkYXRlIHVzZXIgdmlld1xyXG5cdFx0bW92ZS5ib2FyZC5yZW5kZXIoKTtcclxuXHRcdG1vdmUucmVuZGVyKCk7XHJcblx0XHRpZiAobW92ZS5jb3JyZWN0ID09IHRoaXMucHV6emxlLmdldFNsb3RDb3VudCgpKSB7XHJcblx0XHRcdExvZy5vdXQoYFlvdSB3aW4gaW4gJHt0aGlzLm1vdmVzfSBtb3Zlcy5gKTtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuZGVjaWRlKCk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZGVjaWRlKCkge1xyXG5cdFx0Ly8gZGVjaWRlIHdoYXQgdG8gZG8gbmV4dFxyXG5cdFx0bGV0IG5leHRNb3ZlOiBNb3ZlO1xyXG5cdFx0aWYgKDEgPT09IHRoaXMubW92ZXMpIHsgLy8gZm9sbG93LXVwIHRvIGZpcnN0IG1vdmVcclxuXHRcdFx0Ly8ganVzdCBwbGF5IGEgc3dhcCBvZiB0aGUgZmlyc3QgdHdvIHBvc2l0aW9uc1xyXG5cdFx0XHRuZXh0TW92ZSA9IG5ldyBNb3ZlKHRoaXMubGFzdE1vdmUuYm9hcmQsIG5ldyBTd2FwKDAsIDEpKTtcclxuXHRcdH1cclxuXHRcdGVsc2UgeyAvLyBzdWJzZXF1ZW50IG1vdmVzXHJcblx0XHRcdGxldCBtb3ZlID0gTW92ZS5jb3B5TW9zdFZhbHVhYmxlTW92ZSh0aGlzLnJvb3RNb3ZlKTtcclxuXHRcdFx0Ly8gdHJ5IGEgdW5pcXVlIG5ldyBzd2FwXHJcblx0XHRcdGRvIHtcclxuXHRcdFx0XHQvLyBpZiB0aGUgcHJldmlvdXMgc3dhcCB3YXMgTSxNIG9yIE4sTlxyXG5cdFx0XHRcdGlmIChcclxuXHRcdFx0XHRcdChtb3ZlLmlzU3dhcERlZHVjdGlvbihNQVlCRSwgTUFZQkUpIHx8XHJcblx0XHRcdFx0XHRcdG1vdmUuaXNTd2FwRGVkdWN0aW9uKE5PLCBOTykpXHJcblx0XHRcdFx0KSB7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Ly8gaXQgc2hvdWxkIHJldXNlIEEgZnJvbSB0aGUgcHJldmlvdXMgbW92ZVxyXG5cdFx0XHRcdC8vIHVubGVzcyB0aGF0IHJlc3VsdGVkIGluIGEgbm8gY2hhbmdlIG9yIHVuZXhwZWN0ZWQgZ2FpblxyXG5cdFx0XHRcdC8vIGluIHdoaWNoIGNhc2UgaXQgc2hvdWxkIG5vdyByZXVzZSBCIGZyb20gdHdvIG1vdmVzIGFnb1xyXG5cdFx0XHR9XHJcblx0XHRcdHdoaWxlIChNb3ZlLmhhdmVQbGF5ZWRCZWZvcmUodGhpcy5sYXN0TW92ZSwgbW92ZSkpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHNldFRpbWVvdXQoKCkgPT4gdGhpcy5wbGF5TW92ZShuZXh0TW92ZSksIEdVRVNTX0RFTEFZKTtcclxuXHR9XHJcblxyXG5cdC8vIC8vIGRldGVybWluZSB3aGV0aGVyIGEgcXVhbnRpdHkgaGFzIGV2ZXIgaGFkIGEgZ2l2ZW4gZGVkdWN0aW9uIGF0IGEgc3BlY2lmaWMgaW5kZXggaW4gZW50aXJlIGhpc3RvcnlcclxuXHQvLyBwdWJsaWMgaGFkRGVkdWN0aW9uQXRJbmRleChxdWFudGl0eTogbnVtYmVyLCBpbmRleDogbnVtYmVyLCBkZWR1Y3Rpb246IERlZHVjdGlvbik6IGJvb2xlYW4ge1xyXG5cdC8vIFx0d2hpbGUgKG51bGwgIT0gdGhpcy5sYXN0TW92ZS5zd2FwKSB7XHJcblx0Ly8gXHRcdGxldCBwYWlyID0gdGhpcy5sYXN0TW92ZS5zd2FwO1xyXG5cdC8vIFx0XHRpZiAoXHJcblx0Ly8gXHRcdFx0KHBhaXIuYS5xdWFudGl0eSA9PSBxdWFudGl0eSAmJlxyXG5cdC8vIFx0XHRcdFx0cGFpci5hLmRlZHVjdGlvbiA9PSBkZWR1Y3Rpb24gJiZcclxuXHQvLyBcdFx0XHRcdHBhaXIuYS5pbmRleCA9PSBpbmRleCkgfHxcclxuXHQvLyBcdFx0XHQocGFpci5iLnF1YW50aXR5ID09IHF1YW50aXR5ICYmXHJcblx0Ly8gXHRcdFx0XHRwYWlyLmIuZGVkdWN0aW9uID09IGRlZHVjdGlvbiAmJlxyXG5cdC8vIFx0XHRcdFx0cGFpci5iLmluZGV4ID09IGluZGV4KVxyXG5cdC8vIFx0XHQpIHtcclxuXHQvLyBcdFx0XHRMb2cub3V0KGAke3F1YW50aXR5fSBpbmRleCAke2luZGV4fSBkZWR1Y3Rpb24gJHtkZWR1Y3Rpb25bMF19IGhhcHBlbmVkIGJlZm9yZSBhdCBtb3ZlICR7dGhpcy5sYXN0TW92ZS5udW19YCk7XHJcblx0Ly8gXHRcdFx0cmV0dXJuIHRydWU7XHJcblx0Ly8gXHRcdH1cclxuXHQvLyBcdFx0dGhpcy5sYXN0TW92ZSA9IHRoaXMubGFzdE1vdmUucHJldjtcclxuXHQvLyBcdH1cclxuXHQvLyBcdHJldHVybiBmYWxzZTtcclxuXHQvLyB9XHJcblxyXG5cdC8vIHB1YmxpYyBhbHJlYWR5VHJpZWQocTE6IG51bWJlciwgaTE6IG51bWJlciwgcTI6IG51bWJlciwgaTI6IG51bWJlcik6IGJvb2xlYW4ge1xyXG5cdC8vIFx0d2hpbGUgKG51bGwgIT0gdGhpcy5sYXN0TW92ZS5zd2FwKSB7XHJcblx0Ly8gXHRcdGxldCBwYWlyID0gdGhpcy5sYXN0TW92ZS5zd2FwO1xyXG5cdC8vIFx0XHRpZiAoXHJcblx0Ly8gXHRcdFx0KHBhaXIuYS5xdWFudGl0eSA9PSBxMSAmJlxyXG5cdC8vIFx0XHRcdFx0cGFpci5hLmluZGV4ID09IGkxKSB8fFxyXG5cdC8vIFx0XHRcdChwYWlyLmIucXVhbnRpdHkgPT0gcTIgJiZcclxuXHQvLyBcdFx0XHRcdHBhaXIuYi5pbmRleCA9PSBpMilcclxuXHQvLyBcdFx0KSB7XHJcblx0Ly8gXHRcdFx0TG9nLm91dChgJHtxMX06JHtpMX0sJHtxMn06JHtpMn0gaGFwcGVuZWQgYmVmb3JlIGF0IG1vdmUgJHt0aGlzLmxhc3RNb3ZlLm51bX1gKTtcclxuXHQvLyBcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHQvLyBcdFx0fVxyXG5cdC8vIFx0XHR0aGlzLmxhc3RNb3ZlID0gdGhpcy5sYXN0TW92ZS5wcmV2O1xyXG5cdC8vIFx0fVxyXG5cdC8vIFx0cmV0dXJuIGZhbHNlO1xyXG5cdC8vIH1cclxuXHJcblx0Ly8gcHVibGljIHJvbGxiYWNrKCkge1xyXG5cdC8vIFx0TG9nLm91dChcInJvbGxiYWNrXCIpO1xyXG5cdC8vIFx0bGV0IG1vdmUgPSBuZXcgTW92ZSh0aGlzLmxhc3RNb3ZlLmJvYXJkLCB0aGlzLmxhc3RNb3ZlLnN3YXAuYS5pbmRleCwgdGhpcy5sYXN0TW92ZS5zd2FwLmIuaW5kZXgpO1xyXG5cdC8vIFx0Ly8gYXNzdW1lIHJlc3VsdCBpcyBzYW1lIGFzIGJlZm9yZVxyXG5cdC8vIFx0bW92ZS5jb3JyZWN0ID0gdGhpcy5sYXN0TW92ZS5jb3JyZWN0O1xyXG5cdC8vIFx0bW92ZS5kZWx0YSA9IHRoaXMubGFzdE1vdmUuZGVsdGEgKiAtMTsgLy8gYXNzdW1lIG9wcG9zaXRlXHJcblx0Ly8gfVxyXG59XHJcblxyXG5cclxuY29uc3QgR1VFU1NfREVMQVkgPSA1MDsgLy8gbXNcclxuY29uc3QgTUFYX0dVRVNTRVMgPSA5OTtcclxuY29uc3QgU0xPVF9DT1VOVCA9IDY7XHJcblxyXG5sZXQgcHV6emxlO1xyXG5pZiAoREVCVUcpIHtcclxuXHQvL3B1enpsZSA9IFB1enpsZURlbW8ucmFuZG9tKFNMT1RfQ09VTlQpO1xyXG5cdHB1enpsZSA9IG5ldyBQdXp6bGVEZW1vKFsyLCAzLCA0LCAxLCA2LCA1XSk7XHJcblx0Ly9wdXp6bGUgPSBuZXcgUHV6emxlRGVtbyhbMiwgNCwgNiwgMSwgNSwgM10pO1xyXG5cdC8vcHV6emxlID0gbmV3IFB1enpsZURlbW8oWzIsIDEsIDUsIDYsIDMsIDRdKTtcclxuXHQvLyBUT0RPOiB0cnkgYSBwdXp6bGUgd2hlcmUgbnVtYmVycyBjYW4gcmVwZWF0XHJcbn1cclxuZWxzZSB7XHJcblx0cHV6emxlID0gbmV3IEh1bWFuUHV6emxlSW50ZXJmYWNlKFNMT1RfQ09VTlQpO1xyXG59XHJcbm5ldyBTb2x2ZXIocHV6emxlKTsiXX0=