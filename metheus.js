/// <reference path="node_modules/@types/jquery/index.d.ts" />
/// <reference path="node_modules/@types/lodash/index.d.ts" />
var Log = (function () {
    function Log() {
    }
    Log.out = function (msg) {
        this.state += msg + "\n";
        $("#pre").text(this.state);
    };
    return Log;
}());
Log.state = "";
var PuzzleDemo = (function () {
    function PuzzleDemo(solution) {
        this.solution = [];
        this.solution = solution;
        Log.out("Puzzle: " + solution.join(", "));
    }
    PuzzleDemo.random = function (length) {
        return new PuzzleDemo(_.shuffle(_.map(new Array(length), function (v, k) { return k + 1; })));
    };
    PuzzleDemo.prototype.getSlotCount = function () {
        return this.solution.length;
    };
    PuzzleDemo.prototype.test = function (board) {
        var correct = 0;
        for (var i = 0, len = this.solution.length; i < len; i++) {
            if (board.getSlot(i).quantity == this.solution[i]) {
                correct++;
            }
        }
        return correct;
    };
    return PuzzleDemo;
}());
var HumanPuzzleInterface = (function () {
    function HumanPuzzleInterface(slotCount) {
        this.slotCount;
    }
    HumanPuzzleInterface.prototype.getSlotCount = function () {
        return this.slotCount;
    };
    HumanPuzzleInterface.prototype.test = function (board) {
        var answer;
        do {
            answer = parseInt(prompt("Please try:\n\t" + board + "\n\nHow many are correct?"), 10);
        } while (!isNaN(answer));
        return answer;
    };
    return HumanPuzzleInterface;
}());
var Solver = (function () {
    function Solver(puzzle) {
        this.guesses = 0;
        this.puzzle = puzzle;
        // first guess
        this.board = new Board(_.map(new Array(this.puzzle.getSlotCount()), function (v, k) { return k + 1; }));
        // begin
        this.testGuess();
    }
    Solver.solve = function (puzzle) {
        return new Solver(puzzle);
    };
    Solver.prototype.testGuess = function () {
        var _this = this;
        this.guesses++;
        var correct = this.puzzle.test(this.board);
        Log.out("Guess [" + this.guesses + "]: " + this.board);
        this.board.render();
        Log.out("Number correct: " + correct + " (" + (correct - this.lastCorrect) + ")");
        if (correct == this.puzzle.getSlotCount()) {
            Log.out("You win in !" + this.guesses + " guesses.");
            return;
        }
        // try again
        if (null != this.board.getMove(-1)) {
            if (correct == this.lastCorrect) {
                // no difference; both are wrong
                this.board.setDeduction("NO", "NO");
            }
            else if (correct == this.lastCorrect + 1) {
                // difference; one is now right, but we don't know which
                // unless we have history to narrow it, then we have specific match
                this.board.setDeduction("MAYBE", "MAYBE");
            }
            else if (correct == this.lastCorrect + 2) {
                // very positive difference; both are now right for sure
                this.board.setDeduction("YES", "YES");
            }
            else if (correct == this.lastCorrect - 1) {
                // difference; one was right, but we don't know which
                // if one was a maybe and one was not, then one is now a for sure
                this.board.unswap();
                this.board.setDeduction("MAYBE", "MAYBE");
            }
            else if (correct == this.lastCorrect - 2) {
                // difference; both were right for sure
                debugger;
                this.board.unswap();
                this.board.setDeduction("NO", "NO");
            }
        }
        // swap next pair
        var candidates = [];
        console.log('--');
        for (var i = 0, len = this.puzzle.getSlotCount(); i < len; i++) {
            console.log("candidate ", { i: i, d: this.board.getSlot(i).deduction });
            if ("YES" != this.board.getSlot(i).deduction) {
                console.log("push");
                candidates.push(i);
            }
        }
        if (candidates.length < 2) {
            Log.out("Only one unknown remains yet puzzle isn't solved? Impossible!");
            console.log(candidates);
            return;
        }
        candidates = _.shuffle(candidates);
        this.board.swap(candidates.pop(), candidates.pop());
        this.lastCorrect = correct;
        setTimeout(function () { return _this.testGuess(); }, GUESS_DELAY);
    };
    return Solver;
}());
var Slot = (function () {
    function Slot() {
    }
    Slot.prototype.toString = function () {
        return this.quantity;
    };
    return Slot;
}());
var Pair = (function () {
    function Pair() {
    }
    return Pair;
}());
var Move = (function () {
    function Move() {
    }
    return Move;
}());
var Board = (function () {
    function Board(quantities) {
        this.board = [];
        this.history = []; // history of moves
        for (var i = 0, len = quantities.length; i < len; i++) {
            var slot = new Slot();
            slot.index = i;
            slot.symbol = Board.symbols.substr(i, 1);
            slot.quantity = quantities[i];
            slot.deduction = "UNKNOWN";
            this.board.push(slot);
        }
    }
    Board.prototype.swap = function (a, b) {
        // record before
        var move = new Move();
        var pairBefore = new Pair();
        pairBefore.a = _.clone(this.board[a]);
        pairBefore.b = _.clone(this.board[b]);
        move.before = pairBefore;
        // move
        var c = this.board[a];
        this.board[a] = this.board[b];
        this.board[b] = c;
        // record after
        var pairAfter = new Pair();
        pairAfter.a = _.clone(this.board[a]);
        pairAfter.b = _.clone(this.board[b]);
        move.after = pairAfter;
        this.history.push(move);
    };
    Board.prototype.setDeduction = function (a, b) {
        var lastPair = this.history[this.history.length - 1].after;
        Log.out(lastPair.a.quantity + " " + lastPair.a.deduction[0] + " => " + a[0] + ", " + lastPair.b.quantity + " " + lastPair.b.deduction[0] + " => " + b[0]);
        lastPair.a.deduction = this.board[lastPair.a.index].deduction = a;
        lastPair.b.deduction = this.board[lastPair.b.index].deduction = b;
    };
    Board.prototype.unswap = function () {
        var lastPair = this.history[this.history.length - 1].after;
        this.swap(lastPair.a.index, lastPair.b.index);
    };
    Board.prototype.toString = function () {
        return this.board.join(", ");
    };
    Board.prototype.getMove = function (delta) {
        return this.history[this.history.length + delta];
    };
    Board.prototype.getSlot = function (index) {
        return this.board[index];
    };
    Board.prototype.render = function () {
        for (var i = 0, len = this.board.length; i < len; i++) {
            var slot = this.getSlot(i);
            $("td#c" + i).text(slot.quantity + " " + slot.deduction[0]);
        }
    };
    return Board;
}());
Board.symbols = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
var GUESS_DELAY = 250; // ms
var SLOT_COUNT = 6;
var puzzle = PuzzleDemo.random(SLOT_COUNT);
//let human = new HumanPuzzleInterface(SLOT_COUNT);
Solver.solve(puzzle);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0aGV1cy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1ldGhldXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsOERBQThEO0FBQzlELDhEQUE4RDtBQUU5RDtJQUFBO0lBTUEsQ0FBQztJQUpjLE9BQUcsR0FBakIsVUFBa0IsR0FBVztRQUM1QixJQUFJLENBQUMsS0FBSyxJQUFPLEdBQUcsT0FBSSxDQUFDO1FBQ3pCLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFDRixVQUFDO0FBQUQsQ0FBQyxBQU5EO0FBQ2dCLFNBQUssR0FBRyxFQUFFLENBQUM7QUFZM0I7SUFHQyxvQkFBbUIsUUFBa0I7UUFGN0IsYUFBUSxHQUFhLEVBQUUsQ0FBQztRQUcvQixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztRQUN6QixHQUFHLENBQUMsR0FBRyxDQUFDLGFBQVcsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUcsQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFFYSxpQkFBTSxHQUFwQixVQUFxQixNQUFjO1FBQ2xDLE1BQU0sQ0FBQyxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQ3BDLElBQUksS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFLFVBQVUsQ0FBQyxFQUFFLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBRU0saUNBQVksR0FBbkI7UUFDQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7SUFDN0IsQ0FBQztJQUVNLHlCQUFJLEdBQVgsVUFBWSxLQUFZO1FBQ3ZCLElBQUksT0FBTyxHQUFHLENBQUMsQ0FBQztRQUNoQixHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxD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LEdBQWQsVUFBZSxLQUFhO1FBQzNCLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzFCLENBQUM7SUFFTSxzQkFBTSxHQUFiO1FBQ0MsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDdkQsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMzQixDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxHQUFFLEdBQUcsR0FBRSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDM0QsQ0FBQztJQUNGLENBQUM7SUFDRixZQUFDO0FBQUQsQ0FBQyxBQW5FRDtBQUNnQixhQUFPLEdBQUcsNEJBQTRCLENBQUM7QUFxRXZELElBQU0sV0FBVyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEtBQUs7QUFDOUIsSUFBTSxVQUFVLEdBQUcsQ0FBQyxDQUFDO0FBQ3JCLElBQUksTUFBTSxHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDM0MsbURBQW1EO0FBQ25ELE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwibm9kZV9tb2R1bGVzL0B0eXBlcy9qcXVlcnkvaW5kZXguZC50c1wiIC8+XHJcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJub2RlX21vZHVsZXMvQHR5cGVzL2xvZGFzaC9pbmRleC5kLnRzXCIgLz5cclxuXHJcbmNsYXNzIExvZyB7XHJcblx0cHJpdmF0ZSBzdGF0aWMgc3RhdGUgPSBcIlwiO1xyXG5cdHB1YmxpYyBzdGF0aWMgb3V0KG1zZzogc3RyaW5nKTogdm9pZCB7XHJcblx0XHR0aGlzLnN0YXRlICs9IGAke21zZ31cXG5gO1xyXG5cdFx0JChcIiNwcmVcIikudGV4dCh0aGlzLnN0YXRlKTtcclxuXHR9XHJcbn1cclxuXHJcbmludGVyZmFjZSBQdXp6bGUge1xyXG5cdHRlc3QoYm9hcmQ6IEJvYXJkKTogbnVtYmVyO1xyXG5cdGdldFNsb3RDb3VudCgpOiBudW1iZXI7XHJcbn1cclxuXHJcbmNsYXNzIFB1enpsZURlbW8gaW1wbGVtZW50cyBQdXp6bGUge1xyXG5cdHByaXZhdGUgc29sdXRpb246IG51bWJlcltdID0gW107XHJcblxyXG5cdHB1YmxpYyBjb25zdHJ1Y3Rvcihzb2x1dGlvbjogbnVtYmVyW10pIHtcclxuXHRcdHRoaXMuc29sdXRpb24gPSBzb2x1dGlvbjtcclxuXHRcdExvZy5vdXQoYFB1enpsZTogJHtzb2x1dGlvbi5qb2luKFwiLCBcIil9YCk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc3RhdGljIHJhbmRvbShsZW5ndGg6IG51bWJlcik6IFB1enpsZSB7XHJcblx0XHRyZXR1cm4gbmV3IFB1enpsZURlbW8oXy5zaHVmZmxlKF8ubWFwKFxyXG5cdFx0XHRuZXcgQXJyYXkobGVuZ3RoKSwgZnVuY3Rpb24gKHYsIGspIHsgcmV0dXJuIGsgKyAxOyB9KSkpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldFNsb3RDb3VudCgpOiBudW1iZXIge1xyXG5cdFx0cmV0dXJuIHRoaXMuc29sdXRpb24ubGVuZ3RoO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHRlc3QoYm9hcmQ6IEJvYXJkKTogbnVtYmVyIHtcclxuXHRcdGxldCBjb3JyZWN0ID0gMDtcclxuXHRcdGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLnNvbHV0aW9uLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcblx0XHRcdGlmIChib2FyZC5nZXRTbG90KGkpLnF1YW50aXR5ID09IHRoaXMuc29sdXRpb25baV0pIHtcclxuXHRcdFx0XHRjb3JyZWN0Kys7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHJldHVybiBjb3JyZWN0O1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgSHVtYW5QdXp6bGVJbnRlcmZhY2UgaW1wbGVtZW50cyBQdXp6bGUge1xyXG5cdHByaXZhdGUgc2xvdENvdW50OiBudW1iZXI7XHJcblxyXG5cdHB1YmxpYyBjb25zdHJ1Y3RvcihzbG90Q291bnQ6IG51bWJlcikge1xyXG5cdFx0dGhpcy5zbG90Q291bnQ7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0U2xvdENvdW50KCk6IG51bWJlciB7XHJcblx0XHRyZXR1cm4gdGhpcy5zbG90Q291bnQ7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgdGVzdChib2FyZDogQm9hcmQpOiBudW1iZXIge1xyXG5cdFx0bGV0IGFuc3dlcjtcclxuXHRcdGRvIHtcclxuXHRcdFx0YW5zd2VyID0gcGFyc2VJbnQocHJvbXB0KFxyXG5cdFx0XHRcdGBQbGVhc2UgdHJ5OlxcblxcdCR7Ym9hcmR9XFxuXFxuSG93IG1hbnkgYXJlIGNvcnJlY3Q/YCksIDEwKTtcclxuXHRcdH1cclxuXHRcdHdoaWxlICghaXNOYU4oYW5zd2VyKSk7XHJcblx0XHRyZXR1cm4gYW5zd2VyO1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgU29sdmVyIHtcclxuXHRwcml2YXRlIHB1enpsZTogUHV6emxlO1xyXG5cdHByaXZhdGUgYm9hcmQ6IEJvYXJkO1xyXG5cdHByaXZhdGUgbGFzdENvcnJlY3Q6IG51bWJlcjtcclxuXHJcblx0cHVibGljIGNvbnN0cnVjdG9yKHB1enpsZTogUHV6emxlKSB7XHJcblx0XHR0aGlzLnB1enpsZSA9IHB1enpsZTtcclxuXHJcblx0XHQvLyBmaXJzdCBndWVzc1xyXG5cdFx0dGhpcy5ib2FyZCA9IG5ldyBCb2FyZChfLm1hcChuZXcgQXJyYXkodGhpcy5wdXp6bGUuZ2V0U2xvdENvdW50KCkpLFxyXG5cdFx0XHRmdW5jdGlvbiAodiwgaykgeyByZXR1cm4gayArIDE7IH0pKTtcclxuXHJcblx0XHQvLyBiZWdpblxyXG5cdFx0dGhpcy50ZXN0R3Vlc3MoKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzdGF0aWMgc29sdmUocHV6emxlOiBQdXp6bGUpIHtcclxuXHRcdHJldHVybiBuZXcgU29sdmVyKHB1enpsZSk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIGd1ZXNzZXMgPSAwO1xyXG5cdHB1YmxpYyB0ZXN0R3Vlc3MoKSB7XHJcblx0XHR0aGlzLmd1ZXNzZXMrKztcclxuXHRcdGxldCBjb3JyZWN0ID0gdGhpcy5wdXp6bGUudGVzdCh0aGlzLmJvYXJkKTtcclxuXHRcdExvZy5vdXQoYEd1ZXNzIFske3RoaXMuZ3Vlc3Nlc31dOiAke3RoaXMuYm9hcmR9YCk7XHJcblx0XHR0aGlzLmJvYXJkLnJlbmRlcigpO1xyXG5cdFx0TG9nLm91dChgTnVtYmVyIGNvcnJlY3Q6ICR7Y29ycmVjdH0gKCR7Y29ycmVjdCAtIHRoaXMubGFzdENvcnJlY3R9KWApO1xyXG5cdFx0aWYgKGNvcnJlY3QgPT0gdGhpcy5wdXp6bGUuZ2V0U2xvdENvdW50KCkpIHtcclxuXHRcdFx0TG9nLm91dChgWW91IHdpbiBpbiAhJHt0aGlzLmd1ZXNzZXN9IGd1ZXNzZXMuYCk7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0Ly8gdHJ5IGFnYWluXHJcblx0XHRpZiAobnVsbCAhPSB0aGlzLmJvYXJkLmdldE1vdmUoLTEpKSB7XHJcblx0XHRcdGlmIChjb3JyZWN0ID09IHRoaXMubGFzdENvcnJlY3QpIHtcclxuXHRcdFx0XHQvLyBubyBkaWZmZXJlbmNlOyBib3RoIGFyZSB3cm9uZ1xyXG5cdFx0XHRcdHRoaXMuYm9hcmQuc2V0RGVkdWN0aW9uKFwiTk9cIiwgXCJOT1wiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmIChjb3JyZWN0ID09IHRoaXMubGFzdENvcnJlY3QgKyAxKSB7XHJcblx0XHRcdFx0Ly8gZGlmZmVyZW5jZTsgb25lIGlzIG5vdyByaWdodCwgYnV0IHdlIGRvbid0IGtub3cgd2hpY2hcclxuXHRcdFx0XHQvLyB1bmxlc3Mgd2UgaGF2ZSBoaXN0b3J5IHRvIG5hcnJvdyBpdCwgdGhlbiB3ZSBoYXZlIHNwZWNpZmljIG1hdGNoXHJcblx0XHRcdFx0dGhpcy5ib2FyZC5zZXREZWR1Y3Rpb24oXCJNQVlCRVwiLCBcIk1BWUJFXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKGNvcnJlY3QgPT0gdGhpcy5sYXN0Q29ycmVjdCArIDIpIHtcclxuXHRcdFx0XHQvLyB2ZXJ5IHBvc2l0aXZlIGRpZmZlcmVuY2U7IGJvdGggYXJlIG5vdyByaWdodCBmb3Igc3VyZVxyXG5cdFx0XHRcdHRoaXMuYm9hcmQuc2V0RGVkdWN0aW9uKFwiWUVTXCIsIFwiWUVTXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKGNvcnJlY3QgPT0gdGhpcy5sYXN0Q29ycmVjdCAtIDEpIHtcclxuXHRcdFx0XHQvLyBkaWZmZXJlbmNlOyBvbmUgd2FzIHJpZ2h0LCBidXQgd2UgZG9uJ3Qga25vdyB3aGljaFxyXG5cclxuXHRcdFx0XHQvLyBpZiBvbmUgd2FzIGEgbWF5YmUgYW5kIG9uZSB3YXMgbm90LCB0aGVuIG9uZSBpcyBub3cgYSBmb3Igc3VyZVxyXG5cclxuXHRcdFx0XHR0aGlzLmJvYXJkLnVuc3dhcCgpO1xyXG5cdFx0XHRcdHRoaXMuYm9hcmQuc2V0RGVkdWN0aW9uKFwiTUFZQkVcIiwgXCJNQVlCRVwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmIChjb3JyZWN0ID09IHRoaXMubGFzdENvcnJlY3QgLSAyKSB7XHJcblx0XHRcdFx0Ly8gZGlmZmVyZW5jZTsgYm90aCB3ZXJlIHJpZ2h0IGZvciBzdXJlXHJcblx0XHRcdFx0ZGVidWdnZXI7XHJcblx0XHRcdFx0dGhpcy5ib2FyZC51bnN3YXAoKTtcclxuXHRcdFx0XHR0aGlzLmJvYXJkLnNldERlZHVjdGlvbihcIk5PXCIsIFwiTk9cIik7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdC8vIHN3YXAgbmV4dCBwYWlyXHJcblx0XHRsZXQgY2FuZGlkYXRlczogbnVtYmVyW10gPSBbXTtcclxuXHRcdGNvbnNvbGUubG9nKCctLScpO1xyXG5cdFx0Zm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMucHV6emxlLmdldFNsb3RDb3VudCgpOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0Y29uc29sZS5sb2coXCJjYW5kaWRhdGUgXCIsIHsgaTogaSwgZDogdGhpcy5ib2FyZC5nZXRTbG90KGkpLmRlZHVjdGlvbiB9KTtcclxuXHRcdFx0aWYgKFwiWUVTXCIgIT0gdGhpcy5ib2FyZC5nZXRTbG90KGkpLmRlZHVjdGlvbikge1xyXG5cdFx0XHRcdGNvbnNvbGUubG9nKFwicHVzaFwiKTtcclxuXHRcdFx0XHRjYW5kaWRhdGVzLnB1c2goaSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGlmIChjYW5kaWRhdGVzLmxlbmd0aCA8IDIpIHtcclxuXHRcdFx0TG9nLm91dChcIk9ubHkgb25lIHVua25vd24gcmVtYWlucyB5ZXQgcHV6emxlIGlzbid0IHNvbHZlZD8gSW1wb3NzaWJsZSFcIik7XHJcblx0XHRcdGNvbnNvbGUubG9nKGNhbmRpZGF0ZXMpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRjYW5kaWRhdGVzID0gXy5zaHVmZmxlKGNhbmRpZGF0ZXMpO1xyXG5cdFx0dGhpcy5ib2FyZC5zd2FwKGNhbmRpZGF0ZXMucG9wKCksIGNhbmRpZGF0ZXMucG9wKCkpO1xyXG5cclxuXHRcdHRoaXMubGFzdENvcnJlY3QgPSBjb3JyZWN0O1xyXG5cdFx0c2V0VGltZW91dCgoKSA9PiB0aGlzLnRlc3RHdWVzcygpLCBHVUVTU19ERUxBWSk7XHJcblx0fVxyXG59XHJcblxyXG5cclxuXHJcbi8vIGhpc3Rvcnk6IE1vdmU6IFBhaXI6IFNsb3RcclxuXHJcbnR5cGUgRGVkdWN0aW9uID0gXCJVTktOT1dOXCIgfCBcIk5PXCIgfCBcIk1BWUJFXCIgfCBcIllFU1wiO1xyXG5cclxuY2xhc3MgU2xvdCB7XHJcblx0aW5kZXg6IG51bWJlcjtcclxuXHRzeW1ib2w6IHN0cmluZztcclxuXHRxdWFudGl0eTogbnVtYmVyO1xyXG5cdGRlZHVjdGlvbjogRGVkdWN0aW9uO1xyXG5cclxuXHRwdWJsaWMgdG9TdHJpbmcoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5xdWFudGl0eTtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIFBhaXIge1xyXG5cdHB1YmxpYyBhOiBTbG90O1xyXG5cdHB1YmxpYyBiOiBTbG90O1xyXG59XHJcblxyXG5jbGFzcyBNb3ZlIHtcclxuXHRiZWZvcmU6IFBhaXI7XHJcblx0YWZ0ZXI6IFBhaXI7XHJcbn1cclxuXHJcbmNsYXNzIEJvYXJkIHtcclxuXHRwcml2YXRlIHN0YXRpYyBzeW1ib2xzID0gXCJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWlwiO1xyXG5cdHByaXZhdGUgYm9hcmQ6IFNsb3RbXSA9IFtdO1xyXG5cdHByaXZhdGUgaGlzdG9yeTogTW92ZVtdID0gW107IC8vIGhpc3Rvcnkgb2YgbW92ZXNcclxuXHJcblx0cHVibGljIGNvbnN0cnVjdG9yKHF1YW50aXRpZXM6IG51bWJlcltdKSB7XHJcblx0XHRmb3IgKGxldCBpID0gMCwgbGVuID0gcXVhbnRpdGllcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG5cdFx0XHRsZXQgc2xvdCA9IG5ldyBTbG90KCk7XHJcblx0XHRcdHNsb3QuaW5kZXggPSBpO1xyXG5cdFx0XHRzbG90LnN5bWJvbCA9IEJvYXJkLnN5bWJvbHMuc3Vic3RyKGksIDEpO1xyXG5cdFx0XHRzbG90LnF1YW50aXR5ID0gcXVhbnRpdGllc1tpXTtcclxuXHRcdFx0c2xvdC5kZWR1Y3Rpb24gPSBcIlVOS05PV05cIjtcclxuXHRcdFx0dGhpcy5ib2FyZC5wdXNoKHNsb3QpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0cHVibGljIHN3YXAoYTogbnVtYmVyLCBiOiBudW1iZXIpIHtcclxuXHRcdC8vIHJlY29yZCBiZWZvcmVcclxuXHRcdGxldCBtb3ZlID0gbmV3IE1vdmUoKTtcclxuXHRcdGxldCBwYWlyQmVmb3JlID0gbmV3IFBhaXIoKTtcclxuXHRcdHBhaXJCZWZvcmUuYSA9IF8uY2xvbmUodGhpcy5ib2FyZFthXSk7XHJcblx0XHRwYWlyQmVmb3JlLmIgPSBfLmNsb25lKHRoaXMuYm9hcmRbYl0pO1xyXG5cdFx0bW92ZS5iZWZvcmUgPSBwYWlyQmVmb3JlO1xyXG5cclxuXHRcdC8vIG1vdmVcclxuXHRcdGxldCBjID0gdGhpcy5ib2FyZFthXTtcclxuXHRcdHRoaXMuYm9hcmRbYV0gPSB0aGlzLmJvYXJkW2JdO1xyXG5cdFx0dGhpcy5ib2FyZFtiXSA9IGM7XHJcblxyXG5cdFx0Ly8gcmVjb3JkIGFmdGVyXHJcblx0XHRsZXQgcGFpckFmdGVyID0gbmV3IFBhaXIoKTtcclxuXHRcdHBhaXJBZnRlci5hID0gXy5jbG9uZSh0aGlzLmJvYXJkW2FdKTtcclxuXHRcdHBhaXJBZnRlci5iID0gXy5jbG9uZSh0aGlzLmJvYXJkW2JdKTtcclxuXHRcdG1vdmUuYWZ0ZXIgPSBwYWlyQWZ0ZXI7XHJcblx0XHR0aGlzLmhpc3RvcnkucHVzaChtb3ZlKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXREZWR1Y3Rpb24oYTogRGVkdWN0aW9uLCBiOiBEZWR1Y3Rpb24pIHtcclxuXHRcdGxldCBsYXN0UGFpciA9IHRoaXMuaGlzdG9yeVt0aGlzLmhpc3RvcnkubGVuZ3RoIC0gMV0uYWZ0ZXI7XHJcblx0XHRMb2cub3V0KGAke2xhc3RQYWlyLmEucXVhbnRpdHl9ICR7bGFzdFBhaXIuYS5kZWR1Y3Rpb25bMF19ID0+ICR7YVswXX0sICR7bGFzdFBhaXIuYi5xdWFudGl0eX0gJHtsYXN0UGFpci5iLmRlZHVjdGlvblswXX0gPT4gJHtiWzBdfWApO1xyXG5cdFx0bGFzdFBhaXIuYS5kZWR1Y3Rpb24gPSB0aGlzLmJvYXJkW2xhc3RQYWlyLmEuaW5kZXhdLmRlZHVjdGlvbiA9IGE7XHJcblx0XHRsYXN0UGFpci5iLmRlZHVjdGlvbiA9IHRoaXMuYm9hcmRbbGFzdFBhaXIuYi5pbmRleF0uZGVkdWN0aW9uID0gYjtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyB1bnN3YXAoKSB7XHJcblx0XHRsZXQgbGFzdFBhaXIgPSB0aGlzLmhpc3RvcnlbdGhpcy5oaXN0b3J5Lmxlbmd0aCAtIDFdLmFmdGVyO1xyXG5cdFx0dGhpcy5zd2FwKGxhc3RQYWlyLmEuaW5kZXgsIGxhc3RQYWlyLmIuaW5kZXgpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHRvU3RyaW5nKCk6IHN0cmluZyB7XHJcblx0XHRyZXR1cm4gdGhpcy5ib2FyZC5qb2luKFwiLCBcIik7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0TW92ZShkZWx0YTogbnVtYmVyKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5oaXN0b3J5W3RoaXMuaGlzdG9yeS5sZW5ndGggKyBkZWx0YV07XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0U2xvdChpbmRleDogbnVtYmVyKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5ib2FyZFtpbmRleF07XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgcmVuZGVyKCkge1xyXG5cdFx0Zm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuYm9hcmQubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0bGV0IHNsb3QgPSB0aGlzLmdldFNsb3QoaSk7XHJcblx0XHRcdCQoXCJ0ZCNjXCIgKyBpKS50ZXh0KHNsb3QucXVhbnRpdHkgK1wiIFwiKyBzbG90LmRlZHVjdGlvblswXSk7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5cclxuY29uc3QgR1VFU1NfREVMQVkgPSAyNTA7IC8vIG1zXHJcbmNvbnN0IFNMT1RfQ09VTlQgPSA2O1xyXG5sZXQgcHV6emxlID0gUHV6emxlRGVtby5yYW5kb20oU0xPVF9DT1VOVCk7XHJcbi8vbGV0IGh1bWFuID0gbmV3IEh1bWFuUHV6emxlSW50ZXJmYWNlKFNMT1RfQ09VTlQpO1xyXG5Tb2x2ZXIuc29sdmUocHV6emxlKTsiXX0=