/// <reference path="node_modules/@types/jquery/index.d.ts" />
/// <reference path="node_modules/@types/lodash/index.d.ts" />
var DEBUG = true;
var Log = (function () {
    function Log() {
    }
    Log.out = function (msg) {
        $("<pre/>").text(msg + "\n").appendTo("#log");
    };
    Log.html = function (html) {
        $("<div/>").html(html).appendTo("#log");
    };
    return Log;
}());
var PuzzleDemo = (function () {
    function PuzzleDemo(solution) {
        this.solution = [];
        this.solution = solution;
        Log.out("Puzzle:\n" + solution.join("  "));
    }
    PuzzleDemo.random = function (length) {
        return new PuzzleDemo(_.shuffle(_.map(new Array(length), function (v, k) { return k + 1; })));
    };
    PuzzleDemo.prototype.getSlotCount = function () {
        return this.solution.length;
    };
    PuzzleDemo.prototype.test = function (board) {
        var count = 0;
        for (var i = 0, len = this.solution.length; i < len; i++) {
            var correct = board.slots[i].quantity == this.solution[i];
            if (correct)
                count++;
            if (DEBUG)
                board.debugViewCorrectSlots[i] = correct;
        }
        return count;
    };
    return PuzzleDemo;
}());
var HumanPuzzleInterface = (function () {
    function HumanPuzzleInterface(slotCount) {
        this.slotCount;
    }
    HumanPuzzleInterface.prototype.getSlotCount = function () {
        return this.slotCount;
    };
    HumanPuzzleInterface.prototype.test = function (board) {
        var answer;
        do {
            answer = parseInt(prompt("Please try:\n\t" + board + "\n\nHow many are correct?"), 10);
        } while (!isNaN(answer));
        return answer;
    };
    return HumanPuzzleInterface;
}());
var UNKNOWN = "UNKNOWN";
var NO = "NO";
var MAYBE = "MAYBE";
var YES = "YES";
var Swap = (function () {
    function Swap(a, b) {
        this.a = a;
        this.b = b;
    }
    return Swap;
}());
var Move = (function () {
    // new move based on copy of given move
    function Move(base, board, swap) {
        this.base = base;
        this.board = _.cloneDeep(board);
        if (null != swap) {
            var tmp = this.board.slots[swap.a];
            this.board.slots[swap.a] = this.board.slots[swap.b];
            this.board.slots[swap.b] = tmp;
            this.board.slots[swap.a].index = swap.a;
            this.board.slots[swap.b].index = swap.b;
            this.swap = swap;
        }
    }
    Move.prototype.render = function () {
        var s = this.num + ": ";
        for (var i = 0, len = this.board.slots.length; i < len; i++) {
            var slot = this.board.slots[i];
            var underline = (null != this.swap && (slot.quantity == this.board.slots[this.swap.a].quantity || slot.quantity == this.board.slots[this.swap.b].quantity));
            var bold = this.board.debugViewCorrectSlots[i];
            s += "" + (bold ? "<b>" : "") + (underline ? "<u>" : "") + slot.quantity + slot.deduction[0] + (underline ? "</u>" : "") + (bold ? "</b>" : "") + " ";
        }
        console.log("num: ", this.num);
        s += (this.num === 1 ? "FIRST" :
            " = " + this.correct + " (" + (this.delta < 0 ? this.delta : "+" + this.delta) + ") score: " + this.score());
        Log.html(s);
    };
    Move.prototype.score = function () {
        return this.correct + (this.delta * .5);
    };
    Move.prototype.getSwapA = function () {
        return this.board.slots[this.swap.a];
    };
    Move.prototype.getSwapB = function () {
        return this.board.slots[this.swap.b];
    };
    Move.prototype.hasSwapDeduction = function (a, b) {
        return this.getSwapA().deduction == a &&
            this.getSwapB().deduction == b;
    };
    Move.rankInsert = function (root, move) {
        var parent = null;
        var current = root;
        var i = 0;
        while (i++ < LOOP_BREAKER) {
            parent = current;
            if (move.score() < parent.score()) {
                current = parent.left;
                if (null == current) {
                    parent.left = move;
                    return;
                }
            }
            else {
                current = parent.right;
                if (null == current) {
                    parent.right = move;
                    return;
                }
            }
        }
    };
    // TODO: find the adjacent pair in given two moves
    // adj pair in two moves =
    // if move1 = a,b and move2 = b,c then ajc pair = a
    Move.copyMostValuableMove = function (root) {
        if (null == root)
            return null;
        var current = root;
        var mostValuable = current;
        var i = 0;
        while (i++ < LOOP_BREAKER) {
            if (mostValuable.score() < current.score()) {
                mostValuable = current;
            }
            if (current.right && current.score() < current.right.score()) {
                current = current.right;
            }
            else if (current.left && current.score() < current.left.score()) {
                current = current.left;
            }
            else {
                return mostValuable.clone();
            }
        }
    };
    Move.prototype.clone = function () {
        var move = new Move(this, this.board);
        move.num = this.num;
        move.correct = this.correct;
        move.delta = this.delta;
        return move;
    };
    Move.havePlayedBefore = function (last, candidate) {
        var current = last;
        var i = 0;
        while (null != current && i++ < LOOP_BREAKER) {
            if (Board.compare(current.board, candidate.board)) {
                return true;
            }
            current = current.prev;
        }
        return false;
    };
    return Move;
}());
var Slot = (function () {
    function Slot() {
    }
    Slot.prototype.setDeduction = function (deduction) {
        this.deduction = deduction;
        Log.out("          " + this.quantity + " " + this.deduction[0] + " => " + deduction[0] + (deduction == YES ? " FOUND" : ""));
    };
    Slot.prototype.toString = function () {
        return this.quantity;
    };
    return Slot;
}());
var Board = (function () {
    function Board(slots) {
        this.debugViewCorrectSlots = [];
        this.slots = slots;
    }
    Board.prototype.findAll = function (fn) {
        return _.filter(this.slots, fn);
    };
    Board.prototype.findOne = function (fn) {
        return this.findAll(fn)[0];
    };
    Board.compare = function (a, b) {
        if (a.slots.length != b.slots.length)
            return false;
        for (var i = 0, len = a.slots.length; i < len; i++) {
            if (a.slots[i].quantity != b.slots[i].quantity) {
                return false;
            }
        }
        return true;
    };
    Board.prototype.render = function () {
        for (var i = 0, len = this.slots.length; i < len; i++) {
            $("td#c" + i).text(this.slots[i].quantity + " " + this.slots[i].deduction[0]);
        }
    };
    Board.prototype.toString = function () {
        return this.slots.join(" ");
    };
    return Board;
}());
var Solver = (function () {
    function Solver(puzzle) {
        this.moves = 0;
        this.puzzle = puzzle;
        // begin with opening move
        this.rootMove = new Move(null, new Board(_.map(new Array(this.puzzle.getSlotCount()), function (nil, i) {
            var slot = new Slot();
            slot.index = i;
            slot.quantity = i + 1;
            slot.deduction = UNKNOWN;
            return slot;
        })));
        this.playMove(this.rootMove);
    }
    Solver.prototype.playMove = function (move) {
        // sequence move into play
        move.num = ++this.moves;
        move.prev = this.lastMove;
        this.lastMove = move;
        // test and score the move
        move.correct = this.puzzle.test(move.board);
        move.delta = move.correct - (null != move.base ? move.base.correct || 0 : 0);
        if (this.moves > MAX_GUESSES) {
            Log.out("Too many guesses; we lose.");
            return;
        }
        if (null != move.swap) {
            // apply swap deductions
            if (move.delta == 0) {
                // no difference; both must be NO
                move.getSwapA().setDeduction(NO);
                move.getSwapB().setDeduction(NO);
            }
            else if (move.delta == 1) {
                // difference; one is now right, but we don't know which
                move.getSwapA().setDeduction(MAYBE);
                move.getSwapB().setDeduction(MAYBE);
            }
            else if (move.delta == 2) {
                // very positive difference; both are now right for sure
                move.getSwapA().setDeduction(YES);
                move.getSwapB().setDeduction(YES);
            }
            else if (move.delta == -1) {
                // difference; one was right, but we don't know which
                move.getSwapA().setDeduction(MAYBE);
                move.getSwapB().setDeduction(MAYBE);
            }
            else if (move.delta == -2) {
                // difference; both were right for sure
                move.getSwapA().setDeduction(YES);
                move.getSwapB().setDeduction(YES);
            }
        }
        if (this.rootMove != move) {
            Move.rankInsert(this.rootMove, move);
        }
        // update user view
        move.board.render();
        move.render();
        if (move.correct == this.puzzle.getSlotCount()) {
            Log.out("You win in " + this.moves + " moves.");
            return;
        }
        this.decide();
    };
    Solver.prototype.decide = function () {
        var _this = this;
        // decide what to do next
        var nextMove;
        if (1 === this.moves) {
            // just play a swap of the first two positions
            nextMove = new Move(this.lastMove, this.lastMove.board, new Swap(0, 1));
        }
        else {
            var move = Move.copyMostValuableMove(this.rootMove);
            Log.out("** Most valuable score: " + move.score());
            // try a unique new swap from non-yes deductions
            var tries = 0;
            do {
                //				// if the previous swap was M,M or N,N
                //				if (
                //					(move.hasSwapDeduction(MAYBE, MAYBE) ||
                //						move.hasSwapDeduction(NO, NO))
                //				) {
                //					// it should reuse A from the previous move
                //					// unless that resulted in a no change or unexpected gain
                //					// in which case it should now reuse B from two moves ago
                //
                //					
                //
                //				}
                //				else {
                //					// rotate through untested swaps remaining
                //
                //				}
                nextMove = new Move(move, move.board, new Swap(Math.floor(Math.random() * move.board.slots.length), Math.floor(Math.random() * move.board.slots.length)));
                console.log("candidate next move ", nextMove);
            } while ((Move.havePlayedBefore(this.lastMove, nextMove) ||
                YES == nextMove.getSwapA().deduction ||
                YES == nextMove.getSwapB().deduction) &&
                tries++ < 100);
        }
        if (null == nextMove) {
            Log.out("Unable to find next move.");
            return;
        }
        console.log("accepted next move ", nextMove);
        setTimeout(function () { return _this.playMove(nextMove); }, GUESS_DELAY);
    };
    return Solver;
}());
var LOOP_BREAKER = 999;
var GUESS_DELAY = 50; // ms
var MAX_GUESSES = 99;
var SLOT_COUNT = 6;
var puzzle;
if (DEBUG) {
    //puzzle = PuzzleDemo.random(SLOT_COUNT);
    puzzle = new PuzzleDemo([2, 3, 4, 1, 6, 5]);
    //puzzle = new PuzzleDemo([2, 4, 6, 1, 5, 3]);
    //puzzle = new PuzzleDemo([2, 1, 5, 6, 3, 4]);
    // TODO: try a puzzle where numbers can repeat
}
else {
    puzzle = new HumanPuzzleInterface(SLOT_COUNT);
}
new Solver(puzzle);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0aGV1cy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1ldGhldXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsOERBQThEO0FBQzlELDhEQUE4RDtBQUU5RCxJQUFNLEtBQUssR0FBRyxJQUFJLENBQUM7QUFFbkI7SUFBQTtJQU9BLENBQUM7SUFOYyxPQUFHLEdBQWpCLFVBQWtCLEdBQVc7UUFDNUIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBSSxHQUFHLE9BQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMvQyxDQUFDO0lBQ2EsUUFBSSxHQUFsQixVQUFtQixJQUFZO1FBQzlCLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFDRixVQUFDO0FBQUQsQ0FBQyxBQVBELElBT0M7QUFPRDtJQUdDLG9CQUFtQixRQUFrQjtRQUY3QixhQUFRLEdBQWEsRUFBRSxDQUFDO1FBRy9CLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBQ3pCLEdBQUcsQ0FBQyxHQUFHLENBQUMsY0FBWSxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBRyxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUVhLGlCQUFNLEdBQXBCLFVBQXFCLE1BQWM7UUFDbEMsTUFBTSxDQUFDLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FDcEMsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUUsVUFBVSxDQUFDLEVBQUUsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzFELENBQUM7SUFFTSxpQ0FBWSxHQUFuQjtRQUNDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQztJQUM3QixDQUFDO0lBRU0seUJBQUksR0FBWCxVQUFZLEtBQVk7UUFDdkIsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ2QsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDMUQsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMxRCxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUM7Z0JBQUMsS0FBSyxFQUFFLENBQUM7WUFDckIsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDO2dCQUFDLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUM7UUFDckQsQ0FBQztRQUNELE1BQU0sQ0FBQyxLQUFLLENBQUM7SUFDZCxDQUFDO0lBQ0YsaUJBQUM7QUFBRCxDQUFDLEFBMUJELElBMEJDO0FBRUQ7SUFHQyw4QkFBbUIsU0FBaUI7UUFDbkMsSUFBSSxDQUFDLFNBQVMsQ0FBQztJQUNoQixDQUFDO0lBRU0sMkNBQVksR0FBbkI7UUFDQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQztJQUN2QixDQUFDO0lBRU0sbUNBQUksR0FBWCxVQUFZLEtBQVk7UUFDdkIsSUFBSSxNQUFNLENBQUM7UUFDWCxHQUFHLENBQUM7WUFDSCxNQUFNLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FDdkIsb0JBQWtCLEtBQUssOEJBQTJCLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUMzRCxDQUFDLFFBQ00sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUU7UUFDdkIsTUFBTSxDQUFDLE1BQU0sQ0FBQztJQUNmLENBQUM7SUFDRiwyQkFBQztBQUFELENBQUMsQUFwQkQsSUFvQkM7QUFHRCxJQUFNLE9BQU8sR0FBRyxTQUFTLENBQUM7QUFDMUIsSUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDO0FBQ2hCLElBQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQztBQUN0QixJQUFNLEdBQUcsR0FBRyxLQUFLLENBQUM7QUFFbEI7SUFJQyxjQUFtQixDQUFTLEVBQUUsQ0FBUztRQUN0QyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNYLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ1osQ0FBQztJQUNGLFdBQUM7QUFBRCxDQUFDLEFBUkQsSUFRQztBQUVEO0lBV0MsdUNBQXVDO0lBQ3ZDLGNBQW1CLElBQVUsRUFBRSxLQUFZLEVBQUUsSUFBVztRQUN2RCxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDaEMsRUFBRSxDQUFDLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDbEIsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25DLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEQsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztZQUMvQixJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDeEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ3hDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLENBQUM7SUFDRixDQUFDO0lBRU0scUJBQU0sR0FBYjtRQUNDLElBQUksQ0FBQyxHQUFNLElBQUksQ0FBQyxHQUFHLE9BQUksQ0FBQztRQUN4QixHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDN0QsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0IsSUFBSSxTQUFTLEdBQUcsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDNUosSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvQyxDQUFDLElBQUksTUFBRyxJQUFJLEdBQUcsS0FBSyxHQUFHLEVBQUUsS0FBRyxTQUFTLEdBQUcsS0FBSyxHQUFHLEVBQUUsSUFBRyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUcsU0FBUyxHQUFHLE1BQU0sR0FBRyxFQUFFLEtBQUcsSUFBSSxHQUFHLE1BQU0sR0FBRyxFQUFFLE9BQUcsQ0FBQztRQUMxSSxDQUFDO1FBQ0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQy9CLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQyxHQUFHLE9BQU87WUFDN0IsUUFBTSxJQUFJLENBQUMsT0FBTyxXQUFLLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLEdBQUcsTUFBSSxJQUFJLENBQUMsS0FBTyxrQkFBWSxJQUFJLENBQUMsS0FBSyxFQUFJLENBQUMsQ0FBQztRQUNsRyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2IsQ0FBQztJQUVNLG9CQUFLLEdBQVo7UUFDQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUUsRUFBRSxDQUFDLENBQUE7SUFDdkMsQ0FBQztJQUVNLHVCQUFRLEdBQWY7UUFDQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRU0sdUJBQVEsR0FBZjtRQUNDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFTSwrQkFBZ0IsR0FBdkIsVUFBd0IsQ0FBWSxFQUFFLENBQVk7UUFDakQsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxTQUFTLElBQUksQ0FBQztZQUNwQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsU0FBUyxJQUFJLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBRWEsZUFBVSxHQUF4QixVQUF5QixJQUFVLEVBQUUsSUFBVTtRQUM5QyxJQUFJLE1BQU0sR0FBUyxJQUFJLENBQUM7UUFDeEIsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDO1FBQ25CLElBQUksQ0FBQyxHQUFDLENBQUMsQ0FBQztRQUNSLE9BQU8sQ0FBQyxFQUFFLEdBQUMsWUFBWSxFQUFFLENBQUM7WUFDekIsTUFBTSxHQUFHLE9BQU8sQ0FBQztZQUNqQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEdBQUcsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDbkMsT0FBTyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUM7Z0JBQ3RCLEVBQUUsQ0FBQyxDQUFDLElBQUksSUFBSSxPQUFPLENBQUMsQ0FBQyxDQUFDO29CQUNyQixNQUFNLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztvQkFDbkIsTUFBTSxDQUFDO2dCQUNSLENBQUM7WUFDRixDQUFDO1lBQ0QsSUFBSSxDQUFDLENBQUM7Z0JBQ0wsT0FBTyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUM7Z0JBQ3ZCLEVBQUUsQ0FBQyxDQUFDLElBQUksSUFBSSxPQUFPLENBQUMsQ0FBQyxDQUFDO29CQUNyQixNQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztvQkFDcEIsTUFBTSxDQUFDO2dCQUNSLENBQUM7WUFDRixDQUFDO1FBQ0YsQ0FBQztJQUNGLENBQUM7SUFFRCxrREFBa0Q7SUFDbEQsMEJBQTBCO0lBQzFCLG1EQUFtRDtJQUVyQyx5QkFBb0IsR0FBbEMsVUFBbUMsSUFBVTtRQUM1QyxFQUFFLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDO1lBQUMsTUFBTSxDQUFDLElBQUksQ0FBQztRQUM5QixJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDbkIsSUFBSSxZQUFZLEdBQUcsT0FBTyxDQUFDO1FBQzNCLElBQUksQ0FBQyxHQUFDLENBQUMsQ0FBQztRQUNSLE9BQU8sQ0FBQyxFQUFFLEdBQUMsWUFBWSxFQUFFLENBQUM7WUFDekIsRUFBRSxDQUFDLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxHQUFHLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQzVDLFlBQVksR0FBRyxPQUFPLENBQUM7WUFDeEIsQ0FBQztZQUNELEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLElBQUksT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUM5RCxPQUFPLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQztZQUN6QixDQUFDO1lBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLElBQUksT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUNqRSxPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztZQUN4QixDQUFDO1lBQ0QsSUFBSSxDQUFDLENBQUM7Z0JBQ0wsTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUM3QixDQUFDO1FBQ0YsQ0FBQztJQUNGLENBQUM7SUFFTSxvQkFBSyxHQUFaO1FBQ0MsSUFBSSxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN0QyxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUM7UUFDcEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDO1FBQzVCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN4QixNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2IsQ0FBQztJQUVhLHFCQUFnQixHQUE5QixVQUErQixJQUFVLEVBQUUsU0FBZTtRQUN6RCxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDbkIsSUFBSSxDQUFDLEdBQUMsQ0FBQyxDQUFDO1FBQ1IsT0FBTyxJQUFJLElBQUksT0FBTyxJQUFJLENBQUMsRUFBRSxHQUFDLFlBQVksRUFBRSxDQUFDO1lBQzVDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNuRCxNQUFNLENBQUMsSUFBSSxDQUFDO1lBQ2IsQ0FBQztZQUNELE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO1FBQ3hCLENBQUM7UUFDRCxNQUFNLENBQUMsS0FBSyxDQUFDO0lBQ2QsQ0FBQztJQUNGLFdBQUM7QUFBRCxDQUFDLEFBM0hELElBMkhDO0FBRUQ7SUFBQTtJQWFBLENBQUM7SUFSTywyQkFBWSxHQUFuQixVQUFvQixTQUFvQjtRQUN2QyxJQUFJLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztRQUMzQixHQUFHLENBQUMsR0FBRyxDQUFDLGVBQWEsSUFBSSxDQUFDLFFBQVEsU0FBSSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxZQUFPLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBRyxTQUFTLElBQUksR0FBRyxHQUFHLFFBQVEsR0FBRyxFQUFFLENBQUUsQ0FBQyxDQUFDO0lBQ2xILENBQUM7SUFFTSx1QkFBUSxHQUFmO1FBQ0MsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDdEIsQ0FBQztJQUNGLFdBQUM7QUFBRCxDQUFDLEFBYkQsSUFhQztBQUdEO0lBSUMsZUFBbUIsS0FBYTtRQUZ6QiwwQkFBcUIsR0FBYyxFQUFFLENBQUM7UUFHNUMsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7SUFDcEIsQ0FBQztJQUVNLHVCQUFPLEdBQWQsVUFBZSxFQUFFO1FBQ2hCLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDakMsQ0FBQztJQUVNLHVCQUFPLEdBQWQsVUFBZSxFQUFFO1FBQ2hCLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFFYSxhQUFPLEdBQXJCLFVBQXNCLENBQVEsRUFBRSxDQUFRO1FBQ3ZDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDO1lBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUNuRCxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNwRCxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7Z0JBQ2hELE1BQU0sQ0FBQyxLQUFLLENBQUM7WUFDZCxDQUFDO1FBQ0YsQ0FBQztRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDYixDQUFDO0lBRU0sc0JBQU0sR0FBYjtRQUNDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ3ZELENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9FLENBQUM7SUFDRixDQUFDO0lBRU0sd0JBQVEsR0FBZjtRQUNDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBQ0YsWUFBQztBQUFELENBQUMsQUFuQ0QsSUFtQ0M7QUFFRDtJQU9DLGdCQUFtQixNQUFjO1FBTHpCLFVBQUssR0FBVyxDQUFDLENBQUM7UUFNekIsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFFckIsMEJBQTBCO1FBQzFCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQzdDLElBQUksS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUMsRUFDckMsVUFBQyxHQUFHLEVBQUUsQ0FBQztZQUNOLElBQUksSUFBSSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7WUFDZixJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdEIsSUFBSSxDQUFDLFNBQVMsR0FBRyxPQUFPLENBQUM7WUFDekIsTUFBTSxDQUFDLElBQUksQ0FBQztRQUNiLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNOLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFFTSx5QkFBUSxHQUFmLFVBQWdCLElBQVU7UUFDekIsMEJBQTBCO1FBQzFCLElBQUksQ0FBQyxHQUFHLEdBQUcsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQ3hCLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUMxQixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUVyQiwwQkFBMEI7UUFDMUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDNUMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsT0FBTyxHQUFHLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQzdFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQztZQUM5QixHQUFHLENBQUMsR0FBRyxDQUFDLDRCQUE0QixDQUFDLENBQUM7WUFDdEMsTUFBTSxDQUFDO1FBQ1IsQ0FBQztRQUNELEVBQUUsQ0FBQyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUN2Qix3QkFBd0I7WUFDeEIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNyQixpQ0FBaUM7Z0JBQ2pDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQ2pDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDbEMsQ0FBQztZQUNELElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzFCLHdEQUF3RDtnQkFDeEQsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDcEMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNyQyxDQUFDO1lBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDMUIsd0RBQXdEO2dCQUN4RCxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNsQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ25DLENBQUM7WUFDRCxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzNCLHFEQUFxRDtnQkFDckQsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDcEMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNyQyxDQUFDO1lBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMzQix1Q0FBdUM7Z0JBQ3ZDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ2xDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDbkMsQ0FBQztRQUNGLENBQUM7UUFDRCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDM0IsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3RDLENBQUM7UUFFRCxtQkFBbUI7UUFDbkIsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDZCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ2hELEdBQUcsQ0FBQyxHQUFHLENBQUMsZ0JBQWMsSUFBSSxDQUFDLEtBQUssWUFBUyxDQUFDLENBQUM7WUFDM0MsTUFBTSxDQUFDO1FBQ1IsQ0FBQztRQUVELElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNmLENBQUM7SUFFTSx1QkFBTSxHQUFiO1FBQUEsaUJBa0RDO1FBakRBLHlCQUF5QjtRQUN6QixJQUFJLFFBQWMsQ0FBQztRQUNuQixFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDdEIsOENBQThDO1lBQzlDLFFBQVEsR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLElBQUksSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3pFLENBQUM7UUFDRCxJQUFJLENBQUMsQ0FBQztZQUNMLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDcEQsR0FBRyxDQUFDLEdBQUcsQ0FBQyw2QkFBMkIsSUFBSSxDQUFDLEtBQUssRUFBSSxDQUFDLENBQUM7WUFDbkQsZ0RBQWdEO1lBQ2hELElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQztZQUNkLEdBQUcsQ0FBQztnQkFDSCw0Q0FBNEM7Z0JBQzVDLFVBQVU7Z0JBQ1YsOENBQThDO2dCQUM5QyxzQ0FBc0M7Z0JBQ3RDLFNBQVM7Z0JBQ1Qsa0RBQWtEO2dCQUNsRCxnRUFBZ0U7Z0JBQ2hFLGdFQUFnRTtnQkFDaEUsRUFBRTtnQkFDRixPQUFPO2dCQUNQLEVBQUU7Z0JBQ0YsT0FBTztnQkFDUCxZQUFZO2dCQUNaLGlEQUFpRDtnQkFDakQsRUFBRTtnQkFDRixPQUFPO2dCQUVQLFFBQVEsR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLElBQUksQ0FDN0MsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQ25ELElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUNuRCxDQUFDLENBQUM7Z0JBQ0gsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsRUFBRSxRQUFRLENBQUMsQ0FBQztZQUMvQyxDQUFDLFFBR0EsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUM7Z0JBQzlDLEdBQUcsSUFBSSxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUMsU0FBUztnQkFDcEMsR0FBRyxJQUFJLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxTQUFTLENBQUM7Z0JBQ3RDLEtBQUssRUFBRSxHQUFHLEdBQUcsRUFBRTtRQUNqQixDQUFDO1FBQ0QsRUFBRSxDQUFDLENBQUMsSUFBSSxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDdEIsR0FBRyxDQUFDLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1lBQ3JDLE1BQU0sQ0FBQztRQUNSLENBQUM7UUFDRCxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBRTdDLFVBQVUsQ0FBQyxjQUFNLE9BQUEsS0FBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsRUFBdkIsQ0FBdUIsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUN4RCxDQUFDO0lBOENGLGFBQUM7QUFBRCxDQUFDLEFBL0tELElBK0tDO0FBRUQsSUFBTSxZQUFZLEdBQUcsR0FBRyxDQUFDO0FBQ3pCLElBQU0sV0FBVyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEtBQUs7QUFDN0IsSUFBTSxXQUFXLEdBQUcsRUFBRSxDQUFDO0FBQ3ZCLElBQU0sVUFBVSxHQUFHLENBQUMsQ0FBQztBQUVyQixJQUFJLE1BQU0sQ0FBQztBQUNYLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDWCx5Q0FBeUM7SUFDekMsTUFBTSxHQUFHLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzVDLDhDQUE4QztJQUM5Qyw4Q0FBOEM7SUFDOUMsOENBQThDO0FBQy9DLENBQUM7QUFDRCxJQUFJLENBQUMsQ0FBQztJQUNMLE1BQU0sR0FBRyxJQUFJLG9CQUFvQixDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQy9DLENBQUM7QUFDRCxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJub2RlX21vZHVsZXMvQHR5cGVzL2pxdWVyeS9pbmRleC5kLnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIm5vZGVfbW9kdWxlcy9AdHlwZXMvbG9kYXNoL2luZGV4LmQudHNcIiAvPlxyXG5cclxuY29uc3QgREVCVUcgPSB0cnVlO1xyXG5cclxuY2xhc3MgTG9nIHtcclxuXHRwdWJsaWMgc3RhdGljIG91dChtc2c6IHN0cmluZykge1xyXG5cdFx0JChcIjxwcmUvPlwiKS50ZXh0KGAke21zZ31cXG5gKS5hcHBlbmRUbyhcIiNsb2dcIik7XHJcblx0fVxyXG5cdHB1YmxpYyBzdGF0aWMgaHRtbChodG1sOiBzdHJpbmcpIHtcclxuXHRcdCQoXCI8ZGl2Lz5cIikuaHRtbChodG1sKS5hcHBlbmRUbyhcIiNsb2dcIik7XHJcblx0fVxyXG59XHJcblxyXG5pbnRlcmZhY2UgUHV6emxlIHtcclxuXHR0ZXN0KGJvYXJkOiBCb2FyZCk6IG51bWJlcjtcclxuXHRnZXRTbG90Q291bnQoKTogbnVtYmVyO1xyXG59XHJcblxyXG5jbGFzcyBQdXp6bGVEZW1vIGltcGxlbWVudHMgUHV6emxlIHtcclxuXHRwcml2YXRlIHNvbHV0aW9uOiBudW1iZXJbXSA9IFtdO1xyXG5cclxuXHRwdWJsaWMgY29uc3RydWN0b3Ioc29sdXRpb246IG51bWJlcltdKSB7XHJcblx0XHR0aGlzLnNvbHV0aW9uID0gc29sdXRpb247XHJcblx0XHRMb2cub3V0KGBQdXp6bGU6XFxuJHtzb2x1dGlvbi5qb2luKFwiICBcIil9YCk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc3RhdGljIHJhbmRvbShsZW5ndGg6IG51bWJlcik6IFB1enpsZSB7XHJcblx0XHRyZXR1cm4gbmV3IFB1enpsZURlbW8oXy5zaHVmZmxlKF8ubWFwKFxyXG5cdFx0XHRuZXcgQXJyYXkobGVuZ3RoKSwgZnVuY3Rpb24gKHYsIGspIHsgcmV0dXJuIGsgKyAxOyB9KSkpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldFNsb3RDb3VudCgpOiBudW1iZXIge1xyXG5cdFx0cmV0dXJuIHRoaXMuc29sdXRpb24ubGVuZ3RoO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHRlc3QoYm9hcmQ6IEJvYXJkKTogbnVtYmVyIHtcclxuXHRcdGxldCBjb3VudCA9IDA7XHJcblx0XHRmb3IgKGxldCBpID0gMCwgbGVuID0gdGhpcy5zb2x1dGlvbi5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG5cdFx0XHRsZXQgY29ycmVjdCA9IGJvYXJkLnNsb3RzW2ldLnF1YW50aXR5ID09IHRoaXMuc29sdXRpb25baV07XHJcblx0XHRcdGlmIChjb3JyZWN0KSBjb3VudCsrO1xyXG5cdFx0XHRpZiAoREVCVUcpIGJvYXJkLmRlYnVnVmlld0NvcnJlY3RTbG90c1tpXSA9IGNvcnJlY3Q7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gY291bnQ7XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBIdW1hblB1enpsZUludGVyZmFjZSBpbXBsZW1lbnRzIFB1enpsZSB7XHJcblx0cHJpdmF0ZSBzbG90Q291bnQ6IG51bWJlcjtcclxuXHJcblx0cHVibGljIGNvbnN0cnVjdG9yKHNsb3RDb3VudDogbnVtYmVyKSB7XHJcblx0XHR0aGlzLnNsb3RDb3VudDtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBnZXRTbG90Q291bnQoKTogbnVtYmVyIHtcclxuXHRcdHJldHVybiB0aGlzLnNsb3RDb3VudDtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyB0ZXN0KGJvYXJkOiBCb2FyZCk6IG51bWJlciB7XHJcblx0XHRsZXQgYW5zd2VyO1xyXG5cdFx0ZG8ge1xyXG5cdFx0XHRhbnN3ZXIgPSBwYXJzZUludChwcm9tcHQoXHJcblx0XHRcdFx0YFBsZWFzZSB0cnk6XFxuXFx0JHtib2FyZH1cXG5cXG5Ib3cgbWFueSBhcmUgY29ycmVjdD9gKSwgMTApO1xyXG5cdFx0fVxyXG5cdFx0d2hpbGUgKCFpc05hTihhbnN3ZXIpKTtcclxuXHRcdHJldHVybiBhbnN3ZXI7XHJcblx0fVxyXG59XHJcblxyXG50eXBlIERlZHVjdGlvbiA9IFwiVU5LTk9XTlwiIHwgXCJOT1wiIHwgXCJNQVlCRVwiIHwgXCJZRVNcIjtcclxuY29uc3QgVU5LTk9XTiA9IFwiVU5LTk9XTlwiO1xyXG5jb25zdCBOTyA9IFwiTk9cIjtcclxuY29uc3QgTUFZQkUgPSBcIk1BWUJFXCI7XHJcbmNvbnN0IFlFUyA9IFwiWUVTXCI7XHJcblxyXG5jbGFzcyBTd2FwIHtcclxuXHRwdWJsaWMgYTogbnVtYmVyO1xyXG5cdHB1YmxpYyBiOiBudW1iZXI7XHJcblxyXG5cdHB1YmxpYyBjb25zdHJ1Y3RvcihhOiBudW1iZXIsIGI6IG51bWJlcikge1xyXG5cdFx0dGhpcy5hID0gYTtcclxuXHRcdHRoaXMuYiA9IGI7XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBNb3ZlIHtcclxuXHRwdWJsaWMgbnVtOiBudW1iZXI7XHJcblx0cHVibGljIGJvYXJkOiBCb2FyZDtcclxuXHRwdWJsaWMgY29ycmVjdDogbnVtYmVyOyAvLyBzY29yZVxyXG5cdHB1YmxpYyBkZWx0YTogbnVtYmVyOyAvLyBzY29yZVxyXG5cdHB1YmxpYyBwcmV2PzogTW92ZTsgLy8gcGxheSBzZXF1ZW5jZVxyXG5cdHB1YmxpYyBiYXNlOiBNb3ZlOyAvLyBjb3BpZWQgZnJvbVxyXG5cdHB1YmxpYyBzd2FwPzogU3dhcDtcclxuXHRwcml2YXRlIGxlZnQ6IE1vdmU7IC8vIGJzdFxyXG5cdHByaXZhdGUgcmlnaHQ6IE1vdmU7IC8vIGJzdFxyXG5cclxuXHQvLyBuZXcgbW92ZSBiYXNlZCBvbiBjb3B5IG9mIGdpdmVuIG1vdmVcclxuXHRwdWJsaWMgY29uc3RydWN0b3IoYmFzZTogTW92ZSwgYm9hcmQ6IEJvYXJkLCBzd2FwPzogU3dhcCkge1xyXG5cdFx0dGhpcy5iYXNlID0gYmFzZTtcclxuXHRcdHRoaXMuYm9hcmQgPSBfLmNsb25lRGVlcChib2FyZCk7XHJcblx0XHRpZiAobnVsbCAhPSBzd2FwKSB7XHJcblx0XHRcdGxldCB0bXAgPSB0aGlzLmJvYXJkLnNsb3RzW3N3YXAuYV07XHJcblx0XHRcdHRoaXMuYm9hcmQuc2xvdHNbc3dhcC5hXSA9IHRoaXMuYm9hcmQuc2xvdHNbc3dhcC5iXTtcclxuXHRcdFx0dGhpcy5ib2FyZC5zbG90c1tzd2FwLmJdID0gdG1wO1xyXG5cdFx0XHR0aGlzLmJvYXJkLnNsb3RzW3N3YXAuYV0uaW5kZXggPSBzd2FwLmE7XHJcblx0XHRcdHRoaXMuYm9hcmQuc2xvdHNbc3dhcC5iXS5pbmRleCA9IHN3YXAuYjtcclxuXHRcdFx0dGhpcy5zd2FwID0gc3dhcDtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHB1YmxpYyByZW5kZXIoKSB7XHJcblx0XHRsZXQgcyA9IGAke3RoaXMubnVtfTogYDtcclxuXHRcdGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLmJvYXJkLnNsb3RzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcblx0XHRcdGxldCBzbG90ID0gdGhpcy5ib2FyZC5zbG90c1tpXTtcclxuXHRcdFx0bGV0IHVuZGVybGluZSA9IChudWxsICE9IHRoaXMuc3dhcCAmJiAoc2xvdC5xdWFudGl0eSA9PSB0aGlzLmJvYXJkLnNsb3RzW3RoaXMuc3dhcC5hXS5xdWFudGl0eSB8fCBzbG90LnF1YW50aXR5ID09IHRoaXMuYm9hcmQuc2xvdHNbdGhpcy5zd2FwLmJdLnF1YW50aXR5KSk7XHJcblx0XHRcdGxldCBib2xkID0gdGhpcy5ib2FyZC5kZWJ1Z1ZpZXdDb3JyZWN0U2xvdHNbaV07XHJcblx0XHRcdHMgKz0gYCR7Ym9sZCA/IFwiPGI+XCIgOiBcIlwifSR7dW5kZXJsaW5lID8gXCI8dT5cIiA6IFwiXCJ9JHtzbG90LnF1YW50aXR5fSR7c2xvdC5kZWR1Y3Rpb25bMF19JHt1bmRlcmxpbmUgPyBcIjwvdT5cIiA6IFwiXCJ9JHtib2xkID8gXCI8L2I+XCIgOiBcIlwifSBgO1xyXG5cdFx0fVxyXG5cdFx0Y29uc29sZS5sb2coXCJudW06IFwiLCB0aGlzLm51bSk7XHJcblx0XHRzICs9ICh0aGlzLm51bSA9PT0gMSA/IFwiRklSU1RcIiA6XHJcblx0XHRcdGAgPSAke3RoaXMuY29ycmVjdH0gKCR7dGhpcy5kZWx0YSA8IDAgPyB0aGlzLmRlbHRhIDogYCske3RoaXMuZGVsdGF9YH0pIHNjb3JlOiAke3RoaXMuc2NvcmUoKX1gKTtcclxuXHRcdExvZy5odG1sKHMpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHNjb3JlKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuY29ycmVjdCArICh0aGlzLmRlbHRhICouNSlcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBnZXRTd2FwQSgpIHtcclxuXHRcdHJldHVybiB0aGlzLmJvYXJkLnNsb3RzW3RoaXMuc3dhcC5hXTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBnZXRTd2FwQigpIHtcclxuXHRcdHJldHVybiB0aGlzLmJvYXJkLnNsb3RzW3RoaXMuc3dhcC5iXTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBoYXNTd2FwRGVkdWN0aW9uKGE6IERlZHVjdGlvbiwgYjogRGVkdWN0aW9uKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5nZXRTd2FwQSgpLmRlZHVjdGlvbiA9PSBhICYmXHJcblx0XHRcdHRoaXMuZ2V0U3dhcEIoKS5kZWR1Y3Rpb24gPT0gYjtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzdGF0aWMgcmFua0luc2VydChyb290OiBNb3ZlLCBtb3ZlOiBNb3ZlKSB7XHJcblx0XHRsZXQgcGFyZW50OiBNb3ZlID0gbnVsbDtcclxuXHRcdGxldCBjdXJyZW50ID0gcm9vdDtcclxuXHRcdGxldCBpPTA7XHJcblx0XHR3aGlsZSAoaSsrPExPT1BfQlJFQUtFUikge1xyXG5cdFx0XHRwYXJlbnQgPSBjdXJyZW50O1xyXG5cdFx0XHRpZiAobW92ZS5zY29yZSgpIDwgcGFyZW50LnNjb3JlKCkpIHtcclxuXHRcdFx0XHRjdXJyZW50ID0gcGFyZW50LmxlZnQ7XHJcblx0XHRcdFx0aWYgKG51bGwgPT0gY3VycmVudCkge1xyXG5cdFx0XHRcdFx0cGFyZW50LmxlZnQgPSBtb3ZlO1xyXG5cdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRjdXJyZW50ID0gcGFyZW50LnJpZ2h0O1xyXG5cdFx0XHRcdGlmIChudWxsID09IGN1cnJlbnQpIHtcclxuXHRcdFx0XHRcdHBhcmVudC5yaWdodCA9IG1vdmU7XHJcblx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvLyBUT0RPOiBmaW5kIHRoZSBhZGphY2VudCBwYWlyIGluIGdpdmVuIHR3byBtb3Zlc1xyXG5cdC8vIGFkaiBwYWlyIGluIHR3byBtb3ZlcyA9XHJcblx0Ly8gaWYgbW92ZTEgPSBhLGIgYW5kIG1vdmUyID0gYixjIHRoZW4gYWpjIHBhaXIgPSBhXHJcblxyXG5cdHB1YmxpYyBzdGF0aWMgY29weU1vc3RWYWx1YWJsZU1vdmUocm9vdDogTW92ZSk6IE1vdmUge1xyXG5cdFx0aWYgKG51bGwgPT0gcm9vdCkgcmV0dXJuIG51bGw7XHJcblx0XHRsZXQgY3VycmVudCA9IHJvb3Q7XHJcblx0XHRsZXQgbW9zdFZhbHVhYmxlID0gY3VycmVudDtcclxuXHRcdGxldCBpPTA7XHJcblx0XHR3aGlsZSAoaSsrPExPT1BfQlJFQUtFUikge1xyXG5cdFx0XHRpZiAobW9zdFZhbHVhYmxlLnNjb3JlKCkgPCBjdXJyZW50LnNjb3JlKCkpIHtcclxuXHRcdFx0XHRtb3N0VmFsdWFibGUgPSBjdXJyZW50O1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChjdXJyZW50LnJpZ2h0ICYmIGN1cnJlbnQuc2NvcmUoKSA8IGN1cnJlbnQucmlnaHQuc2NvcmUoKSkge1xyXG5cdFx0XHRcdGN1cnJlbnQgPSBjdXJyZW50LnJpZ2h0O1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKGN1cnJlbnQubGVmdCAmJiBjdXJyZW50LnNjb3JlKCkgPCBjdXJyZW50LmxlZnQuc2NvcmUoKSkge1xyXG5cdFx0XHRcdGN1cnJlbnQgPSBjdXJyZW50LmxlZnQ7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0cmV0dXJuIG1vc3RWYWx1YWJsZS5jbG9uZSgpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgY2xvbmUoKTogTW92ZSB7XHJcblx0XHRsZXQgbW92ZSA9IG5ldyBNb3ZlKHRoaXMsIHRoaXMuYm9hcmQpO1xyXG5cdFx0bW92ZS5udW0gPSB0aGlzLm51bTtcclxuXHRcdG1vdmUuY29ycmVjdCA9IHRoaXMuY29ycmVjdDtcclxuXHRcdG1vdmUuZGVsdGEgPSB0aGlzLmRlbHRhO1xyXG5cdFx0cmV0dXJuIG1vdmU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc3RhdGljIGhhdmVQbGF5ZWRCZWZvcmUobGFzdDogTW92ZSwgY2FuZGlkYXRlOiBNb3ZlKTogYm9vbGVhbiB7XHJcblx0XHRsZXQgY3VycmVudCA9IGxhc3Q7XHJcblx0XHRsZXQgaT0wO1xyXG5cdFx0d2hpbGUgKG51bGwgIT0gY3VycmVudCAmJiBpKys8TE9PUF9CUkVBS0VSKSB7XHRcdFxyXG5cdFx0XHRpZiAoQm9hcmQuY29tcGFyZShjdXJyZW50LmJvYXJkLCBjYW5kaWRhdGUuYm9hcmQpKSB7XHJcblx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdH1cclxuXHRcdFx0Y3VycmVudCA9IGN1cnJlbnQucHJldjtcclxuXHRcdH1cclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIFNsb3Qge1xyXG5cdHB1YmxpYyBpbmRleDogbnVtYmVyO1xyXG5cdHB1YmxpYyBxdWFudGl0eTogbnVtYmVyO1xyXG5cdHB1YmxpYyBkZWR1Y3Rpb246IERlZHVjdGlvbjtcclxuXHJcblx0cHVibGljIHNldERlZHVjdGlvbihkZWR1Y3Rpb246IERlZHVjdGlvbikge1xyXG5cdFx0dGhpcy5kZWR1Y3Rpb24gPSBkZWR1Y3Rpb247XHJcblx0XHRMb2cub3V0KGAgICAgICAgICAgJHt0aGlzLnF1YW50aXR5fSAke3RoaXMuZGVkdWN0aW9uWzBdfSA9PiAke2RlZHVjdGlvblswXX0ke2RlZHVjdGlvbiA9PSBZRVMgPyBcIiBGT1VORFwiIDogXCJcIn1gKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyB0b1N0cmluZygpIHtcclxuXHRcdHJldHVybiB0aGlzLnF1YW50aXR5O1xyXG5cdH1cclxufVxyXG5cclxuXHJcbmNsYXNzIEJvYXJkIHtcclxuXHRwdWJsaWMgc2xvdHM6IFNsb3RbXTtcclxuXHRwdWJsaWMgZGVidWdWaWV3Q29ycmVjdFNsb3RzOiBib29sZWFuW10gPSBbXTtcclxuXHJcblx0cHVibGljIGNvbnN0cnVjdG9yKHNsb3RzOiBTbG90W10pIHtcclxuXHRcdHRoaXMuc2xvdHMgPSBzbG90cztcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBmaW5kQWxsKGZuKSB7XHJcblx0XHRyZXR1cm4gXy5maWx0ZXIodGhpcy5zbG90cywgZm4pO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGZpbmRPbmUoZm4pIHtcclxuXHRcdHJldHVybiB0aGlzLmZpbmRBbGwoZm4pWzBdO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHN0YXRpYyBjb21wYXJlKGE6IEJvYXJkLCBiOiBCb2FyZCkge1xyXG5cdFx0aWYgKGEuc2xvdHMubGVuZ3RoICE9IGIuc2xvdHMubGVuZ3RoKSByZXR1cm4gZmFsc2U7XHJcblx0XHRmb3IgKGxldCBpID0gMCwgbGVuID0gYS5zbG90cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG5cdFx0XHRpZiAoYS5zbG90c1tpXS5xdWFudGl0eSAhPSBiLnNsb3RzW2ldLnF1YW50aXR5KSB7XHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdHJ1ZTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyByZW5kZXIoKSB7XHJcblx0XHRmb3IgKGxldCBpID0gMCwgbGVuID0gdGhpcy5zbG90cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG5cdFx0XHQkKFwidGQjY1wiICsgaSkudGV4dCh0aGlzLnNsb3RzW2ldLnF1YW50aXR5ICsgXCIgXCIgKyB0aGlzLnNsb3RzW2ldLmRlZHVjdGlvblswXSk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgdG9TdHJpbmcoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5zbG90cy5qb2luKFwiIFwiKTtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIFNvbHZlciB7XHJcblx0cHJpdmF0ZSBwdXp6bGU6IFB1enpsZTtcclxuXHRwcml2YXRlIG1vdmVzOiBudW1iZXIgPSAwO1xyXG5cdHB1YmxpYyByb290TW92ZTogTW92ZTsgLy8gcm9vdCBCU1Qgbm9kZVxyXG5cdHB1YmxpYyBsYXN0TW92ZTogTW92ZTsgLy8gaGlzdG9yeSBvZiBwbGF5ZWQgbW92ZXNcclxuXHRwdWJsaWMgc29sdXRpb246IG51bWJlcltdO1xyXG5cclxuXHRwdWJsaWMgY29uc3RydWN0b3IocHV6emxlOiBQdXp6bGUpIHtcclxuXHRcdHRoaXMucHV6emxlID0gcHV6emxlO1xyXG5cclxuXHRcdC8vIGJlZ2luIHdpdGggb3BlbmluZyBtb3ZlXHJcblx0XHR0aGlzLnJvb3RNb3ZlID0gbmV3IE1vdmUobnVsbCwgbmV3IEJvYXJkKF8ubWFwKFxyXG5cdFx0XHRuZXcgQXJyYXkodGhpcy5wdXp6bGUuZ2V0U2xvdENvdW50KCkpLFxyXG5cdFx0XHQobmlsLCBpKSA9PiB7XHJcblx0XHRcdFx0bGV0IHNsb3QgPSBuZXcgU2xvdCgpO1xyXG5cdFx0XHRcdHNsb3QuaW5kZXggPSBpO1xyXG5cdFx0XHRcdHNsb3QucXVhbnRpdHkgPSBpICsgMTtcclxuXHRcdFx0XHRzbG90LmRlZHVjdGlvbiA9IFVOS05PV047XHJcblx0XHRcdFx0cmV0dXJuIHNsb3Q7XHJcblx0XHRcdH0pKSk7XHJcblx0XHR0aGlzLnBsYXlNb3ZlKHRoaXMucm9vdE1vdmUpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHBsYXlNb3ZlKG1vdmU6IE1vdmUpIHtcclxuXHRcdC8vIHNlcXVlbmNlIG1vdmUgaW50byBwbGF5XHJcblx0XHRtb3ZlLm51bSA9ICsrdGhpcy5tb3ZlcztcclxuXHRcdG1vdmUucHJldiA9IHRoaXMubGFzdE1vdmU7XHJcblx0XHR0aGlzLmxhc3RNb3ZlID0gbW92ZTtcclxuXHJcblx0XHQvLyB0ZXN0IGFuZCBzY29yZSB0aGUgbW92ZVxyXG5cdFx0bW92ZS5jb3JyZWN0ID0gdGhpcy5wdXp6bGUudGVzdChtb3ZlLmJvYXJkKTtcclxuXHRcdG1vdmUuZGVsdGEgPSBtb3ZlLmNvcnJlY3QgLSAobnVsbCAhPSBtb3ZlLmJhc2UgPyBtb3ZlLmJhc2UuY29ycmVjdCB8fCAwIDogMCk7XHJcblx0XHRpZiAodGhpcy5tb3ZlcyA+IE1BWF9HVUVTU0VTKSB7XHJcblx0XHRcdExvZy5vdXQoXCJUb28gbWFueSBndWVzc2VzOyB3ZSBsb3NlLlwiKTtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0aWYgKG51bGwgIT0gbW92ZS5zd2FwKSB7XHJcblx0XHRcdC8vIGFwcGx5IHN3YXAgZGVkdWN0aW9uc1xyXG5cdFx0XHRpZiAobW92ZS5kZWx0YSA9PSAwKSB7XHJcblx0XHRcdFx0Ly8gbm8gZGlmZmVyZW5jZTsgYm90aCBtdXN0IGJlIE5PXHJcblx0XHRcdFx0bW92ZS5nZXRTd2FwQSgpLnNldERlZHVjdGlvbihOTyk7XHJcblx0XHRcdFx0bW92ZS5nZXRTd2FwQigpLnNldERlZHVjdGlvbihOTyk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAobW92ZS5kZWx0YSA9PSAxKSB7XHJcblx0XHRcdFx0Ly8gZGlmZmVyZW5jZTsgb25lIGlzIG5vdyByaWdodCwgYnV0IHdlIGRvbid0IGtub3cgd2hpY2hcclxuXHRcdFx0XHRtb3ZlLmdldFN3YXBBKCkuc2V0RGVkdWN0aW9uKE1BWUJFKTtcclxuXHRcdFx0XHRtb3ZlLmdldFN3YXBCKCkuc2V0RGVkdWN0aW9uKE1BWUJFKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmIChtb3ZlLmRlbHRhID09IDIpIHtcclxuXHRcdFx0XHQvLyB2ZXJ5IHBvc2l0aXZlIGRpZmZlcmVuY2U7IGJvdGggYXJlIG5vdyByaWdodCBmb3Igc3VyZVxyXG5cdFx0XHRcdG1vdmUuZ2V0U3dhcEEoKS5zZXREZWR1Y3Rpb24oWUVTKTtcclxuXHRcdFx0XHRtb3ZlLmdldFN3YXBCKCkuc2V0RGVkdWN0aW9uKFlFUyk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAobW92ZS5kZWx0YSA9PSAtMSkge1xyXG5cdFx0XHRcdC8vIGRpZmZlcmVuY2U7IG9uZSB3YXMgcmlnaHQsIGJ1dCB3ZSBkb24ndCBrbm93IHdoaWNoXHJcblx0XHRcdFx0bW92ZS5nZXRTd2FwQSgpLnNldERlZHVjdGlvbihNQVlCRSk7XHJcblx0XHRcdFx0bW92ZS5nZXRTd2FwQigpLnNldERlZHVjdGlvbihNQVlCRSk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAobW92ZS5kZWx0YSA9PSAtMikge1xyXG5cdFx0XHRcdC8vIGRpZmZlcmVuY2U7IGJvdGggd2VyZSByaWdodCBmb3Igc3VyZVxyXG5cdFx0XHRcdG1vdmUuZ2V0U3dhcEEoKS5zZXREZWR1Y3Rpb24oWUVTKTtcclxuXHRcdFx0XHRtb3ZlLmdldFN3YXBCKCkuc2V0RGVkdWN0aW9uKFlFUyk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGlmICh0aGlzLnJvb3RNb3ZlICE9IG1vdmUpIHtcclxuXHRcdFx0TW92ZS5yYW5rSW5zZXJ0KHRoaXMucm9vdE1vdmUsIG1vdmUpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIHVwZGF0ZSB1c2VyIHZpZXdcclxuXHRcdG1vdmUuYm9hcmQucmVuZGVyKCk7XHJcblx0XHRtb3ZlLnJlbmRlcigpO1xyXG5cdFx0aWYgKG1vdmUuY29ycmVjdCA9PSB0aGlzLnB1enpsZS5nZXRTbG90Q291bnQoKSkge1xyXG5cdFx0XHRMb2cub3V0KGBZb3Ugd2luIGluICR7dGhpcy5tb3Zlc30gbW92ZXMuYCk7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmRlY2lkZSgpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGRlY2lkZSgpIHtcclxuXHRcdC8vIGRlY2lkZSB3aGF0IHRvIGRvIG5leHRcclxuXHRcdGxldCBuZXh0TW92ZTogTW92ZTtcclxuXHRcdGlmICgxID09PSB0aGlzLm1vdmVzKSB7IC8vIGZvbGxvdy11cCB0byBmaXJzdCBtb3ZlXHJcblx0XHRcdC8vIGp1c3QgcGxheSBhIHN3YXAgb2YgdGhlIGZpcnN0IHR3byBwb3NpdGlvbnNcclxuXHRcdFx0bmV4dE1vdmUgPSBuZXcgTW92ZSh0aGlzLmxhc3RNb3ZlLCB0aGlzLmxhc3RNb3ZlLmJvYXJkLCBuZXcgU3dhcCgwLCAxKSk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHsgLy8gc3Vic2VxdWVudCBtb3Zlc1xyXG5cdFx0XHRsZXQgbW92ZSA9IE1vdmUuY29weU1vc3RWYWx1YWJsZU1vdmUodGhpcy5yb290TW92ZSk7XHJcblx0XHRcdExvZy5vdXQoYCoqIE1vc3QgdmFsdWFibGUgc2NvcmU6ICR7bW92ZS5zY29yZSgpfWApO1xyXG5cdFx0XHQvLyB0cnkgYSB1bmlxdWUgbmV3IHN3YXAgZnJvbSBub24teWVzIGRlZHVjdGlvbnNcclxuXHRcdFx0bGV0IHRyaWVzID0gMDtcclxuXHRcdFx0ZG8ge1xyXG5cdFx0XHRcdC8vXHRcdFx0XHQvLyBpZiB0aGUgcHJldmlvdXMgc3dhcCB3YXMgTSxNIG9yIE4sTlxyXG5cdFx0XHRcdC8vXHRcdFx0XHRpZiAoXHJcblx0XHRcdFx0Ly9cdFx0XHRcdFx0KG1vdmUuaGFzU3dhcERlZHVjdGlvbihNQVlCRSwgTUFZQkUpIHx8XHJcblx0XHRcdFx0Ly9cdFx0XHRcdFx0XHRtb3ZlLmhhc1N3YXBEZWR1Y3Rpb24oTk8sIE5PKSlcclxuXHRcdFx0XHQvL1x0XHRcdFx0KSB7XHJcblx0XHRcdFx0Ly9cdFx0XHRcdFx0Ly8gaXQgc2hvdWxkIHJldXNlIEEgZnJvbSB0aGUgcHJldmlvdXMgbW92ZVxyXG5cdFx0XHRcdC8vXHRcdFx0XHRcdC8vIHVubGVzcyB0aGF0IHJlc3VsdGVkIGluIGEgbm8gY2hhbmdlIG9yIHVuZXhwZWN0ZWQgZ2FpblxyXG5cdFx0XHRcdC8vXHRcdFx0XHRcdC8vIGluIHdoaWNoIGNhc2UgaXQgc2hvdWxkIG5vdyByZXVzZSBCIGZyb20gdHdvIG1vdmVzIGFnb1xyXG5cdFx0XHRcdC8vXHJcblx0XHRcdFx0Ly9cdFx0XHRcdFx0XHJcblx0XHRcdFx0Ly9cclxuXHRcdFx0XHQvL1x0XHRcdFx0fVxyXG5cdFx0XHRcdC8vXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHQvL1x0XHRcdFx0XHQvLyByb3RhdGUgdGhyb3VnaCB1bnRlc3RlZCBzd2FwcyByZW1haW5pbmdcclxuXHRcdFx0XHQvL1xyXG5cdFx0XHRcdC8vXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdG5leHRNb3ZlID0gbmV3IE1vdmUobW92ZSwgbW92ZS5ib2FyZCwgbmV3IFN3YXAoXHJcblx0XHRcdFx0XHRNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtb3ZlLmJvYXJkLnNsb3RzLmxlbmd0aCksXHJcblx0XHRcdFx0XHRNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtb3ZlLmJvYXJkLnNsb3RzLmxlbmd0aClcclxuXHRcdFx0XHQpKTtcclxuXHRcdFx0XHRjb25zb2xlLmxvZyhcImNhbmRpZGF0ZSBuZXh0IG1vdmUgXCIsIG5leHRNb3ZlKTtcclxuXHRcdFx0fVxyXG5cdFx0XHQvLyBUT0RPOiBmaXggdGhpczsgaXRzIHJldHJ5aW5nIHByZXZpb3VzIGNvbWJvc1xyXG5cdFx0XHR3aGlsZSAoXHJcblx0XHRcdFx0KE1vdmUuaGF2ZVBsYXllZEJlZm9yZSh0aGlzLmxhc3RNb3ZlLCBuZXh0TW92ZSkgfHxcclxuXHRcdFx0XHRcdFlFUyA9PSBuZXh0TW92ZS5nZXRTd2FwQSgpLmRlZHVjdGlvbiB8fFxyXG5cdFx0XHRcdFx0WUVTID09IG5leHRNb3ZlLmdldFN3YXBCKCkuZGVkdWN0aW9uKSAmJlxyXG5cdFx0XHRcdHRyaWVzKysgPCAxMDApO1xyXG5cdFx0fVxyXG5cdFx0aWYgKG51bGwgPT0gbmV4dE1vdmUpIHtcclxuXHRcdFx0TG9nLm91dChcIlVuYWJsZSB0byBmaW5kIG5leHQgbW92ZS5cIik7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdGNvbnNvbGUubG9nKFwiYWNjZXB0ZWQgbmV4dCBtb3ZlIFwiLCBuZXh0TW92ZSk7XHJcblxyXG5cdFx0c2V0VGltZW91dCgoKSA9PiB0aGlzLnBsYXlNb3ZlKG5leHRNb3ZlKSwgR1VFU1NfREVMQVkpO1xyXG5cdH1cclxuXHJcblx0Ly8gLy8gZGV0ZXJtaW5lIHdoZXRoZXIgYSBxdWFudGl0eSBoYXMgZXZlciBoYWQgYSBnaXZlbiBkZWR1Y3Rpb24gYXQgYSBzcGVjaWZpYyBpbmRleCBpbiBlbnRpcmUgaGlzdG9yeVxyXG5cdC8vIHB1YmxpYyBoYWREZWR1Y3Rpb25BdEluZGV4KHF1YW50aXR5OiBudW1iZXIsIGluZGV4OiBudW1iZXIsIGRlZHVjdGlvbjogRGVkdWN0aW9uKTogYm9vbGVhbiB7XHJcblx0Ly8gXHR3aGlsZSAobnVsbCAhPSB0aGlzLmxhc3RNb3ZlLnN3YXApIHtcclxuXHQvLyBcdFx0bGV0IHBhaXIgPSB0aGlzLmxhc3RNb3ZlLnN3YXA7XHJcblx0Ly8gXHRcdGlmIChcclxuXHQvLyBcdFx0XHQocGFpci5hLnF1YW50aXR5ID09IHF1YW50aXR5ICYmXHJcblx0Ly8gXHRcdFx0XHRwYWlyLmEuZGVkdWN0aW9uID09IGRlZHVjdGlvbiAmJlxyXG5cdC8vIFx0XHRcdFx0cGFpci5hLmluZGV4ID09IGluZGV4KSB8fFxyXG5cdC8vIFx0XHRcdChwYWlyLmIucXVhbnRpdHkgPT0gcXVhbnRpdHkgJiZcclxuXHQvLyBcdFx0XHRcdHBhaXIuYi5kZWR1Y3Rpb24gPT0gZGVkdWN0aW9uICYmXHJcblx0Ly8gXHRcdFx0XHRwYWlyLmIuaW5kZXggPT0gaW5kZXgpXHJcblx0Ly8gXHRcdCkge1xyXG5cdC8vIFx0XHRcdExvZy5vdXQoYCR7cXVhbnRpdHl9IGluZGV4ICR7aW5kZXh9IGRlZHVjdGlvbiAke2RlZHVjdGlvblswXX0gaGFwcGVuZWQgYmVmb3JlIGF0IG1vdmUgJHt0aGlzLmxhc3RNb3ZlLm51bX1gKTtcclxuXHQvLyBcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHQvLyBcdFx0fVxyXG5cdC8vIFx0XHR0aGlzLmxhc3RNb3ZlID0gdGhpcy5sYXN0TW92ZS5wcmV2O1xyXG5cdC8vIFx0fVxyXG5cdC8vIFx0cmV0dXJuIGZhbHNlO1xyXG5cdC8vIH1cclxuXHJcblx0Ly8gcHVibGljIGFscmVhZHlUcmllZChxMTogbnVtYmVyLCBpMTogbnVtYmVyLCBxMjogbnVtYmVyLCBpMjogbnVtYmVyKTogYm9vbGVhbiB7XHJcblx0Ly8gXHR3aGlsZSAobnVsbCAhPSB0aGlzLmxhc3RNb3ZlLnN3YXApIHtcclxuXHQvLyBcdFx0bGV0IHBhaXIgPSB0aGlzLmxhc3RNb3ZlLnN3YXA7XHJcblx0Ly8gXHRcdGlmIChcclxuXHQvLyBcdFx0XHQocGFpci5hLnF1YW50aXR5ID09IHExICYmXHJcblx0Ly8gXHRcdFx0XHRwYWlyLmEuaW5kZXggPT0gaTEpIHx8XHJcblx0Ly8gXHRcdFx0KHBhaXIuYi5xdWFudGl0eSA9PSBxMiAmJlxyXG5cdC8vIFx0XHRcdFx0cGFpci5iLmluZGV4ID09IGkyKVxyXG5cdC8vIFx0XHQpIHtcclxuXHQvLyBcdFx0XHRMb2cub3V0KGAke3ExfToke2kxfSwke3EyfToke2kyfSBoYXBwZW5lZCBiZWZvcmUgYXQgbW92ZSAke3RoaXMubGFzdE1vdmUubnVtfWApO1xyXG5cdC8vIFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdC8vIFx0XHR9XHJcblx0Ly8gXHRcdHRoaXMubGFzdE1vdmUgPSB0aGlzLmxhc3RNb3ZlLnByZXY7XHJcblx0Ly8gXHR9XHJcblx0Ly8gXHRyZXR1cm4gZmFsc2U7XHJcblx0Ly8gfVxyXG5cclxuXHQvLyBwdWJsaWMgcm9sbGJhY2soKSB7XHJcblx0Ly8gXHRMb2cub3V0KFwicm9sbGJhY2tcIik7XHJcblx0Ly8gXHRsZXQgbW92ZSA9IG5ldyBNb3ZlKHRoaXMubGFzdE1vdmUuYm9hcmQsIHRoaXMubGFzdE1vdmUuc3dhcC5hLmluZGV4LCB0aGlzLmxhc3RNb3ZlLnN3YXAuYi5pbmRleCk7XHJcblx0Ly8gXHQvLyBhc3N1bWUgcmVzdWx0IGlzIHNhbWUgYXMgYmVmb3JlXHJcblx0Ly8gXHRtb3ZlLmNvcnJlY3QgPSB0aGlzLmxhc3RNb3ZlLmNvcnJlY3Q7XHJcblx0Ly8gXHRtb3ZlLmRlbHRhID0gdGhpcy5sYXN0TW92ZS5kZWx0YSAqIC0xOyAvLyBhc3N1bWUgb3Bwb3NpdGVcclxuXHQvLyB9XHJcbn1cclxuXHJcbmNvbnN0IExPT1BfQlJFQUtFUiA9IDk5OTtcclxuY29uc3QgR1VFU1NfREVMQVkgPSA1MDsgLy8gbXNcclxuY29uc3QgTUFYX0dVRVNTRVMgPSA5OTtcclxuY29uc3QgU0xPVF9DT1VOVCA9IDY7XHJcblxyXG5sZXQgcHV6emxlO1xyXG5pZiAoREVCVUcpIHtcclxuXHQvL3B1enpsZSA9IFB1enpsZURlbW8ucmFuZG9tKFNMT1RfQ09VTlQpO1xyXG5cdHB1enpsZSA9IG5ldyBQdXp6bGVEZW1vKFsyLCAzLCA0LCAxLCA2LCA1XSk7XHJcblx0Ly9wdXp6bGUgPSBuZXcgUHV6emxlRGVtbyhbMiwgNCwgNiwgMSwgNSwgM10pO1xyXG5cdC8vcHV6emxlID0gbmV3IFB1enpsZURlbW8oWzIsIDEsIDUsIDYsIDMsIDRdKTtcclxuXHQvLyBUT0RPOiB0cnkgYSBwdXp6bGUgd2hlcmUgbnVtYmVycyBjYW4gcmVwZWF0XHJcbn1cclxuZWxzZSB7XHJcblx0cHV6emxlID0gbmV3IEh1bWFuUHV6emxlSW50ZXJmYWNlKFNMT1RfQ09VTlQpO1xyXG59XHJcbm5ldyBTb2x2ZXIocHV6emxlKTsiXX0=