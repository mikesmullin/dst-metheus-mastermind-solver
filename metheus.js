/// <reference path="node_modules/@types/jquery/index.d.ts" />
/// <reference path="node_modules/@types/lodash/index.d.ts" />
var DEBUG = true;
var Log = (function () {
    function Log() {
    }
    Log.out = function (msg) {
        $("<pre/>").text(msg + "\n").appendTo("#log");
    };
    Log.html = function (html) {
        $("<div/>").html(html).appendTo("#log");
    };
    return Log;
}());
var PuzzleDemo = (function () {
    function PuzzleDemo(solution) {
        this.solution = [];
        this.solution = solution;
        Log.out("Puzzle:\n" + solution.join("  "));
    }
    PuzzleDemo.random = function (length) {
        return new PuzzleDemo(_.shuffle(_.map(new Array(length), function (v, k) { return k + 1; })));
    };
    PuzzleDemo.prototype.getSlotCount = function () {
        return this.solution.length;
    };
    PuzzleDemo.prototype.test = function (board) {
        var count = 0;
        for (var i = 0, len = this.solution.length; i < len; i++) {
            var correct = board.slots[i].quantity == this.solution[i];
            if (correct)
                count++;
            if (DEBUG)
                board.debugViewCorrectSlots[i] = correct;
        }
        return count;
    };
    return PuzzleDemo;
}());
var HumanPuzzleInterface = (function () {
    function HumanPuzzleInterface(slotCount) {
        this.slotCount;
    }
    HumanPuzzleInterface.prototype.getSlotCount = function () {
        return this.slotCount;
    };
    HumanPuzzleInterface.prototype.test = function (board) {
        var answer;
        do {
            answer = parseInt(prompt("Please try:\n\t" + board + "\n\nHow many are correct?"), 10);
        } while (!isNaN(answer));
        return answer;
    };
    return HumanPuzzleInterface;
}());
var UNKNOWN = "UNKNOWN";
var NO = "NO";
var MAYBE = "MAYBE";
var YES = "YES";
var Move = (function () {
    // new move based on given board
    function Move(board, aIndex, bIndex) {
        if (null != aIndex && null != bIndex) {
            var oldA = _.cloneDeep(board.slots[aIndex]);
            var oldB = _.cloneDeep(board.slots[bIndex]);
            board.slots[aIndex] = oldB;
            board.slots[aIndex].index = aIndex;
            board.slots[bIndex] = oldA;
            board.slots[bIndex].index = bIndex;
        }
        move.board = _.cloneDeep(board);
        if (null != aIndex && null != bIndex) {
            move.pair = new Pair();
            move.pair.a = _.cloneDeep(board.slots[aIndex]);
            move.pair.b = _.cloneDeep(board.slots[bIndex]);
        }
        return move;
    }
    Move.prototype.render = function () {
        var s = "";
        for (var i = 0, len = this.board.slots.length; i < len; i++) {
            var slot = this.board.slots[i];
            var underline = (null != this.pair && (slot.quantity == this.pair.a.quantity || slot.quantity == this.pair.b.quantity));
            var bold = this.board.debugViewCorrectSlots[i];
            s += "" + (bold ? "<b>" : "") + (underline ? "<u>" : "") + slot.quantity + slot.deduction[0] + (underline ? "</u>" : "") + (bold ? "</b>" : "") + " ";
        }
        s += " = " + this.correct + " (" + (this.delta < 0 ? this.delta : "+" + this.delta) + ")";
        Log.html(s);
    };
    return Move;
}());
var Slot = (function () {
    function Slot() {
    }
    Slot.prototype.setDeduction = function (deduction) {
        this.deduction = deduction;
        Log.out("          " + this.quantity + " " + this.deduction[0] + " => " + deduction[0] + (deduction == YES ? " FOUND" : ""));
    };
    Slot.prototype.toString = function () {
        return this.quantity;
    };
    return Slot;
}());
var Pair = (function () {
    function Pair() {
    }
    Pair.prototype.matchesDeductions = function (a, b) {
        return this.a.deduction == a && this.b.deduction == b;
    };
    return Pair;
}());
var Board = (function () {
    function Board(slots) {
        this.debugViewCorrectSlots = [];
        this.slots = slots;
    }
    Board.prototype.findAll = function (fn) {
        return _.filter(this.slots, fn);
    };
    Board.prototype.findOne = function (fn) {
        return this.findAll(fn)[0];
    };
    // find the adjacent pair in given two moves
    // adj pair in two moves =
    // if move1 = a,b and move2 = b,c then ajc pair = a
    Board.prototype.setDeduction = function () {
    };
    Board.prototype.render = function () {
        for (var i = 0, len = this.slots.length; i < len; i++) {
            $("td#c" + i).text(this.slots[i].quantity + " " + this.slots[i].deduction[0]);
        }
    };
    Board.prototype.toString = function () {
        return this.slots.join(" ");
    };
    return Board;
}());
var Solver = (function () {
    function Solver(puzzle) {
        this.moves = 0;
        this.puzzle = puzzle;
        // play opening move
        this.playMove(this.newMove(new Board(_.map(new Array(this.puzzle.getSlotCount()), function (nil, i) {
            var slot = new Slot();
            slot.index = i;
            slot.quantity = i + 1;
            slot.deduction = UNKNOWN;
            return slot;
        }))));
    }
    Solver.prototype.playMove = function (move) {
        var _this = this;
        // sequence move into play
        move.num = ++this.moves;
        move.prev = this.lastMove;
        this.lastMove = move;
        if (this.moves > MAX_GUESSES) {
            Log.out("Too many guesses; we lose.");
            return;
        }
        {
            var correct = this.puzzle.test(this.lastMove.board);
            var delta = correct - (null != this.lastMove ? this.lastMove.correct || 0 : 0);
            this.lastMove.board.render();
            this.lastMove.correct = correct;
            this.lastMove.delta = delta;
            this.lastMove.render();
            if (correct == this.puzzle.getSlotCount()) {
                Log.out("You win in " + this.moves + " moves.");
                return;
            }
        }
        // try again
        if (null != this.lastMove.pair) {
            if (this.lastMove.delta == 0) {
                // no difference; both must be NO?
                this.lastMove.pair.a.setDeduction(NO);
                this.lastMove.pair.b.setDeduction(NO);
            }
            else if (this.lastMove.delta == 1) {
                // difference; one is now right, but we don't know which
                // unless we have history to narrow it, then we have specific match
                this.lastMove.pair.a.setDeduction(MAYBE);
                this.lastMove.pair.b.setDeduction(MAYBE);
            }
            else if (this.lastMove.delta == 2) {
                // very positive difference; both are now right for sure
                this.lastMove.pair.a.setDeduction(YES);
                this.lastMove.pair.b.setDeduction(YES);
            }
            else if (this.lastMove.delta == -1) {
                // difference; one was right, but we don't know which
                // so first step is always to put it back
                this.lastMove.pair.a.setDeduction(MAYBE);
                this.lastMove.pair.b.setDeduction(MAYBE);
                this.unswap();
            }
            else if (this.lastMove.delta == -2) {
                // difference; both were right for sure
                this.lastMove.pair.a.setDeduction(YES);
                this.lastMove.pair.b.setDeduction(YES);
                this.unswap();
            }
        }
        setTimeout(function () { return _this.playMove(_this.newMove(a, b)); }, GUESS_DELAY);
    };
    // determine whether a quantity has ever had a given deduction at a specific index in entire history
    Solver.prototype.hadDeductionAtIndex = function (quantity, index, deduction) {
        while (null != this.lastMove.pair) {
            var pair = this.lastMove.pair;
            if ((pair.a.quantity == quantity &&
                pair.a.deduction == deduction &&
                pair.a.index == index) ||
                (pair.b.quantity == quantity &&
                    pair.b.deduction == deduction &&
                    pair.b.index == index)) {
                Log.out(quantity + " index " + index + " deduction " + deduction[0] + " happened before at move " + this.lastMove.num);
                return true;
            }
            this.lastMove = this.lastMove.prev;
        }
        return false;
    };
    Solver.prototype.alreadyTried = function (q1, i1, q2, i2) {
        while (null != this.lastMove.pair) {
            var pair = this.lastMove.pair;
            if ((pair.a.quantity == q1 &&
                pair.a.index == i1) ||
                (pair.b.quantity == q2 &&
                    pair.b.index == i2)) {
                Log.out(q1 + ":" + i1 + "," + q2 + ":" + i2 + " happened before at move " + this.lastMove.num);
                return true;
            }
            this.lastMove = this.lastMove.prev;
        }
        return false;
    };
    Solver.prototype.unswap = function () {
        var move = this.newMove(this.lastMove.board, this.lastMove.pair.a.index, this.lastMove.pair.b.index);
        // assume result is same as before
        move.correct = this.lastMove.correct;
        move.delta = this.lastMove.delta * -1; // assume opposite
    };
    return Solver;
}());
var GUESS_DELAY = 50; // ms
var MAX_GUESSES = 99;
var SLOT_COUNT = 6;
var puzzle;
if (DEBUG) {
    //puzzle = PuzzleDemo.random(SLOT_COUNT);
    puzzle = new PuzzleDemo([2, 3, 4, 1, 6, 5]);
    //puzzle = new PuzzleDemo([2, 4, 6, 1, 5, 3]);
    //puzzle = new PuzzleDemo([2, 1, 5, 6, 3, 4]);
    // TODO: try a puzzle where numbers can repeat
}
else {
    puzzle = new HumanPuzzleInterface(SLOT_COUNT);
}
new Solver(puzzle);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0aGV1cy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1ldGhldXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsOERBQThEO0FBQzlELDhEQUE4RDtBQUU5RCxJQUFNLEtBQUssR0FBRyxJQUFJLENBQUM7QUFFbkI7SUFBQTtJQU9BLENBQUM7SUFOYyxPQUFHLEdBQWpCLFVBQWtCLEdBQVc7UUFDNUIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBSSxHQUFHLE9BQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMvQyxDQUFDO0lBQ2EsUUFBSSxHQUFsQixVQUFtQixJQUFZO1FBQzlCLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFDRixVQUFDO0FBQUQsQ0FBQyxBQVBELElBT0M7QUFPRDtJQUdDLG9CQUFtQixRQUFrQjtRQUY3QixhQUFRLEdBQWEsRUFBRSxDQUFDO1FBRy9CLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBQ3pCLEdBQUcsQ0FBQyxHQUFHLENBQUMsY0FBWSxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBRyxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUVhLGlCQUFNLEdBQXBCLFVBQXFCLE1BQWM7UUFDbEMsTUFBTSxDQUFDLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FDcEMsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUUsVUFBVSxDQUFDLEVBQUUsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzFELENBQUM7SUFFTSxpQ0FBWSxHQUFuQjtRQUNDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FB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Q0FBQyxDQUFDO1lBQy9DLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQ2hELENBQUM7UUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2IsQ0FBQztJQUVNLHFCQUFNLEdBQWI7UUFDQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDWCxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDN0QsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0IsSUFBSSxTQUFTLEdBQUcsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUN4SCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQy9DLENBQUMsSUFBSSxNQUFHLElBQUksR0FBRyxLQUFLLEdBQUcsRUFBRSxLQUFHLFNBQVMsR0FBRyxLQUFLLEdBQUcsRUFBRSxJQUFHLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBRyxTQUFTLEdBQUcsTUFBTSxHQUFHLEVBQUUsS0FBRyxJQUFJLEdBQUcsTUFBTSxHQUFHLEVBQUUsT0FBRyxDQUFDO1FBQzFJLENBQUM7UUFDRCxDQUFDLElBQUksUUFBTSxJQUFJLENBQUMs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QUFDLENBQUM7QUFFckIsSUFBSSxNQUFNLENBQUM7QUFDWCxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQ1gseUNBQXlDO0lBQ3pDLE1BQU0sR0FBRyxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM1Qyw4Q0FBOEM7SUFDOUMsOENBQThDO0lBQzlDLDhDQUE4QztBQUMvQyxDQUFDO0FBQ0QsSUFBSSxDQUFDLENBQUM7SUFDTCxNQUFNLEdBQUcsSUFBSSxvQkFBb0IsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUMvQyxDQUFDO0FBQ0QsSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwibm9kZV9tb2R1bGVzL0B0eXBlcy9qcXVlcnkvaW5kZXguZC50c1wiIC8+XHJcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJub2RlX21vZHVsZXMvQHR5cGVzL2xvZGFzaC9pbmRleC5kLnRzXCIgLz5cclxuXHJcbmNvbnN0IERFQlVHID0gdHJ1ZTtcclxuXHJcbmNsYXNzIExvZyB7XHJcblx0cHVibGljIHN0YXRpYyBvdXQobXNnOiBzdHJpbmcpIHtcclxuXHRcdCQoXCI8cHJlLz5cIikudGV4dChgJHttc2d9XFxuYCkuYXBwZW5kVG8oXCIjbG9nXCIpO1xyXG5cdH1cclxuXHRwdWJsaWMgc3RhdGljIGh0bWwoaHRtbDogc3RyaW5nKSB7XHJcblx0XHQkKFwiPGRpdi8+XCIpLmh0bWwoaHRtbCkuYXBwZW5kVG8oXCIjbG9nXCIpO1xyXG5cdH1cclxufVxyXG5cclxuaW50ZXJmYWNlIFB1enpsZSB7XHJcblx0dGVzdChib2FyZDogQm9hcmQpOiBudW1iZXI7XHJcblx0Z2V0U2xvdENvdW50KCk6IG51bWJlcjtcclxufVxyXG5cclxuY2xhc3MgUHV6emxlRGVtbyBpbXBsZW1lbnRzIFB1enpsZSB7XHJcblx0cHJpdmF0ZSBzb2x1dGlvbjogbnVtYmVyW10gPSBbXTtcclxuXHJcblx0cHVibGljIGNvbnN0cnVjdG9yKHNvbHV0aW9uOiBudW1iZXJbXSkge1xyXG5cdFx0dGhpcy5zb2x1dGlvbiA9IHNvbHV0aW9uO1xyXG5cdFx0TG9nLm91dChgUHV6emxlOlxcbiR7c29sdXRpb24uam9pbihcIiAgXCIpfWApO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHN0YXRpYyByYW5kb20obGVuZ3RoOiBudW1iZXIpOiBQdXp6bGUge1xyXG5cdFx0cmV0dXJuIG5ldyBQdXp6bGVEZW1vKF8uc2h1ZmZsZShfLm1hcChcclxuXHRcdFx0bmV3IEFycmF5KGxlbmd0aCksIGZ1bmN0aW9uICh2LCBrKSB7IHJldHVybiBrICsgMTsgfSkpKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBnZXRTbG90Q291bnQoKTogbnVtYmVyIHtcclxuXHRcdHJldHVybiB0aGlzLnNvbHV0aW9uLmxlbmd0aDtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyB0ZXN0KGJvYXJkOiBCb2FyZCk6IG51bWJlciB7XHJcblx0XHRsZXQgY291bnQgPSAwO1xyXG5cdFx0Zm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuc29sdXRpb24ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0bGV0IGNvcnJlY3QgPSBib2FyZC5zbG90c1tpXS5xdWFudGl0eSA9PSB0aGlzLnNvbHV0aW9uW2ldO1xyXG5cdFx0XHRpZiAoY29ycmVjdCkgY291bnQrKztcclxuXHRcdFx0aWYgKERFQlVHKSBib2FyZC5kZWJ1Z1ZpZXdDb3JyZWN0U2xvdHNbaV0gPSBjb3JyZWN0O1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGNvdW50O1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgSHVtYW5QdXp6bGVJbnRlcmZhY2UgaW1wbGVtZW50cyBQdXp6bGUge1xyXG5cdHByaXZhdGUgc2xvdENvdW50OiBudW1iZXI7XHJcblxyXG5cdHB1YmxpYyBjb25zdHJ1Y3RvcihzbG90Q291bnQ6IG51bWJlcikge1xyXG5cdFx0dGhpcy5zbG90Q291bnQ7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0U2xvdENvdW50KCk6IG51bWJlciB7XHJcblx0XHRyZXR1cm4gdGhpcy5zbG90Q291bnQ7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgdGVzdChib2FyZDogQm9hcmQpOiBudW1iZXIge1xyXG5cdFx0bGV0IGFuc3dlcjtcclxuXHRcdGRvIHtcclxuXHRcdFx0YW5zd2VyID0gcGFyc2VJbnQocHJvbXB0KFxyXG5cdFx0XHRcdGBQbGVhc2UgdHJ5OlxcblxcdCR7Ym9hcmR9XFxuXFxuSG93IG1hbnkgYXJlIGNvcnJlY3Q/YCksIDEwKTtcclxuXHRcdH1cclxuXHRcdHdoaWxlICghaXNOYU4oYW5zd2VyKSk7XHJcblx0XHRyZXR1cm4gYW5zd2VyO1xyXG5cdH1cclxufVxyXG5cclxudHlwZSBEZWR1Y3Rpb24gPSBcIlVOS05PV05cIiB8IFwiTk9cIiB8IFwiTUFZQkVcIiB8IFwiWUVTXCI7XHJcbmNvbnN0IFVOS05PV04gPSBcIlVOS05PV05cIjtcclxuY29uc3QgTk8gPSBcIk5PXCI7XHJcbmNvbnN0IE1BWUJFID0gXCJNQVlCRVwiO1xyXG5jb25zdCBZRVMgPSBcIllFU1wiO1xyXG5cclxuY2xhc3MgTW92ZSB7XHJcblx0cHVibGljIG51bTogbnVtYmVyO1xyXG5cdHB1YmxpYyBwcmV2PzogTW92ZTtcclxuXHRwdWJsaWMgYm9hcmQ6IEJvYXJkO1xyXG5cdHB1YmxpYyBwYWlyPzogUGFpcjtcclxuXHRwdWJsaWMgY29ycmVjdDogbnVtYmVyO1xyXG5cdHB1YmxpYyBkZWx0YTogbnVtYmVyO1xyXG5cclxuXHQvLyBuZXcgbW92ZSBiYXNlZCBvbiBnaXZlbiBib2FyZFxyXG5cdHB1YmxpYyBjb25zdHJ1Y3Rvcihib2FyZDogQm9hcmQsIGFJbmRleD86IG51bWJlciwgYkluZGV4PzogbnVtYmVyKSB7XHJcblx0XHRpZiAobnVsbCAhPSBhSW5kZXggJiYgbnVsbCAhPSBiSW5kZXgpIHtcclxuXHRcdFx0bGV0IG9sZEEgPSBfLmNsb25lRGVlcChib2FyZC5zbG90c1thSW5kZXhdKTtcclxuXHRcdFx0bGV0IG9sZEIgPSBfLmNsb25lRGVlcChib2FyZC5zbG90c1tiSW5kZXhdKTtcclxuXHRcdFx0Ym9hcmQuc2xvdHNbYUluZGV4XSA9IG9sZEI7XHJcblx0XHRcdGJvYXJkLnNsb3RzW2FJbmRleF0uaW5kZXggPSBhSW5kZXg7XHJcblx0XHRcdGJvYXJkLnNsb3RzW2JJbmRleF0gPSBvbGRBO1xyXG5cdFx0XHRib2FyZC5zbG90c1tiSW5kZXhdLmluZGV4ID0gYkluZGV4O1xyXG5cdFx0fVxyXG5cdFx0bW92ZS5ib2FyZCA9IF8uY2xvbmVEZWVwKGJvYXJkKTtcclxuXHRcdGlmIChudWxsICE9IGFJbmRleCAmJiBudWxsICE9IGJJbmRleCkge1xyXG5cdFx0XHRtb3ZlLnBhaXIgPSBuZXcgUGFpcigpO1xyXG5cdFx0XHRtb3ZlLnBhaXIuYSA9IF8uY2xvbmVEZWVwKGJvYXJkLnNsb3RzW2FJbmRleF0pO1xyXG5cdFx0XHRtb3ZlLnBhaXIuYiA9IF8uY2xvbmVEZWVwKGJvYXJkLnNsb3RzW2JJbmRleF0pO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIG1vdmU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgcmVuZGVyKCkge1xyXG5cdFx0bGV0IHMgPSBcIlwiO1xyXG5cdFx0Zm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuYm9hcmQuc2xvdHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0bGV0IHNsb3QgPSB0aGlzLmJvYXJkLnNsb3RzW2ldO1xyXG5cdFx0XHRsZXQgdW5kZXJsaW5lID0gKG51bGwgIT0gdGhpcy5wYWlyICYmIChzbG90LnF1YW50aXR5ID09IHRoaXMucGFpci5hLnF1YW50aXR5IHx8IHNsb3QucXVhbnRpdHkgPT0gdGhpcy5wYWlyLmIucXVhbnRpdHkpKTtcclxuXHRcdFx0bGV0IGJvbGQgPSB0aGlzLmJvYXJkLmRlYnVnVmlld0NvcnJlY3RTbG90c1tpXTtcclxuXHRcdFx0cyArPSBgJHtib2xkID8gXCI8Yj5cIiA6IFwiXCJ9JHt1bmRlcmxpbmUgPyBcIjx1PlwiIDogXCJcIn0ke3Nsb3QucXVhbnRpdHl9JHtzbG90LmRlZHVjdGlvblswXX0ke3VuZGVybGluZSA/IFwiPC91PlwiIDogXCJcIn0ke2JvbGQgPyBcIjwvYj5cIiA6IFwiXCJ9IGA7XHJcblx0XHR9XHJcblx0XHRzICs9IGAgPSAke3RoaXMuY29ycmVjdH0gKCR7dGhpcy5kZWx0YSA8IDAgPyB0aGlzLmRlbHRhIDogYCske3RoaXMuZGVsdGF9YH0pYDtcclxuXHRcdExvZy5odG1sKHMpO1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgU2xvdCB7XHJcblx0cHVibGljIGluZGV4OiBudW1iZXI7XHJcblx0cHVibGljIHF1YW50aXR5OiBudW1iZXI7XHJcblx0cHVibGljIGRlZHVjdGlvbjogRGVkdWN0aW9uO1xyXG5cclxuXHRwdWJsaWMgc2V0RGVkdWN0aW9uKGRlZHVjdGlvbjogRGVkdWN0aW9uKSB7XHJcblx0XHR0aGlzLmRlZHVjdGlvbiA9IGRlZHVjdGlvbjtcclxuXHRcdExvZy5vdXQoYCAgICAgICAgICAke3RoaXMucXVhbnRpdHl9ICR7dGhpcy5kZWR1Y3Rpb25bMF19ID0+ICR7ZGVkdWN0aW9uWzBdfSR7ZGVkdWN0aW9uID09IFlFUyA/IFwiIEZPVU5EXCIgOiBcIlwifWApO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHRvU3RyaW5nKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMucXVhbnRpdHk7XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBQYWlyIHtcclxuXHRwdWJsaWMgYTogU2xvdDtcclxuXHRwdWJsaWMgYjogU2xvdDtcclxuXHJcblx0cHVibGljIG1hdGNoZXNEZWR1Y3Rpb25zKGE6IERlZHVjdGlvbiwgYjogRGVkdWN0aW9uKTogYm9vbGVhbiB7XHJcblx0XHRyZXR1cm4gdGhpcy5hLmRlZHVjdGlvbiA9PSBhICYmIHRoaXMuYi5kZWR1Y3Rpb24gPT0gYjtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIEJvYXJkIHtcclxuXHRwdWJsaWMgc2xvdHM6IFNsb3RbXTtcclxuXHRwdWJsaWMgZGVidWdWaWV3Q29ycmVjdFNsb3RzOiBib29sZWFuW10gPSBbXTtcclxuXHJcblx0cHVibGljIGNvbnN0cnVjdG9yKHNsb3RzOiBTbG90W10pIHtcclxuXHRcdHRoaXMuc2xvdHMgPSBzbG90cztcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBmaW5kQWxsKGZuKSB7XHJcblx0XHRyZXR1cm4gXy5maWx0ZXIodGhpcy5zbG90cywgZm4pO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGZpbmRPbmUoZm4pIHtcclxuXHRcdHJldHVybiB0aGlzLmZpbmRBbGwoZm4pWzBdO1xyXG5cdH1cclxuXHJcblx0Ly8gZmluZCB0aGUgYWRqYWNlbnQgcGFpciBpbiBnaXZlbiB0d28gbW92ZXNcclxuXHQvLyBhZGogcGFpciBpbiB0d28gbW92ZXMgPVxyXG5cdC8vIGlmIG1vdmUxID0gYSxiIGFuZCBtb3ZlMiA9IGIsYyB0aGVuIGFqYyBwYWlyID0gYVxyXG5cdHB1YmxpYyBzZXREZWR1Y3Rpb24oKSB7XHJcblxyXG5cdH1cclxuXHJcblx0cHVibGljIHJlbmRlcigpIHtcclxuXHRcdGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLnNsb3RzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcblx0XHRcdCQoXCJ0ZCNjXCIgKyBpKS50ZXh0KHRoaXMuc2xvdHNbaV0ucXVhbnRpdHkgKyBcIiBcIiArIHRoaXMuc2xvdHNbaV0uZGVkdWN0aW9uWzBdKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHB1YmxpYyB0b1N0cmluZygpIHtcclxuXHRcdHJldHVybiB0aGlzLnNsb3RzLmpvaW4oXCIgXCIpO1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgU29sdmVyIHtcclxuXHRwcml2YXRlIHB1enpsZTogUHV6emxlO1xyXG5cdHByaXZhdGUgbW92ZXM6IG51bWJlciA9IDA7XHJcblx0cHVibGljIGxhc3RNb3ZlOiBNb3ZlOyAvLyBoaXN0b3J5IG9mIG1vdmVzXHJcblxyXG5cdHB1YmxpYyBjb25zdHJ1Y3RvcihwdXp6bGU6IFB1enpsZSkge1xyXG5cdFx0dGhpcy5wdXp6bGUgPSBwdXp6bGU7XHJcblxyXG5cdFx0Ly8gcGxheSBvcGVuaW5nIG1vdmVcclxuXHRcdHRoaXMucGxheU1vdmUodGhpcy5uZXdNb3ZlKG5ldyBCb2FyZChfLm1hcChcclxuXHRcdFx0bmV3IEFycmF5KHRoaXMucHV6emxlLmdldFNsb3RDb3VudCgpKSxcclxuXHRcdFx0KG5pbCwgaSkgPT4ge1xyXG5cdFx0XHRcdGxldCBzbG90ID0gbmV3IFNsb3QoKTtcclxuXHRcdFx0XHRzbG90LmluZGV4ID0gaTtcclxuXHRcdFx0XHRzbG90LnF1YW50aXR5ID0gaSArIDE7XHJcblx0XHRcdFx0c2xvdC5kZWR1Y3Rpb24gPSBVTktOT1dOO1xyXG5cdFx0XHRcdHJldHVybiBzbG90O1xyXG5cdFx0XHR9KSkpKTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBwbGF5TW92ZShtb3ZlOiBNb3ZlKSB7XHJcblx0XHQvLyBzZXF1ZW5jZSBtb3ZlIGludG8gcGxheVxyXG5cdFx0bW92ZS5udW0gPSArK3RoaXMubW92ZXM7XHJcblx0XHRtb3ZlLnByZXYgPSB0aGlzLmxhc3RNb3ZlO1xyXG5cdFx0dGhpcy5sYXN0TW92ZSA9IG1vdmU7XHJcblxyXG5cdFx0aWYgKHRoaXMubW92ZXMgPiBNQVhfR1VFU1NFUykge1xyXG5cdFx0XHRMb2cub3V0KFwiVG9vIG1hbnkgZ3Vlc3Nlczsgd2UgbG9zZS5cIik7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHR7XHJcblx0XHRcdGxldCBjb3JyZWN0ID0gdGhpcy5wdXp6bGUudGVzdCh0aGlzLmxhc3RNb3ZlLmJvYXJkKTtcclxuXHRcdFx0bGV0IGRlbHRhID0gY29ycmVjdCAtIChudWxsICE9IHRoaXMubGFzdE1vdmUgPyB0aGlzLmxhc3RNb3ZlLmNvcnJlY3QgfHwgMCA6IDApO1xyXG5cdFx0XHR0aGlzLmxhc3RNb3ZlLmJvYXJkLnJlbmRlcigpO1xyXG5cdFx0XHR0aGlzLmxhc3RNb3ZlLmNvcnJlY3QgPSBjb3JyZWN0O1xyXG5cdFx0XHR0aGlzLmxhc3RNb3ZlLmRlbHRhID0gZGVsdGE7XHJcblx0XHRcdHRoaXMubGFzdE1vdmUucmVuZGVyKCk7XHJcblx0XHRcdGlmIChjb3JyZWN0ID09IHRoaXMucHV6emxlLmdldFNsb3RDb3VudCgpKSB7XHJcblx0XHRcdFx0TG9nLm91dChgWW91IHdpbiBpbiAke3RoaXMubW92ZXN9IG1vdmVzLmApO1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdC8vIHRyeSBhZ2FpblxyXG5cdFx0aWYgKG51bGwgIT0gdGhpcy5sYXN0TW92ZS5wYWlyKSB7XHJcblx0XHRcdGlmICh0aGlzLmxhc3RNb3ZlLmRlbHRhID09IDApIHtcclxuXHRcdFx0XHQvLyBubyBkaWZmZXJlbmNlOyBib3RoIG11c3QgYmUgTk8/XHJcblx0XHRcdFx0dGhpcy5sYXN0TW92ZS5wYWlyLmEuc2V0RGVkdWN0aW9uKE5PKTtcclxuXHRcdFx0XHR0aGlzLmxhc3RNb3ZlLnBhaXIuYi5zZXREZWR1Y3Rpb24oTk8pO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKHRoaXMubGFzdE1vdmUuZGVsdGEgPT0gMSkge1xyXG5cdFx0XHRcdC8vIGRpZmZlcmVuY2U7IG9uZSBpcyBub3cgcmlnaHQsIGJ1dCB3ZSBkb24ndCBrbm93IHdoaWNoXHJcblx0XHRcdFx0Ly8gdW5sZXNzIHdlIGhhdmUgaGlzdG9yeSB0byBuYXJyb3cgaXQsIHRoZW4gd2UgaGF2ZSBzcGVjaWZpYyBtYXRjaFxyXG5cdFx0XHRcdHRoaXMubGFzdE1vdmUucGFpci5hLnNldERlZHVjdGlvbihNQVlCRSk7XHJcblx0XHRcdFx0dGhpcy5sYXN0TW92ZS5wYWlyLmIuc2V0RGVkdWN0aW9uKE1BWUJFKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh0aGlzLmxhc3RNb3ZlLmRlbHRhID09IDIpIHtcclxuXHRcdFx0XHQvLyB2ZXJ5IHBvc2l0aXZlIGRpZmZlcmVuY2U7IGJvdGggYXJlIG5vdyByaWdodCBmb3Igc3VyZVxyXG5cdFx0XHRcdHRoaXMubGFzdE1vdmUucGFpci5hLnNldERlZHVjdGlvbihZRVMpO1xyXG5cdFx0XHRcdHRoaXMubGFzdE1vdmUucGFpci5iLnNldERlZHVjdGlvbihZRVMpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKHRoaXMubGFzdE1vdmUuZGVsdGEgPT0gLTEpIHtcclxuXHRcdFx0XHQvLyBkaWZmZXJlbmNlOyBvbmUgd2FzIHJpZ2h0LCBidXQgd2UgZG9uJ3Qga25vdyB3aGljaFxyXG5cdFx0XHRcdC8vIHNvIGZpcnN0IHN0ZXAgaXMgYWx3YXlzIHRvIHB1dCBpdCBiYWNrXHJcblx0XHRcdFx0dGhpcy5sYXN0TW92ZS5wYWlyLmEuc2V0RGVkdWN0aW9uKE1BWUJFKTtcclxuXHRcdFx0XHR0aGlzLmxhc3RNb3ZlLnBhaXIuYi5zZXREZWR1Y3Rpb24oTUFZQkUpO1xyXG5cdFx0XHRcdHRoaXMudW5zd2FwKCk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAodGhpcy5sYXN0TW92ZS5kZWx0YSA9PSAtMikge1xyXG5cdFx0XHRcdC8vIGRpZmZlcmVuY2U7IGJvdGggd2VyZSByaWdodCBmb3Igc3VyZVxyXG5cdFx0XHRcdHRoaXMubGFzdE1vdmUucGFpci5hLnNldERlZHVjdGlvbihZRVMpO1xyXG5cdFx0XHRcdHRoaXMubGFzdE1vdmUucGFpci5iLnNldERlZHVjdGlvbihZRVMpO1xyXG5cdFx0XHRcdHRoaXMudW5zd2FwKCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRzZXRUaW1lb3V0KCgpID0+IHRoaXMucGxheU1vdmUodGhpcy5uZXdNb3ZlKGEsIGIpKSwgR1VFU1NfREVMQVkpO1xyXG5cdH1cclxuXHJcblx0Ly8gZGV0ZXJtaW5lIHdoZXRoZXIgYSBxdWFudGl0eSBoYXMgZXZlciBoYWQgYSBnaXZlbiBkZWR1Y3Rpb24gYXQgYSBzcGVjaWZpYyBpbmRleCBpbiBlbnRpcmUgaGlzdG9yeVxyXG5cdHB1YmxpYyBoYWREZWR1Y3Rpb25BdEluZGV4KHF1YW50aXR5OiBudW1iZXIsIGluZGV4OiBudW1iZXIsIGRlZHVjdGlvbjogRGVkdWN0aW9uKTogYm9vbGVhbiB7XHJcblx0XHR3aGlsZSAobnVsbCAhPSB0aGlzLmxhc3RNb3ZlLnBhaXIpIHtcclxuXHRcdFx0bGV0IHBhaXIgPSB0aGlzLmxhc3RNb3ZlLnBhaXI7XHJcblx0XHRcdGlmIChcclxuXHRcdFx0XHQocGFpci5hLnF1YW50aXR5ID09IHF1YW50aXR5ICYmXHJcblx0XHRcdFx0XHRwYWlyLmEuZGVkdWN0aW9uID09IGRlZHVjdGlvbiAmJlxyXG5cdFx0XHRcdFx0cGFpci5hLmluZGV4ID09IGluZGV4KSB8fFxyXG5cdFx0XHRcdChwYWlyLmIucXVhbnRpdHkgPT0gcXVhbnRpdHkgJiZcclxuXHRcdFx0XHRcdHBhaXIuYi5kZWR1Y3Rpb24gPT0gZGVkdWN0aW9uICYmXHJcblx0XHRcdFx0XHRwYWlyLmIuaW5kZXggPT0gaW5kZXgpXHJcblx0XHRcdCkge1xyXG5cdFx0XHRcdExvZy5vdXQoYCR7cXVhbnRpdHl9IGluZGV4ICR7aW5kZXh9IGRlZHVjdGlvbiAke2RlZHVjdGlvblswXX0gaGFwcGVuZWQgYmVmb3JlIGF0IG1vdmUgJHt0aGlzLmxhc3RNb3ZlLm51bX1gKTtcclxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0XHR0aGlzLmxhc3RNb3ZlID0gdGhpcy5sYXN0TW92ZS5wcmV2O1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGZhbHNlO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGFscmVhZHlUcmllZChxMTogbnVtYmVyLCBpMTogbnVtYmVyLCBxMjogbnVtYmVyLCBpMjogbnVtYmVyKTogYm9vbGVhbiB7XHJcblx0XHR3aGlsZSAobnVsbCAhPSB0aGlzLmxhc3RNb3ZlLnBhaXIpIHtcclxuXHRcdFx0bGV0IHBhaXIgPSB0aGlzLmxhc3RNb3ZlLnBhaXI7XHJcblx0XHRcdGlmIChcclxuXHRcdFx0XHQocGFpci5hLnF1YW50aXR5ID09IHExICYmXHJcblx0XHRcdFx0XHRwYWlyLmEuaW5kZXggPT0gaTEpIHx8XHJcblx0XHRcdFx0KHBhaXIuYi5xdWFudGl0eSA9PSBxMiAmJlxyXG5cdFx0XHRcdFx0cGFpci5iLmluZGV4ID09IGkyKVxyXG5cdFx0XHQpIHtcclxuXHRcdFx0XHRMb2cub3V0KGAke3ExfToke2kxfSwke3EyfToke2kyfSBoYXBwZW5lZCBiZWZvcmUgYXQgbW92ZSAke3RoaXMubGFzdE1vdmUubnVtfWApO1xyXG5cdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHRcdHRoaXMubGFzdE1vdmUgPSB0aGlzLmxhc3RNb3ZlLnByZXY7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gZmFsc2U7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgdW5zd2FwKCkge1xyXG5cdFx0bGV0IG1vdmUgPSB0aGlzLm5ld01vdmUodGhpcy5sYXN0TW92ZS5ib2FyZCwgdGhpcy5sYXN0TW92ZS5wYWlyLmEuaW5kZXgsIHRoaXMubGFzdE1vdmUucGFpci5iLmluZGV4KTtcclxuXHRcdC8vIGFzc3VtZSByZXN1bHQgaXMgc2FtZSBhcyBiZWZvcmVcclxuXHRcdG1vdmUuY29ycmVjdCA9IHRoaXMubGFzdE1vdmUuY29ycmVjdDtcclxuXHRcdG1vdmUuZGVsdGEgPSB0aGlzLmxhc3RNb3ZlLmRlbHRhICogLTE7IC8vIGFzc3VtZSBvcHBvc2l0ZVxyXG5cdH1cclxufVxyXG5cclxuXHJcbmNvbnN0IEdVRVNTX0RFTEFZID0gNTA7IC8vIG1zXHJcbmNvbnN0IE1BWF9HVUVTU0VTID0gOTk7XHJcbmNvbnN0IFNMT1RfQ09VTlQgPSA2O1xyXG5cclxubGV0IHB1enpsZTtcclxuaWYgKERFQlVHKSB7XHJcblx0Ly9wdXp6bGUgPSBQdXp6bGVEZW1vLnJhbmRvbShTTE9UX0NPVU5UKTtcclxuXHRwdXp6bGUgPSBuZXcgUHV6emxlRGVtbyhbMiwgMywgNCwgMSwgNiwgNV0pO1xyXG5cdC8vcHV6emxlID0gbmV3IFB1enpsZURlbW8oWzIsIDQsIDYsIDEsIDUsIDNdKTtcclxuXHQvL3B1enpsZSA9IG5ldyBQdXp6bGVEZW1vKFsyLCAxLCA1LCA2LCAzLCA0XSk7XHJcblx0Ly8gVE9ETzogdHJ5IGEgcHV6emxlIHdoZXJlIG51bWJlcnMgY2FuIHJlcGVhdFxyXG59XHJcbmVsc2Uge1xyXG5cdHB1enpsZSA9IG5ldyBIdW1hblB1enpsZUludGVyZmFjZShTTE9UX0NPVU5UKTtcclxufVxyXG5uZXcgU29sdmVyKHB1enpsZSk7Il19